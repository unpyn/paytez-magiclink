(self.webpackChunkPaytez_web=self.webpackChunkPaytez_web||[]).push([[664],{49977:function(e,t){var r;function n(e,t){navigator.onLine||e("offline"),e("error",t)}function i(e,t,r){navigator.serviceWorker.register(e,r).then((function(e){t("registered",e),e.waiting?t("updated",e):e.onupdatefound=function(){t("updatefound",e);var r=e.installing;r.onstatechange=function(){"installed"===r.state&&(navigator.serviceWorker.controller?t("updated",e):t("cached",e))}}})).catch((function(e){return n(t,e)}))}"undefined"!==typeof window&&(r="undefined"===typeof document||"interactive"!==document.readyState&&"complete"!==document.readyState?"undefined"!==typeof Promise?new Promise((function(e){return window.addEventListener("load",e)})):{then:function(e){return window.addEventListener("load",e)}}:Promise.resolve()),t.z=function(e,t){void 0===t&&(t={});var a=t.registrationOptions;void 0===a&&(a={}),delete t.registrationOptions;var o=function(e){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];t&&t[e]&&t[e].apply(t,r)};"serviceWorker"in navigator&&r.then((function(){Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))?(!function(e,t,r){fetch(e).then((function(n){404===n.status?(t("error",new Error("Service worker not found at "+e)),unregister()):-1===n.headers.get("content-type").indexOf("javascript")?(t("error",new Error("Expected "+e+" to have javascript content-type, but received "+n.headers.get("content-type"))),unregister()):i(e,t,r)})).catch((function(e){return n(t,e)}))}(e,o,a),navigator.serviceWorker.ready.then((function(e){o("ready",e)}))):(i(e,o,a),navigator.serviceWorker.ready.then((function(e){o("ready",e)})))}))}},18771:function(e,t,r){"use strict";r.d(t,{$O:function(){return q},DS:function(){return B},E5:function(){return Z},E9:function(){return I},HI:function(){return b},I_:function(){return j},J_:function(){return E},Kx:function(){return A},MT:function(){return M},Nb:function(){return R},Qr:function(){return S},TV:function(){return _},VZ:function(){return C},W:function(){return L},Wj:function(){return D},mB:function(){return U},nK:function(){return N},pe:function(){return k},sP:function(){return K},su:function(){return F},wz:function(){return y},y:function(){return T},yu:function(){return P}});var n=r(24611),i=r(14771),a=r(24269),o=r(74086),s=r(47061),c=r(59900),u=r(53755),l=r(15826),f=r(54006),d=r.n(f),h=(r(57413),r(80082)),p=r(42890),v=r(20240),m=r(53065),g=r(80080).Buffer,y=new h.ec("secp256k1");function b(e,t){return w.apply(this,arguments)}function w(){return(w=(0,u.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.HI)(t,r);case 2:return i=e.sent,e.abrupt("return",{ciphertext:i.ciphertext.toString("hex"),ephemPublicKey:i.ephemPublicKey.toString("hex"),iv:i.iv.toString("hex"),mac:i.mac.toString("hex")});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){return x.apply(this,arguments)}function x(){return(x=(0,u.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={ciphertext:g.from(r.ciphertext,"hex"),ephemPublicKey:g.from(r.ephemPublicKey,"hex"),iv:g.from(r.iv,"hex"),mac:g.from(r.mac,"hex")},e.abrupt("return",(0,l.pe)(t,i));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return 0===Object.keys(e).length&&e.constructor===Object}var O=function(e){return e&&e.stack&&""!==e.message};function _(e){return O(e)?e.message:JSON.stringify((0,p.serializeError)(e))}function Z(e){var t=new(d())((0,l.oq)());return e.find((function(e){return e.eq(t)}))?Z(e):t}var P="KEY_NOT_FOUND",E="SHARE_DELETED";function M(e){return"0x"===e.slice(0,2)?e.slice(2):e}function T(){return"".concat(Math.random().toString(36).substr(2,9))}var I=function(){function e(t,r){(0,s.Z)(this,e),(0,v.Z)(this,"x",void 0),(0,v.Z)(this,"y",void 0),this.x=new(d())(t,"hex"),this.y=new(d())(r,"hex")}return(0,c.Z)(e,[{key:"encode",value:function(e,t){switch(e){case"arr":return g.concat([g.from("0x04","hex"),g.from(this.x.toString("hex"),"hex"),g.from(this.y.toString("hex"),"hex")]);case"elliptic-compressed":var r=y.keyFromPublic({x:this.x.toString("hex"),y:this.y.toString("hex")},"hex");return g.from(r.getPublic(!0,"hex"));default:throw new Error("encoding doesnt exist in Point")}}},{key:"toJSON",value:function(){return{x:this.x.toString("hex"),y:this.y.toString("hex")}}}],[{key:"fromCompressedPub",value:function(t){var r=y.keyFromPublic(t,"hex").getPublic();return new e(r.getX(),r.getY())}},{key:"fromJSON",value:function(t){return new e(t.x,t.y)}}]),e}(),N=function(e){return y.keyFromPrivate(e.toString("hex",64))},A=function(e){var t=new(d())(e,"hex");return g.from(t.toString("hex",64),"hex")},L=function(e){return(0,l.rc)(A(e))},j=function(e){var t=function(e){return y.keyFromPrivate(e.toString("hex",64)).getPublic()}(e);return new I(t.getX().toString("hex"),t.getY().toString("hex"))},C=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var a;return(0,s.Z)(this,r),a=t.call(this,n),(0,v.Z)((0,i.Z)(a),"code",void 0),(0,v.Z)((0,i.Z)(a),"message",void 0),a.code=e,a.message=n||"",Object.defineProperty((0,i.Z)(a),"name",{value:"TkeyError"}),a}return(0,c.Z)(r,[{key:"toJSON",value:function(){return{name:this.name,code:this.code,message:this.message}}},{key:"toString",value:function(){return JSON.stringify(this.toJSON())}}]),r}(m.s),R="__ONE_KEY_DELETE_NONCE__",D="noncev2",K=function(){function e(t){(0,s.Z)(this,e),(0,v.Z)(this,"polynomialCommitments",void 0),(0,v.Z)(this,"polynomialId",void 0),this.polynomialCommitments=t}return(0,c.Z)(e,[{key:"getThreshold",value:function(){return this.polynomialCommitments.length}},{key:"getPolynomialID",value:function(){for(var e="",t=0;t<this.polynomialCommitments.length;t+=1){var r=this.polynomialCommitments[t].encode("elliptic-compressed").toString();0!==t&&(r="|".concat(r)),e+=r}return this.polynomialId=e,this.polynomialId}},{key:"toJSON",value:function(){return{polynomialCommitments:this.polynomialCommitments}}}],[{key:"fromJSON",value:function(t){return new e(t.polynomialCommitments.map((function(e){return I.fromJSON(e)})))}}]),e}(),F=function(){function e(t,r){(0,s.Z)(this,e),(0,v.Z)(this,"shareCommitment",void 0),(0,v.Z)(this,"shareIndex",void 0),this.shareCommitment=new I(r.x,r.y),this.shareIndex=new(d())(t,"hex")}return(0,c.Z)(e,[{key:"toJSON",value:function(){return{shareCommitment:this.shareCommitment,shareIndex:this.shareIndex.toString("hex")}}}],[{key:"fromJSON",value:function(t){var r=t.shareCommitment;return new e(t.shareIndex,I.fromJSON(r))}}]),e}(),U=function(){function e(t,r){(0,s.Z)(this,e),(0,v.Z)(this,"share",void 0),(0,v.Z)(this,"shareIndex",void 0),this.share=new(d())(r,"hex"),this.shareIndex=new(d())(t,"hex")}return(0,c.Z)(e,[{key:"getPublicShare",value:function(){return new F(this.shareIndex,j(this.share))}},{key:"toJSON",value:function(){return{share:this.share.toString("hex"),shareIndex:this.shareIndex.toString("hex")}}}],[{key:"fromJSON",value:function(t){var r=t.share;return new e(t.shareIndex,r)}}]),e}(),B=function(){function e(t){(0,s.Z)(this,e),(0,v.Z)(this,"polynomial",void 0),(0,v.Z)(this,"publicPolynomial",void 0),this.polynomial=t}return(0,c.Z)(e,[{key:"getThreshold",value:function(){return this.polynomial.length}},{key:"polyEval",value:function(e){var t=new(d())(e,"hex"),r=new(d())(t),n=new(d())(0);n=n.add(this.polynomial[0]);for(var i=1;i<this.polynomial.length;i+=1){var a=r.mul(this.polynomial[i]);n=(n=n.add(a)).umod(y.curve.n),r=(r=r.mul(new(d())(t))).umod(y.curve.n)}return n}},{key:"generateShares",value:function(e){for(var t=e.map((function(e){return"number"===typeof e?new(d())(e):e instanceof d()?e:"string"===typeof e?new(d())(e,"hex"):e})),r={},n=0;n<t.length;n+=1)r[t[n].toString("hex")]=new U(t[n],this.polyEval(t[n]));return r}},{key:"getPublicPolynomial",value:function(){for(var e=[],t=0;t<this.polynomial.length;t+=1)e.push(j(this.polynomial[t]));return this.publicPolynomial=new K(e),this.publicPolynomial}},{key:"getPolynomialID",value:function(){return this.publicPolynomial.polynomialId}},{key:"toJSON",value:function(){return{polynomial:this.polynomial.map((function(e){return e.toString("hex")}))}}}],[{key:"fromJSON",value:function(t){return new e(t.polynomial.map((function(e){return new(d())(e,"hex")})))}}]),e}(),q=function(){function e(t,r){(0,s.Z)(this,e),(0,v.Z)(this,"share",void 0),(0,v.Z)(this,"polynomialID",void 0),this.share=t,this.polynomialID=r}return(0,c.Z)(e,[{key:"toJSON",value:function(){return{share:this.share,polynomialID:this.polynomialID.toString()}}}],[{key:"fromJSON",value:function(t){var r=t.share,n=t.polynomialID;return new e(U.fromJSON(r),n)}}]),e}()},91247:function(e,t,r){"use strict";r.d(t,{Z:function(){return Di}});var n={};r.r(n),r.d(n,{Decoder:function(){return Dt},Encoder:function(){return Ct},PacketType:function(){return At},protocol:function(){return jt}});var i=r(24611),a=r(53755),o=r(20240),s=r(47061),c=r(59900),u=r(12731),l=r(70886),f=r(24269),d=r(74086),h=r(19961),p=r(14771),v=r(18771),m=r(57413),g=r(1891),y=r.n(g),b=r(54006),w=r.n(b),k=r(15826),x=r(80080).Buffer,S=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),i=t.call(this,e,n),Object.defineProperty((0,p.Z)(i),"name",{value:"CoreError"}),i}return(0,c.Z)(r,null,[{key:"fromCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new r(e,"".concat(r.messages[e]," ").concat(t))}},{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new r(1e3,"".concat(r.messages[1e3]," ").concat(e))}},{key:"metadataUndefined",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1101,e)}},{key:"delete1OutOf1OnlyManualSync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1601,e)}},{key:"metadataGetFailed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1102,e)}},{key:"metadataPostFailed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1103,e)}},{key:"tkeyStoreInvalid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1201,e)}},{key:"tkeyEncryptionFailed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1202,e)}},{key:"tkeyDecryptionFailed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1203,e)}},{key:"privateKeyUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1301,e)}},{key:"unableToReconstruct",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1302,e)}},{key:"incorrectReconstruction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1303,e)}},{key:"encryptedShareStoreUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1306,e)}},{key:"acquireLockFailed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1401,e)}},{key:"releaseLockFailed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1402,e)}},{key:"privKeyUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1501,e)}},{key:"metadataPubKeyUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1502,e)}},{key:"authMetadataGetUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1503,e)}},{key:"authMetadataSetUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(1504,e)}}]),r}(v.VZ);(0,o.Z)(S,"messages",{1e3:"Custom",1001:"Unable to delete service provider share",1002:"Wrong share index",1003:"Unable to updateSDK",1101:"metadata not found, SDK likely not initialized",1102:"getMetadata errored",1103:"setMetadata errored",1104:"previouslyFetchedCloudMetadata provided in initialization is outdated",1105:"previouslyFetchedCloudMetadata.nonce should never be higher than the latestShareDetails, please contact support",1201:"Invalid tkeyStore",1202:"Encryption failed",1203:"Decryption failed",1301:"Private key not available. Please reconstruct key first",1302:"Unable to reconstruct",1303:"reconstructed key is not pub key",1304:"Share found in unexpected polynomial",1305:"Input is not supported",1306:"no encrypted share store for share exists",1307:"Share doesn't exist",1308:"Share was deleted",1401:"Unable to acquire lock",1402:"Unable to release lock",1501:"privkey unavailable",1502:"metadata pubkey unavailable",1503:"getAuthMetadata errored",1504:"setAuthMetadata errored",1601:"delete1OutOf1 requires manualSync=true"});var O=function(e){return Array.from({length:e},(function(){return new(w())(0)}))},_=function(e,t){var r=O(t.length),n=function(e,t){for(var r=new(w())(1),n=t[e].x,i=t.length-1;i>=0;i-=1)if(e!==i){var a=new(w())(n);a=(a=a.sub(t[i].x)).umod(v.wz.curve.n),r=(r=r.mul(a)).umod(v.wz.curve.n)}return r}(e,t);if(0===n.cmp(new(w())(0)))throw S.default("Denominator for interpolationPoly is 0");r[0]=n.invm(v.wz.curve.n);for(var i=0;i<t.length;i+=1){var a=O(t.length);if(i!==e){var o=void 0;for(o=i<e?i+1:i,o-=1;o>=0;o-=1){a[o+1]=a[o+1].add(r[o]),a[o+1]=a[o+1].umod(v.wz.curve.n);var s=new(w())(t[i].x);s=(s=s.mul(r[o])).umod(v.wz.curve.n),a[o]=a[o].sub(s),a[o]=a[o].umod(v.wz.curve.n)}r=a}}return r},Z=function(e){for(var t=function(e){var t=(0,h.Z)(e);return t.sort((function(e,t){return e.x.cmp(t.x)})),t}(e),r=O(t.length),n=0;n<t.length;n+=1)for(var i=_(n,t),a=0;a<t.length;a+=1){var o=new(w())(t[n].y);o=o.mul(i[a]),r[a]=r[a].add(o),r[a]=r[a].umod(v.wz.curve.n)}return new v.DS(r)};function P(e){return Z(e)}function E(e,t){if(e.length!==t.length)throw S.default("shares not equal to nodeIndex length in lagrangeInterpolation");for(var r=new(w())(0),n=0;n<e.length;n+=1){for(var i=new(w())(1),a=new(w())(1),o=0;o<e.length;o+=1)if(n!==o){i=(i=i.mul(t[o].neg())).umod(v.wz.curve.n);var s=t[n].sub(t[o]);s=s.umod(v.wz.curve.n),a=a.mul(s).umod(v.wz.curve.n)}var c=i.mul(a.invm(v.wz.curve.n)).umod(v.wz.curve.n);c=c.mul(e[n]).umod(v.wz.curve.n),r=r.add(c)}return r.umod(v.wz.curve.n)}function M(e,t,r){var n=t;if(t||(n=(0,v.E5)([new(w())(0)])),!r){for(var i=[n],a=0;a<e;a+=1){var o=(0,v.E5)(i);i.push(o)}return new v.DS(i)}if(!Array.isArray(r))throw S.default("deterministic shares in generateRandomPolynomial should be an array");if(r.length>e)throw S.default("deterministicShares in generateRandomPolynomial should be less or equal than degree to ensure an element of randomness");var s={};r.forEach((function(e){s[e.shareIndex.toString("hex")]=new v.E9(e.shareIndex,e.share)}));for(var c=0;c<e-r.length;c+=1){for(var u=(0,v.E5)([new(w())(0)]);void 0!==s[u.toString("hex")];)u=(0,v.E5)([new(w())(0)]);s[u.toString("hex")]=new v.E9(u,new(w())((0,k.oq)()))}return s[0]=new v.E9(new(w())(0),n),P(Object.values(s))}function T(e,t){for(var r=[],n=0;n<e.length;n+=1){var i=v.wz.keyFromPublic({x:e[n].x.toString("hex"),y:e[n].y.toString("hex")},"");r.push(i.getPublic())}for(var a=r[0],o=1;o<r.length;o+=1){var s=t.pow(new(w())(o)).umod(v.wz.n),c=r[o].mul(s);a=a.add(c)}return new v.E9(a.getX(),a.getY())}var I=function(){function e(t){(0,s.Z)(this,e),(0,o.Z)(this,"pubKey",void 0),(0,o.Z)(this,"publicPolynomials",void 0),(0,o.Z)(this,"publicShares",void 0),(0,o.Z)(this,"polyIDList",void 0),(0,o.Z)(this,"generalStore",void 0),(0,o.Z)(this,"tkeyStore",void 0),(0,o.Z)(this,"scopedStore",void 0),(0,o.Z)(this,"nonce",void 0),this.publicPolynomials={},this.publicShares={},this.generalStore={},this.tkeyStore={},this.scopedStore={},this.pubKey=t,this.polyIDList=[],this.nonce=0}return(0,c.Z)(e,[{key:"getShareIndexesForPolynomial",value:function(e){var t=this.polyIDList.filter((function(t){return t[0]===e}));if(t.length<1)throw S.default("there is no matching polyID");if(t.length>1)throw S.default("there is more than one matching polyID");return t[0][1]}},{key:"getLatestPublicPolynomial",value:function(){return this.publicPolynomials[this.polyIDList[this.polyIDList.length-1][0]]}},{key:"addPublicShare",value:function(e,t){e in this.publicShares||(this.publicShares[e]={}),this.publicShares[e][t.shareIndex.toString("hex")]=t}},{key:"setGeneralStoreDomain",value:function(e,t){this.generalStore[e]=t}},{key:"getGeneralStoreDomain",value:function(e){return this.generalStore[e]}},{key:"deleteGeneralStoreDomain",value:function(e){delete this.generalStore[e]}},{key:"setTkeyStoreDomain",value:function(e,t){this.tkeyStore[e]=t}},{key:"getTkeyStoreDomain",value:function(e){return this.tkeyStore[e]}},{key:"addFromPolynomialAndShares",value:function(e,t){var r=e.getPublicPolynomial(),n=r.getPolynomialID();this.publicPolynomials[n]=r;var i=[];if(Array.isArray(t))for(var a=0;a<t.length;a+=1)this.addPublicShare(r.getPolynomialID(),t[a].getPublicShare()),i.push(t[a].shareIndex.toString("hex"));else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(this.addPublicShare(r.getPolynomialID(),t[o].getPublicShare()),i.push(t[o].shareIndex.toString("hex")));this.polyIDList.push([n,i])}},{key:"setScopedStore",value:function(e,t){this.scopedStore[e]=t}},{key:"getEncryptedShare",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.share.getPublicShare(),n=this.scopedStore.encryptedShares){e.next=4;break}throw S.encryptedShareStoreUnavailable("".concat(t));case 4:if(a=n[r.shareCommitment.x.toString("hex")]){e.next=7;break}throw S.encryptedShareStoreUnavailable("".concat(t));case 7:return e.next=9,(0,v.pe)((0,v.Kx)(t.share.share),a);case 9:return o=e.sent,e.abrupt("return",v.$O.fromJSON(JSON.parse(o.toString())));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getShareDescription",value:function(){return this.getGeneralStoreDomain("shareDescriptions")}},{key:"addShareDescription",value:function(e,t){var r=this.getGeneralStoreDomain("shareDescriptions")||{};r[e]?r[e].push(t):r[e]=[t],this.setGeneralStoreDomain("shareDescriptions",r)}},{key:"deleteShareDescription",value:function(e,t){var r=this.getGeneralStoreDomain("shareDescriptions"),n=r[e].indexOf(t);if(!(n>-1))throw S.default("No share description found for the given shareIndex: ".concat(e," \n        and description: ").concat(t));r[e].splice(n,1)}},{key:"updateShareDescription",value:function(e,t,r){var n=this.getGeneralStoreDomain("shareDescriptions"),i=n[e].indexOf(t);if(!(i>-1))throw S.default("No share description found for the given shareIndex:\n        ".concat(e," and description: ").concat(t));n[e][i]=r}},{key:"shareToShareStore",value:function(e){for(var t=(0,v.I_)(e),r=this.polyIDList.length-1;r>=0;r-=1)for(var n=this.polyIDList[r][0],i=0;i<this.polyIDList[r][1].length;i+=1){var a=this.polyIDList[r][1][i],o=void 0;if(this.publicShares[n]&&this.publicShares[n][a]&&(o=this.publicShares[n][a]),o||(o=new v.su(a,T(this.publicPolynomials[n].polynomialCommitments,new(w())(a,"hex")))),o.shareCommitment.x.eq(t.x)&&o.shareCommitment.y.eq(t.y)){var s=new v.mB(o.shareIndex,e);return new v.$O(s,n)}}throw S.fromCode(1307)}},{key:"clone",value:function(){return e.fromJSON(JSON.parse(y()(this)))}},{key:"toJSON",value:function(){for(var e=[],t=0;t<this.polyIDList.length;t+=1){var r,n=this.polyIDList[t][0],i=this.polyIDList[t][1].sort((function(e,t){return new(w())(e,"hex").cmp(new(w())(t,"hex"))})),a=(r=n.split("|").concat("0x0")).concat.apply(r,(0,h.Z)(i)).join("|");e.push(a)}return{pubKey:this.pubKey.encode("elliptic-compressed",{ec:v.wz}).toString(),polyIDList:e,scopedStore:this.scopedStore,generalStore:this.generalStore,tkeyStore:this.tkeyStore,nonce:this.nonce}}}],[{key:"fromJSON",value:function(t){var r=t.pubKey,n=t.polyIDList,i=t.generalStore,a=t.tkeyStore,o=t.scopedStore,s=t.nonce,c=new e(v.E9.fromCompressedPub(r)),u=[];i&&(c.generalStore=i),a&&(c.tkeyStore=a),o&&(c.scopedStore=o),s&&(c.nonce=s);for(var l=function(){var e=n[f].split("|"),t=e.findIndex((function(e){return"0x0"===e})),r=e.slice(0,t),i=e.slice(t+1,e.length),a=r.join("|"),o=[];r.forEach((function(e){o.push(v.E9.fromCompressedPub(e))}));var s=new v.sP(o);c.publicPolynomials[a]=s,u.push([a,i])},f=0;f<n.length;f+=1)l();return c.polyIDList=u,c}}]),e}(),N=function(){function e(t,r){(0,s.Z)(this,e),(0,o.Z)(this,"metadata",void 0),(0,o.Z)(this,"privKey",void 0),this.metadata=t,this.privKey=r}return(0,c.Z)(e,[{key:"toJSON",value:function(){var e=this.metadata;if(!this.privKey)throw S.privKeyUnavailable();return{data:e,sig:(0,v.nK)(this.privKey).sign((0,v.MT)((0,m.wn)(x.from(y()(e),"utf8")))).toDER("hex")}}}],[{key:"fromJSON",value:function(t){var r=t.data,n=t.sig,i=I.fromJSON(r);if(!i.pubKey)throw S.metadataPubKeyUnavailable();if(!v.wz.keyFromPublic({x:i.pubKey.x.toString("hex",64),y:i.pubKey.y.toString("hex",64)},"hex").verify((0,v.MT)((0,m.wn)(x.from(y()(r),"utf8"))),n))throw S.default("Signature not valid for returning metadata");return new e(i)}}]),e}();function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=function(){function e(t){(0,s.Z)(this,e),(0,o.Z)(this,"modules",void 0),(0,o.Z)(this,"enableLogging",void 0),(0,o.Z)(this,"serviceProvider",void 0),(0,o.Z)(this,"storageLayer",void 0),(0,o.Z)(this,"shares",void 0),(0,o.Z)(this,"privKey",void 0),(0,o.Z)(this,"lastFetchedCloudMetadata",void 0),(0,o.Z)(this,"metadata",void 0),(0,o.Z)(this,"manualSync",void 0),(0,o.Z)(this,"_localMetadataTransitions",void 0),(0,o.Z)(this,"_refreshMiddleware",void 0),(0,o.Z)(this,"_reconstructKeyMiddleware",void 0),(0,o.Z)(this,"_shareSerializationMiddleware",void 0),(0,o.Z)(this,"storeDeviceShare",void 0),(0,o.Z)(this,"haveWriteMetadataLock",void 0),(0,o.Z)(this,"serverTimeOffset",0);var r=t||{},n=r.enableLogging,i=void 0!==n&&n,a=r.modules,c=void 0===a?{}:a,u=r.serviceProvider,l=r.storageLayer,f=r.manualSync,d=void 0!==f&&f,h=r.serverTimeOffset;this.enableLogging=i,this.serviceProvider=u,this.storageLayer=l,this.modules=c,this.shares={},this.privKey=void 0,this.manualSync=d,this._refreshMiddleware={},this._reconstructKeyMiddleware={},this._shareSerializationMiddleware=void 0,this.storeDeviceShare=void 0,this._localMetadataTransitions=[[],[]],this.setModuleReferences(),this.haveWriteMetadataLock="",this.serverTimeOffset=h}return(0,c.Z)(e,[{key:"getStorageLayer",value:function(){return this.storageLayer}},{key:"getMetadata",value:function(){if("undefined"!==typeof this.metadata)return this.metadata;throw S.metadataUndefined()}},{key:"initialize",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,m,g,y,b,w,k;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t||{}).delete1OutOf1||this.manualSync){e.next=3;break}throw S.delete1OutOf1OnlyManualSync();case 3:if(n=r.withShare,a=r.importKey,o=r.neverInitializeNewKey,s=r.transitionMetadata,c=r.previouslyFetchedCloudMetadata,u=r.previousLocalMetadataTransitions,l=u&&u[0].length>0&&u[1].length>0,d=(f=s&&l)&&void 0===c,!(n instanceof v.$O)){e.next=11;break}h=n,e.next=32;break;case 11:if("object"!==typeof n){e.next=15;break}h=v.$O.fromJSON(n),e.next=32;break;case 15:if(n){e.next=31;break}return p=d,m=d?u:void 0,e.next=20,this.getGenericMetadataWithTransitionStates({serviceProvider:this.serviceProvider,includeLocalMetadataTransitions:p,_localMetadataTransitions:m,fromJSONConstructor:{fromJSON:function(e){return e}}});case 20:if(g=e.sent,g.message!==v.yu){e.next=28;break}if(!o){e.next=25;break}throw S.default("key has not been generated yet");case 25:return e.next=27,this._initializeNewKey({initializeModules:!0,importedKey:a,delete1OutOf1:r.delete1OutOf1});case 27:return e.abrupt("return",this.getKeyDetails());case 28:h=v.$O.fromJSON(g),e.next=32;break;case 31:throw S.default("Input is not supported");case 32:return e.prev=32,e.next=35,this.catchupToLatestShare({shareStore:h});case 35:w=e.sent,e.next=43;break;case 38:if(e.prev=38,e.t0=e.catch(32),1503===e.t0.code&&f){e.next=43;break}throw e.t0;case 43:if(!f||d){e.next=53;break}if(!(c.nonce<w.shareMetadata.nonce)){e.next=48;break}throw S.fromCode(1104);case 48:if(!(c.nonce>w.shareMetadata.nonce)){e.next=50;break}throw S.fromCode(1105);case 50:b=c,e.next=54;break;case 53:b=w?w.shareMetadata.clone():void 0;case 54:return f?(y=s,this._localMetadataTransitions=u):y=w.shareMetadata,this.lastFetchedCloudMetadata=b,this.metadata=y,k=w?w.latestShare:h,this.inputShareStore(k),e.next=61,this.initializeModules();case 61:return e.abrupt("return",this.getKeyDetails());case 62:case"end":return e.stop()}}),e,this,[[32,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"catchupToLatestShare",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.shareStore,n=t.polyID,a=t.includeLocalMetadataTransitions,e.prev=1,e.next=4,this.getAuthMetadata({privKey:r.share.share,includeLocalMetadataTransitions:a});case 4:o=e.sent,e.next=12;break;case 7:if(e.prev=7,e.t0=e.catch(1),!e.t0||1308!==e.t0.code){e.next=11;break}throw e.t0;case 11:throw S.authMetadataGetUnavailable(", ".concat((0,v.TV)(e.t0)));case 12:if(e.prev=12,!n){e.next=16;break}if(r.polynomialID!==n){e.next=16;break}return e.abrupt("return",{latestShare:r,shareMetadata:o});case 16:return e.next=18,o.getEncryptedShare(r);case 18:return s=e.sent,e.next=21,this.catchupToLatestShare({shareStore:s,polyID:n,includeLocalMetadataTransitions:a});case 21:return e.abrupt("return",e.sent);case 24:if(e.prev=24,e.t1=e.catch(12),!e.t1||1308!==e.t1.code){e.next=28;break}throw e.t1;case 28:return e.abrupt("return",{latestShare:r,shareMetadata:o});case 29:case"end":return e.stop()}}),e,this,[[1,7],[12,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reconstructKey",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,o,s,c,u,l,f,d,p,m,g,y,b,w,k,x,O,_,Z,P,M=this,T=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(T.length>0&&void 0!==T[0])||T[0],this.metadata){e.next=3;break}throw S.metadataUndefined();case 3:for(r=this.metadata.getLatestPublicPolynomial(),n=r.getThreshold(),o=r.getPolynomialID(),s=n,c=this.metadata.getShareIndexesForPolynomial(o),u={},l=0;l<c.length;l+=1)u[c[l]]=!0;f=[],d=this.metadata.polyIDList.length-1;case 12:if(!(d>=0&&s>0)){e.next=40;break}if(!(p=this.shares[this.metadata.polyIDList[d][0]])){e.next=37;break}m=Object.keys(p),g=0;case 17:if(!(g<m.length&&s>0)){e.next=37;break}if(!(m[g]in u)){e.next=34;break}if((y=p[m[g]]).polynomialID!==o){e.next=24;break}f.push(y),e.next=32;break;case 24:return e.next=26,this.catchupToLatestShare({shareStore:y,polyID:o,includeLocalMetadataTransitions:!0});case 26:if((b=e.sent).latestShare.polynomialID!==o){e.next=31;break}f.push(b.latestShare),e.next=32;break;case 31:throw new S(1304,"Share found in unexpected polynomial");case 32:delete u[m[g]],s-=1;case 34:g+=1,e.next=17;break;case 37:d-=1,e.next=12;break;case 40:if(f.forEach((function(e){M.inputShareStore(e)})),!(s>0)){e.next=43;break}throw S.unableToReconstruct(" require ".concat(n," but have ").concat(n-s));case 43:for(w=Object.keys(this.shares[o]),k=[],x=[],O=0;O<n;O+=1)k.push(this.shares[o][w[O]].share.share),x.push(this.shares[o][w[O]].share.shareIndex);if(_=E(k,x),Z=(0,v.I_)(_),0===this.metadata.pubKey.x.cmp(Z.x)){e.next=51;break}throw S.incorrectReconstruction();case 51:if(this._setKey(_),P={privKey:_,allKeys:[_]},!(t&&Object.keys(this._reconstructKeyMiddleware).length>0)){e.next=56;break}return e.next=56,Promise.all(Object.keys(this._reconstructKeyMiddleware).map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object.prototype.hasOwnProperty.call(M._reconstructKeyMiddleware,t)){e.next=6;break}return e.next=3,M._reconstructKeyMiddleware[t]();case 3:n=e.sent,P[t]=n,(r=P.allKeys).push.apply(r,(0,h.Z)(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 56:return e.abrupt("return",P);case 57:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reconstructLatestPoly",value:function(){if(!this.metadata)throw S.metadataUndefined();var e=this.metadata.getLatestPublicPolynomial(),t=e.getPolynomialID(),r=e.getThreshold(),n=[],i=Object.keys(this.shares[t]);if(i.length<r)throw S.unableToReconstruct("not enough shares to reconstruct poly");if(new Set(i).size!==i.length)throw S.default("share indexes should be unique");for(var a=0;a<r;a+=1)n.push(new v.E9(new(w())(i[a],"hex"),this.shares[t][i[a]].share.share));return P(n)}},{key:"deleteShare",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(this.privKey){e.next=4;break}throw S.privateKeyUnavailable();case 4:if(r=new(w())(t,"hex"),n=this.outputShareStore(r),0!==r.cmp(new(w())("1","hex"))){e.next=8;break}throw new S(1001,"Unable to delete service provider share");case 8:if(a=this.metadata.getLatestPublicPolynomial(),o=a.getPolynomialID(),s=this.metadata.getShareIndexesForPolynomial(o),c=[],s.forEach((function(e){var t=new(w())(e,"hex");0!==t.cmp(r)&&c.push(t.toString("hex"))})),s.length!==c.length){e.next=17;break}throw S.default("Share index does not exist in latest polynomial");case 17:if(!(c.length<a.getThreshold())){e.next=19;break}throw S.default("Minimum ".concat(a.getThreshold()," shares are required for tkey. Unable to delete share"));case 19:return e.next=21,this._refreshShares(a.getThreshold(),[].concat(c),o);case 21:return u=e.sent,l=u.shareStores,e.next=25,this.addLocalMetadataTransitions({input:[{message:v.J_,dateAdded:Date.now()}],privKey:[n.share.share]});case 25:return e.abrupt("return",{newShareStores:l});case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"generateNewShare",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(this.privKey){e.next=4;break}throw S.privateKeyUnavailable();case 4:return t=this.metadata.getLatestPublicPolynomial(),r=t.getPolynomialID(),n=this.metadata.getShareIndexesForPolynomial(r),a=n.map((function(e){return new(w())(e,"hex")})),o=new(w())((0,v.E5)(a)),e.next=11,this._refreshShares(t.getThreshold(),[].concat((0,h.Z)(n),[o.toString("hex")]),r);case 11:return s=e.sent,c=s.shareStores,e.abrupt("return",{newShareStores:c,newShareIndex:o});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_refreshShares",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var o,s,c,u,l,f,d,p,m,g,y,b,k,O,_,Z,E,T,I,N,A,L,j,C,R=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(this.privKey){e.next=4;break}throw S.privateKeyUnavailable();case 4:if(!(t>r.length)){e.next=6;break}throw S.default("threshold should not be greater than share indexes. ".concat(t," > ").concat(r.length));case 6:if(this.metadata.nonce+=1,o=M(t-1,this.privKey),s=o.generateShares(r),c=this.metadata.getShareIndexesForPolynomial(n),u=[],!((l=Object.keys(this.shares[n])).length<t)){e.next=14;break}throw S.unableToReconstruct("not enough shares for polynomial reconstruction");case 14:for(f=0;f<t;f+=1)u.push(new v.E9(new(w())(l[f],"hex"),this.shares[n][l[f]].share.share));for(d=P(u),p=[],m=0;m<c.length;m+=1)g=c[m],r.includes(g)&&p.push(g);return this.metadata.addFromPolynomialAndShares(o,s),y={},b={},k=o.getPolynomialID(),r.forEach((function(e){b[e]=new v.$O(s[e],k)})),O=this.metadata.clone(),_={},e.next=27,Promise.all(p.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.polyEval(new(w())(t,"hex")),e.next=3,(0,v.HI)((0,v.W)(r),x.from(JSON.stringify(b[t])));case 3:return a=e.sent,_[(0,v.I_)(r).x.toString("hex")]=a,y[t]=new v.$O(new v.mB(t,r),n),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 27:for(T in Z=e.sent,O.setScopedStore("encryptedShares",_),E=Array(Z.length).fill(O),this._refreshMiddleware)Object.prototype.hasOwnProperty.call(this._refreshMiddleware,T)&&((I=this._refreshMiddleware[T](this.metadata.getGeneralStoreDomain(T),y,b))?this.metadata.setGeneralStoreDomain(T,I):this.metadata.deleteGeneralStoreDomain(T));return N=[],A=r.map((function(e){var t=R.metadata.clone();return N.push(t),b[e].share.share})),L=this.generateAuthMetadata({input:[].concat((0,h.Z)(E),N)}),e.next=36,this.addLocalMetadataTransitions({input:[].concat((0,h.Z)(L),[b[1]]),privKey:[].concat((0,h.Z)(Z),(0,h.Z)(A),[void 0])});case 36:for(j=0;j<r.length;j+=1)C=r[j],this.inputShareStore(b[C]);return e.abrupt("return",{shareStores:b});case 38:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_initializeNewKey",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,o,s,c,u,l,f,d,p,m,g,y,b,x,S,O,_,Z=this,P=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=P.length>0&&void 0!==P[0]?P[0]:{}).determinedShare,n=t.initializeModules,a=t.importedKey,o=t.delete1OutOf1,a?this._setKey(new(w())(a)):(s=(0,k.oq)(),this._setKey(new(w())(s))),c=(0,v.E5)([new(w())(1),new(w())(0)]),u=[new(w())(1),c],r?(f=(0,v.E5)([new(w())(1),new(w())(0)]),l=M(1,this.privKey,[new v.mB(f,r)]),u.push(f)):l=M(1,this.privKey),d=l.generateShares(u),(p=new I((0,v.I_)(this.privKey))).addFromPolynomialAndShares(l,d),m=d[u[0].toString("hex")],g=new v.$O(m,l.getPolynomialID()),this.metadata=p,!n){e.next=14;break}return e.next=14,this.initializeModules();case 14:return y=[],b=u.map((function(e){return y.push(Z.metadata),d[e.toString("hex")].share})),x=this.generateAuthMetadata({input:y}),e.next=19,this.addLocalMetadataTransitions({input:[].concat((0,h.Z)(x),[g]),privKey:[].concat((0,h.Z)(b),[void 0])});case 19:if(!o){e.next=22;break}return e.next=22,this.addLocalMetadataTransitions({input:[{message:v.Nb}],privKey:[this.serviceProvider.postboxKey]});case 22:for(S=0;S<u.length;S+=1)O=u[S],this.inputShareStore(new v.$O(d[O.toString("hex")],l.getPolynomialID()));if(!this.storeDeviceShare){e.next=26;break}return e.next=26,this.storeDeviceShare(new v.$O(d[u[1].toString("hex")],l.getPolynomialID()));case 26:return _={privKey:this.privKey,deviceShare:new v.$O(d[u[1].toString("hex")],l.getPolynomialID()),userShare:void 0},r&&(_.userShare=new v.$O(d[u[2].toString("hex")],l.getPolynomialID())),e.abrupt("return",_);case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addLocalMetadataTransitions",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.privKey,n=t.input,this._localMetadataTransitions[0]=[].concat((0,h.Z)(this._localMetadataTransitions[0]),(0,h.Z)(r)),this._localMetadataTransitions[1]=[].concat((0,h.Z)(this._localMetadataTransitions[1]),(0,h.Z)(n)),this.manualSync){e.next=6;break}return e.next=6,this.syncLocalMetadataTransitions();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncLocalMetadataTransitions",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(Array.isArray(this._localMetadataTransitions[0])&&this._localMetadataTransitions[0].length>0){e.next=4;break}return e.abrupt("return");case 4:if(t=!1,!this.lastFetchedCloudMetadata){e.next=9;break}return e.next=8,this.acquireWriteMetadataLock();case 8:t=!0;case 9:return e.prev=9,e.next=12,this.storageLayer.setMetadataStream({input:this._localMetadataTransitions[1],privKey:this._localMetadataTransitions[0],serviceProvider:this.serviceProvider});case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(9),S.metadataPostFailed((0,v.TV)(e.t0));case 17:if(this._localMetadataTransitions=[[],[]],this.lastFetchedCloudMetadata=this.metadata.clone(),!t){e.next=22;break}return e.next=22,this.releaseWriteMetadataLock();case 22:case"end":return e.stop()}}),e,this,[[9,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"updateSDK",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r){var n,a,o,s,c=this;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e({enableLogging:this.enableLogging,modules:this.modules,serviceProvider:this.serviceProvider,storageLayer:this.storageLayer,manualSync:this.manualSync}),t.prev=1,t.next=4,n.initialize({neverInitializeNewKey:!0,withShare:r&&r.withShare});case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),S.fromCode(1103,"".concat(t.t0.message));case 9:return a=n.metadata.polyIDList,Object.keys(this.shares).forEach((function(e){a.find((function(t){return t[0]===e}))?o=e:delete c.shares[e]})),s=Object.keys(this.shares[o]).map((function(e){return n.inputShareStoreSafe(c.outputShareStore(e,o))})),t.next=14,Promise.all(s);case 14:return t.abrupt("return",n);case 15:case"end":return t.stop()}}),t,this,[[1,6]])})));return function(e){return t.apply(this,arguments)}}()},{key:"inputShareStore",value:function(e){var t;if(e instanceof v.$O)t=e;else{if("object"!==typeof e)throw S.default("can only add type ShareStore into shares");t=v.$O.fromJSON(e)}t.polynomialID in this.shares||(this.shares[t.polynomialID]={}),this.shares[t.polynomialID][t.share.shareIndex.toString("hex")]=t}},{key:"inputShareStoreSafe",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],this.metadata){e.next=3;break}throw S.metadataUndefined();case 3:if(!(t instanceof v.$O)){e.next=7;break}n=t,e.next=12;break;case 7:if("object"!==typeof t){e.next=11;break}n=v.$O.fromJSON(t),e.next=12;break;case 11:throw S.default("can only add type ShareStore into shares");case 12:return e.next=14,this.catchupToLatestShare({shareStore:n,includeLocalMetadataTransitions:!0});case 14:if(a=e.sent,this.metadata.polyIDList.find((function(e){return e[0]===a.latestShare.polynomialID}))){e.next=21;break}if(r){e.next=20;break}throw S.default("TKey SDK metadata seems to be outdated because shareIndex: "+"".concat(a.latestShare.share.shareIndex.toString("hex")," has a more recent metadata. Please call updateSDK first"));case 20:this.metadata=a.shareMetadata;case 21:a.latestShare.polynomialID in this.shares||(this.shares[a.latestShare.polynomialID]={}),this.shares[a.latestShare.polynomialID][a.latestShare.share.shareIndex.toString("hex")]=a.latestShare;case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"outputShareStore",value:function(e,t){if(!this.metadata)throw S.metadataUndefined();var r,n;if("number"===typeof e?r=new(w())(e):w().isBN(e)?r=e:"string"===typeof e&&(r=new(w())(e,"hex")),n=t||this.metadata.getLatestPublicPolynomial().getPolynomialID(),!this.metadata.getShareIndexesForPolynomial(n).includes(r.toString("hex")))throw new S(1002,"no such share index created");var i=this.shares[n][r.toString("hex")];if(i)return i;var a=this.reconstructLatestPoly().generateShares([r]);return new v.$O(a[r.toString("hex")],n)}},{key:"_setKey",value:function(e){this.privKey=e}},{key:"getCurrentShareIndexes",value:function(){if(!this.metadata)throw S.metadataUndefined();var e=this.metadata.getLatestPublicPolynomial().getPolynomialID();return Object.keys(this.shares[e])}},{key:"getKeyDetails",value:function(){if(!this.metadata)throw S.metadataUndefined();var e=this.metadata.getLatestPublicPolynomial(),t=e.getPolynomialID(),r=e.getThreshold()-Object.keys(this.shares[t]).length,n=this.metadata.getShareDescription();if(n){var i=this.metadata.getShareIndexesForPolynomial(t);n=Object.keys(n).reduce((function(e,t){return i.indexOf(t)>=0&&(e[t]=n[t]),e}),{})}return{pubKey:this.metadata.pubKey,requiredShares:r,threshold:e.getThreshold(),totalShares:this.metadata.getShareIndexesForPolynomial(t).length,shareDescriptions:n}}},{key:"generateAuthMetadata",value:function(e){for(var t=e.input,r=[],n=0;n<t.length;n+=1)r.push(new N(t[n],this.privKey));return r}},{key:"setAuthMetadata",value:function(e){var t=e.input,r=e.serviceProvider,n=e.privKey,i=new N(t,this.privKey);return this.storageLayer.setMetadata({input:i,serviceProvider:r,privKey:n})}},{key:"setAuthMetadataBulk",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.privKey){e.next=2;break}throw S.privateKeyUnavailable();case 2:for(r=t.input,n=t.serviceProvider,a=t.privKey,o=[],s=0;s<r.length;s+=1)o.push(new N(r[s],this.privKey));return e.next=7,this.addLocalMetadataTransitions({input:o,serviceProvider:n,privKey:a});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAuthMetadata",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGenericMetadataWithTransitionStates(L(L({},t),{},{fromJSONConstructor:N}));case 2:return r=e.sent,n=r,e.abrupt("return",n.metadata);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGenericMetadataWithTransitionStates",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.serviceProvider&&"0"!==t.serviceProvider.postboxKey.toString("hex")||t.privKey){e.next=2;break}throw S.default("require either serviceProvider or priv key in getGenericMetadataWithTransitionStates");case 2:if(!t.includeLocalMetadataTransitions){e.next=8;break}for(r=t._localMetadataTransitions?t._localMetadataTransitions:this._localMetadataTransitions,n=null,a=r[0].length-1;a>=0;a-=1)o=r[0][a],(t.privKey&&o&&0===o.cmp(t.privKey)||t.serviceProvider&&!o)&&(n=a);if(null===n){e.next=8;break}return e.abrupt("return",r[1][n]);case 8:return e.prev=8,e.next=11,this.storageLayer.getMetadata(t);case 11:s=e.sent,e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),S.metadataGetFailed("".concat((0,v.TV)(e.t0)));case 17:if(s.message!==v.J_){e.next=19;break}throw S.fromCode(1308);case 19:return e.abrupt("return",t.fromJSONConstructor.fromJSON(s));case 20:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"acquireWriteMetadataLock",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.haveWriteMetadataLock){e.next=2;break}return e.abrupt("return",this.metadata.nonce);case 2:if(this.privKey){e.next=4;break}throw S.privateKeyUnavailable();case 4:return r=this.lastFetchedCloudMetadata.getLatestPublicPolynomial().getPolynomialID(),n=Object.keys(this.shares[r]),a=n[Math.floor(Math.random()*(n.length-1))],t=n.length>=1?this.shares[r][a]:this.outputShareStore(a,r),e.next=10,this.catchupToLatestShare({shareStore:t});case 10:if(o=e.sent,!((s=o.shareMetadata).nonce>this.lastFetchedCloudMetadata.nonce)){e.next=16;break}throw S.acquireLockFailed("unable to acquire write access for metadata due to \n      lastFetchedCloudMetadata (".concat(this.lastFetchedCloudMetadata.nonce,")\n           being lower than last written metadata nonce (").concat(s.nonce,"). perhaps update metadata SDK (create new tKey and init)"));case 16:if(!(s.nonce<this.lastFetchedCloudMetadata.nonce)){e.next=18;break}throw S.acquireLockFailed("unable to acquire write access for metadata due to \n      lastFetchedCloudMetadata (".concat(this.lastFetchedCloudMetadata.nonce,")\n      being higher than last written metadata nonce (").concat(s.nonce,"). this should never happen as it \n      should only ever be updated by getting metadata)"));case 18:return e.next=20,this.storageLayer.acquireWriteLock({privKey:this.privKey});case 20:if(1===(c=e.sent).status){e.next=23;break}throw S.acquireLockFailed("lock cannot be acquired from storage layer status code: ".concat(c.status));case 23:return this.haveWriteMetadataLock=c.id,e.abrupt("return",this.metadata.nonce);case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"releaseWriteMetadataLock",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.haveWriteMetadataLock){e.next=2;break}throw S.releaseLockFailed("releaseWriteMetadataLock - don't have metadata lock to release");case 2:return e.next=4,this.storageLayer.releaseWriteLock({privKey:this.privKey,id:this.haveWriteMetadataLock});case 4:if(1===(t=e.sent).status){e.next=7;break}throw S.releaseLockFailed("lock cannot be released from storage layer status code: ".concat(t.status));case 7:this.haveWriteMetadataLock="";case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_syncShareMetadata",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:return r=this.getAllShareStoresForLatestPolynomial().map((function(e){return e.share.share})),e.next=5,this.syncMultipleShareMetadata(r,t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncMultipleShareMetadata",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,o,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:return this.metadata.nonce+=1,n=t.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.metadata.clone(),e.prev=1,e.next=4,s.getAuthMetadata({privKey:t,includeLocalMetadataTransitions:!0});case 4:a=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),S.authMetadataGetUnavailable("".concat((0,v.TV)(e.t0)));case 10:return o=r?r(a.scopedStore):a.scopedStore,n.scopedStore=o,e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()),e.next=6,Promise.all(n);case 6:return o=e.sent,e.abrupt("return",this.setAuthMetadataBulk({input:o,privKey:t}));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_addRefreshMiddleware",value:function(e,t){this._refreshMiddleware[e]=t}},{key:"_addReconstructKeyMiddleware",value:function(e,t){this._reconstructKeyMiddleware[e]=t}},{key:"_addShareSerializationMiddleware",value:function(e,t){this._shareSerializationMiddleware={serialize:e,deserialize:t}}},{key:"_setDeviceStorage",value:function(e){if(this.storeDeviceShare)throw S.default("storeDeviceShare already set");this.storeDeviceShare=e}},{key:"addShareDescription",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(this.metadata.addShareDescription(t,r),!n){e.next=6;break}return e.next=6,this._syncShareMetadata();case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteShareDescription",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(this.metadata.deleteShareDescription(t,r),!n){e.next=6;break}return e.next=6,this._syncShareMetadata();case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"updateShareDescription",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(this.metadata.updateShareDescription(t,r,n),!a){e.next=6;break}return e.next=6,this._syncShareMetadata();case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"encrypt",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.privKey){e.next=2;break}throw S.privateKeyUnavailable();case 2:return e.abrupt("return",(0,v.HI)((0,v.W)(this.privKey),t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.privKey){e.next=2;break}throw S.privateKeyUnavailable();case 2:return e.abrupt("return",(0,v.pe)((0,v.Kx)(this.privKey),t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTKeyStoreItem",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,o,s,c,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:return n=this.metadata.getTkeyStoreDomain(t)||[],e.next=5,Promise.all(n.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.decrypt(t);case 2:return r=e.sent,e.abrupt("return",JSON.parse(r.toString()));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return o=e.sent,e.next=8,this.encrypt(x.from(y()(r)));case 8:return s=e.sent,(c=o.findIndex((function(e){return e.id===r.id})))>-1?n[c]=s:n.push(s),this.metadata.setTkeyStoreDomain(t,n),e.next=14,this._syncShareMetadata();case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_deleteTKeyStoreItem",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,o,s,c=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:return n=this.metadata.getTkeyStoreDomain(t)||[],e.next=5,Promise.all(n.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.decrypt(t);case 2:return r=e.sent,e.abrupt("return",JSON.parse(r.toString()));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return o=e.sent,s=o.filter((function(e){return e.id!==r})),this.metadata.setTkeyStoreDomain(t,s),e.next=10,this._syncShareMetadata();case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getTKeyStore",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,o=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:return r=this.metadata.getTkeyStoreDomain(t)||[],e.next=5,Promise.all(r.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.decrypt(t);case 2:return r=e.sent,e.abrupt("return",JSON.parse(r.toString()));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTKeyStoreItem",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,o,s,c=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:return n=this.metadata.getTkeyStoreDomain(t)||[],e.next=5,Promise.all(n.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.decrypt(t);case 2:return r=e.sent,e.abrupt("return",JSON.parse(r.toString()));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return o=e.sent,s=o.find((function(e){return e.id===r})),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"outputShare",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.outputShareStore(t).share.share,r){e.next=3;break}return e.abrupt("return",n);case 3:return e.abrupt("return",this._shareSerializationMiddleware.serialize(n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"inputShare",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(r){e.next=6;break}n=this.metadata.shareToShareStore(t),e.next=10;break;case 6:return e.next=8,this._shareSerializationMiddleware.deserialize(t,r);case 8:a=e.sent,n=this.metadata.shareToShareStore(a);case 10:if(o=this.metadata.getLatestPublicPolynomial(),s=o.getPolynomialID(),this.metadata.getShareIndexesForPolynomial(s).includes(n.share.shareIndex.toString("hex"))){e.next=15;break}throw S.default("Latest poly doesn't include this share");case 15:return e.next=17,this.inputShareStoreSafe(n);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return{shares:this.shares,enableLogging:this.enableLogging,privKey:this.privKey?this.privKey.toString("hex"):void 0,metadata:this.metadata,lastFetchedCloudMetadata:this.lastFetchedCloudMetadata,_localMetadataTransitions:this._localMetadataTransitions,manualSync:this.manualSync,serviceProvider:this.serviceProvider,storageLayer:this.storageLayer}}},{key:"getAllShareStoresForLatestPolynomial",value:function(){var e=this,t=this.metadata.getLatestPublicPolynomial(),r=t.getPolynomialID(),n=this.metadata.getShareIndexesForPolynomial(r),i=t.getThreshold(),a=[],o=Object.keys(this.shares[r]);if(o.length<i)throw S.unableToReconstruct("not enough shares for polynomial reconstruction");for(var s=0;s<i;s+=1)a.push(new v.E9(new(w())(o[s],"hex"),this.shares[r][o[s]].share.share));var c=P(a).generateShares(n);return n.map((function(t){return e.metadata.shareToShareStore(c[t].share)}))}},{key:"CRITICAL_deleteTkey",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metadata){e.next=2;break}throw S.metadataUndefined();case 2:if(this.privKey){e.next=4;break}throw S.privateKeyUnavailable();case 4:if(!(this._localMetadataTransitions[0].length>0||this._localMetadataTransitions[1].length>0)){e.next=6;break}throw S.default("Please sync all local state before calling this function");case 6:return t=this.getAllShareStoresForLatestPolynomial(),e.next=9,this.addLocalMetadataTransitions({input:[].concat((0,h.Z)(Array(t.length).fill({message:v.J_,dateAdded:Date.now()})),[{message:v.yu}]),privKey:[].concat((0,h.Z)(t.map((function(e){return e.share.share}))),[void 0])});case 9:return e.next=11,this.syncLocalMetadataTransitions();case 11:this.privKey=void 0,this.metadata=void 0,this.shares={},this.lastFetchedCloudMetadata=void 0;case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getApi",value:function(){return{getMetadata:this.getMetadata.bind(this),getStorageLayer:this.getStorageLayer.bind(this),initialize:this.initialize.bind(this),catchupToLatestShare:this.catchupToLatestShare.bind(this),_syncShareMetadata:this._syncShareMetadata.bind(this),_addRefreshMiddleware:this._addRefreshMiddleware.bind(this),_addReconstructKeyMiddleware:this._addReconstructKeyMiddleware.bind(this),_addShareSerializationMiddleware:this._addShareSerializationMiddleware.bind(this),addShareDescription:this.addShareDescription.bind(this),generateNewShare:this.generateNewShare.bind(this),inputShareStore:this.inputShareStore.bind(this),inputShareStoreSafe:this.inputShareStoreSafe.bind(this),outputShareStore:this.outputShareStore.bind(this),inputShare:this.inputShare.bind(this),outputShare:this.outputShare.bind(this),_setDeviceStorage:this._setDeviceStorage.bind(this),encrypt:this.encrypt.bind(this),decrypt:this.decrypt.bind(this),getTKeyStore:this.getTKeyStore.bind(this),getTKeyStoreItem:this.getTKeyStoreItem.bind(this),_setTKeyStoreItem:this._setTKeyStoreItem.bind(this),_deleteTKeyStoreItem:this._deleteTKeyStoreItem.bind(this),deleteShare:this.deleteShare.bind(this)}}},{key:"setModuleReferences",value:function(){var e=this;Object.keys(this.modules).map((function(t){return e.modules[t].setModuleReferences(e.getApi())}))}},{key:"initializeModules",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(Object.keys(this.modules).map((function(e){return t.modules[e].initialize()}))));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromJSON",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,n){var a,o,s,c,u,l,f,d,h,p,m,g,b,k,x,O,_,Z,P,E,M,T,A,L,j,C,R,D;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(b in a=r.enableLogging,o=r.privKey,s=r.metadata,c=r.shares,u=r._localMetadataTransitions,l=r.manualSync,f=r.lastFetchedCloudMetadata,d=r.serverTimeOffset,h=n.storageLayer,p=n.serviceProvider,m=n.modules,g=new e({enableLogging:a,storageLayer:h,serviceProvider:p,modules:m,manualSync:l,serverTimeOffset:d}),o&&(g.privKey=new(w())(o,"hex")),c)if(Object.prototype.hasOwnProperty.call(c,b))for(x in k=c[b])Object.prototype.hasOwnProperty.call(k,x)&&(O=k[x],k[x]=v.$O.fromJSON(O));if(g.shares=c,_=Object.keys(JSON.parse(y()(new N(new I(new v.E9("0","0")),new(w())("0","hex"))))),Z=Object.keys(JSON.parse(y()(new v.$O(new v.mB("0","0"),"")))),P={message:"Sample message",dateAdded:Date.now()},E=Object.keys(P),M=[],T=[],u[0].forEach((function(e,t){e?M.push(new(w())(e,"hex")):M.push(void 0);var r=Object.keys(u[1][t]);if(r.length===_.length&&r.every((function(e){return _.includes(e)}))){var n=N.fromJSON(u[1][t]);n.privKey=o,T.push(n)}else if(r.length===Z.length&&r.every((function(e){return Z.includes(e)})))T.push(v.$O.fromJSON(u[1][t]));else{if(r.length!==E.length||!r.every((function(e){return E.includes(e)})))throw S.default("fromJSON failed. Could not deserialise _localMetadataTransitions");T.push(u[1][t])}})),!s&&!f){t.next=21;break}return"0"===g.serviceProvider.postboxKey.toString("hex")&&(C=I.fromJSON(f).getLatestPublicPolynomial().getPolynomialID(),R=Object.keys(c[C]),D=R[Math.floor(Math.random()*(R.length-1))],R.length>=1&&(j=c[C][D])),s&&(A=I.fromJSON(s)),f&&(L=I.fromJSON(f)),t.next=19,g.initialize({neverInitializeNewKey:!0,transitionMetadata:A,previouslyFetchedCloudMetadata:L,previousLocalMetadataTransitions:[M,T],withShare:j});case 19:t.next=23;break;case 21:return t.next=23,g.initialize({neverInitializeNewKey:!0});case 23:return t.abrupt("return",g);case 24:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}]),e}(),C=r(80080).Buffer,R=function(){function e(t){(0,s.Z)(this,e);var r=t.enableLogging,n=void 0!==r&&r,i=t.postboxKey;(0,o.Z)(this,"enableLogging",void 0),(0,o.Z)(this,"postboxKey",void 0),(0,o.Z)(this,"serviceProviderName",void 0),this.enableLogging=n,this.postboxKey=new(w())(i,"hex"),this.serviceProviderName="ServiceProviderBase"}return(0,c.Z)(e,[{key:"encrypt",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.retrievePubKey("ecc"),e.abrupt("return",(0,v.HI)(r,t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.pe)((0,v.Kx)(this.postboxKey),t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"retrievePubKeyPoint",value:function(){return(0,v.nK)(this.postboxKey).getPublic()}},{key:"retrievePubKey",value:function(e){if("ecc"===e)return(0,v.W)(this.postboxKey);throw new Error("Unsupported pub key type")}},{key:"sign",value:function(e){var t=new(w())(e,"hex"),r=(0,v.nK)(this.postboxKey).sign(t.toString("hex"));return C.from(r.r.toString(16,64)+r.s.toString(16,64)+new(w())(0).toString(16,2),"hex").toString("base64")}},{key:"toJSON",value:function(){return{enableLogging:this.enableLogging,postboxKey:this.postboxKey.toString("hex"),serviceProviderName:this.serviceProviderName}}}],[{key:"fromJSON",value:function(t){var r=t.enableLogging,n=t.postboxKey;if("ServiceProviderBase"===t.serviceProviderName)return new e({enableLogging:r,postboxKey:n})}}]),e}(),D=r(745),K=r(23680),F=r(98368),U=r(75509),B=r.n(U),q=r(91421),z=r(95304),J=r.n(z),H=r(20491),W=r.n(H);Promise.resolve(!1),Promise.resolve(!0);var Y=Promise.resolve();function V(e,t){return e||(e=0),new Promise((function(r){return setTimeout((function(){return r(t)}),e)}))}function X(){return Math.random().toString(36).substring(2)}var G=0,$=0;function Q(){var e=(new Date).getTime();return e===G?1e3*e+ ++$:(G=e,$=0,1e3*e)}var ee=W().getLogger("broadcast-channel");ee.setLevel("error");var te={create:function(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),Y}catch(r){return Promise.reject(r)}},canBeUsed:function(e){if("undefined"===typeof window)return!1;if(!e.support3PC)return!1;if("function"===typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:Q},re=function(){function e(e){this.ttl=e,this.map=new Map,this._to=!1}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.add=function(e){var t=this;this.map.set(e,ne()),this._to||(this._to=!0,setTimeout((function(){t._to=!1,function(e){var t=ne()-e.ttl,r=e.map[Symbol.iterator]();for(;;){var n=r.next().value;if(!n)return;var i=n[0];if(!(n[1]<t))return;e.map.delete(i)}}(t)}),0))},e.prototype.clear=function(){this.map.clear()},e}();function ne(){return(new Date).getTime()}function ie(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return"undefined"===typeof t.support3PC&&(t.support3PC=function(){if("undefined"===typeof navigator)return!1;var e=J().parse(navigator.userAgent);ee.info(JSON.stringify(e),"current browser info");var t=!0;return navigator.brave&&(t=!1),e.engine.name!==J().ENGINE_MAP.WebKit&&e.engine.name!==J().ENGINE_MAP.Gecko||(t=!1),t}()),"undefined"===typeof t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"===typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),t.server||(t.server={}),t.server.url||(t.server.url="https://broadcast-server.tor.us"),t.server.removeTimeout||(t.server.removeTimeout=3e5),e.methods&&(t.methods=e.methods),t}var ae="pubkey.broadcast-channel-0-",oe="messages",se={durability:"relaxed"};function ce(){if("undefined"!==typeof indexedDB)return indexedDB;if("undefined"!==typeof window){if("undefined"!==typeof window.mozIndexedDB)return window.mozIndexedDB;if("undefined"!==typeof window.webkitIndexedDB)return window.webkitIndexedDB;if("undefined"!==typeof window.msIndexedDB)return window.msIndexedDB}return!1}function ue(e){e.commit&&e.commit()}function le(e,t){var r=e.transaction(oe,"readonly",se),n=r.objectStore(oe),i=[],a=IDBKeyRange.bound(t+1,1/0);if(n.getAll){var o=n.getAll(a);return new Promise((function(e,t){o.onerror=function(e){return t(e)},o.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,o){var s=function(){try{return a=IDBKeyRange.bound(t+1,1/0),n.openCursor(a)}catch(e){return n.openCursor()}}();s.onerror=function(e){return o(e)},s.onsuccess=function(n){var a=n.target.result;a?a.value.id<t+1?a.continue(t+1):(i.push(a.value),a.continue()):(ue(r),e(i))}}))}function fe(e,t){return function(e,t){var r=(new Date).getTime()-t,n=e.transaction(oe,"readonly",se),i=n.objectStore(oe),a=[];return new Promise((function(e){i.openCursor().onsuccess=function(t){var i=t.target.result;if(i){var o=i.value;if(!(o.time<r))return ue(n),void e(a);a.push(o),i.continue()}else e(a)}}))}(e,t).then((function(t){return function(e,t){var r=e.transaction([oe],"readwrite",se).objectStore(oe);return Promise.all(t.map((function(e){var t=r.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}(e,t.map((function(e){return e.id})))}))}function de(e){e.closed||he(e).then((function(){return V(e.options.idb.fallbackInterval)})).then((function(){return de(e)}))}function he(e){return e.closed?Y:e.messagesCallback?le(e.db,e.lastCursorId).then((function(t){var r=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return e.uuid!==t.uuid&&!t.eMIs.has(e.id)&&!(e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return r.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),Y})):Y}var pe={create:function(e,t){return t=ie(t),function(e){var t=ce(),r=ae+e,n=t.open(r);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(oe,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}(e).then((function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:X(),eMIs:new re(2*t.idb.ttl),writeBlockPromise:Y,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},de(n),n}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,he(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,r){var n={uuid:t,time:(new Date).getTime(),data:r},i=e.transaction([oe],"readwrite",se);return new Promise((function(e,t){i.oncomplete=function(){return e()},i.onerror=function(e){return t(e)},i.objectStore(oe).add(n),ue(i)}))}(e.db,e.uuid,t)})).then((function(){var t,r;0===(t=0,r=10,Math.floor(Math.random()*(r-t+1)+t))&&fe(e.db,e.options.idb.ttl)})),e.writeBlockPromise},canBeUsed:function(e){return!!e.support3PC&&!!ce()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:Q},ve="pubkey.broadcastChannel-";function me(){var e;if("undefined"===typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(t){}return e}function ge(e){return ve+e}function ye(e){if(!e.support3PC)return!1;var t=me();if(!t)return!1;try{var r="__broadcastchannel_check";t.setItem(r,"works"),t.removeItem(r)}catch(n){return!1}return!0}var be={create:function(e,t){if(!ye(t=ie(t)))throw new Error("BroadcastChannel: localstorage cannot be used");var r=X(),n=new re(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:n};return i.listener=function(e,t){var r=ge(e),n=function(e){e.key===r&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",n),n}(e,(function(e){i.messagesCallback&&e.uuid!==r&&e.token&&!n.has(e.token)&&(e.data.time&&e.data.time<i.messagesCallbackTime||(n.add(e.token),i.messagesCallback(e.data)))})),i},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(r){V().then((function(){var n=ge(e.channelName),i={token:X(),time:(new Date).getTime(),data:t,uuid:e.uuid},a=JSON.stringify(i);me().setItem(n,a);var o=document.createEvent("Event");o.initEvent("storage",!0,!0),o.key=n,o.newValue=a,window.dispatchEvent(o),r()}))}))},canBeUsed:ye,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:Q},we=r(88047),ke=r.n(we),xe=r(17204),Se=Object.create(null);Se.open="0",Se.close="1",Se.ping="2",Se.pong="3",Se.message="4",Se.upgrade="5",Se.noop="6";var Oe=Object.create(null);Object.keys(Se).forEach((function(e){Oe[Se[e]]=e}));var _e,Ze={type:"error",data:"parser error"},Pe="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Ee="function"===typeof ArrayBuffer,Me=function(e){return"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},Te=function(e,t,r){var n=e.type,i=e.data;return Pe&&i instanceof Blob?t?r(i):Ie(i,r):Ee&&(i instanceof ArrayBuffer||Me(i))?t?r(i):Ie(new Blob([i]),r):r(Se[n]+(i||""))},Ie=function(e,t){var r=new FileReader;return r.onload=function(){var e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function Ne(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var Ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Le="undefined"===typeof Uint8Array?[]:new Uint8Array(256),je=0;je<64;je++)Le[Ae.charCodeAt(je)]=je;var Ce,Re="function"===typeof ArrayBuffer,De=function(e,t){if("string"!==typeof e)return{type:"message",data:Fe(e,t)};var r=e.charAt(0);return"b"===r?{type:"message",data:Ke(e.substring(1),t)}:Oe[r]?e.length>1?{type:Oe[r],data:e.substring(1)}:{type:Oe[r]}:Ze},Ke=function(e,t){if(Re){var r=function(e){var t,r,n,i,a,o=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),l=new Uint8Array(u);for(t=0;t<s;t+=4)r=Le[e.charCodeAt(t)],n=Le[e.charCodeAt(t+1)],i=Le[e.charCodeAt(t+2)],a=Le[e.charCodeAt(t+3)],l[c++]=r<<2|n>>4,l[c++]=(15&n)<<4|i>>2,l[c++]=(3&i)<<6|63&a;return u}(e);return Fe(r,t)}return{base64:!0,data:e}},Fe=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},Ue=String.fromCharCode(30);function Be(e){if(e)return function(e){for(var t in Be.prototype)e[t]=Be.prototype[t];return e}(e)}Be.prototype.on=Be.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Be.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},Be.prototype.off=Be.prototype.removeListener=Be.prototype.removeAllListeners=Be.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},Be.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},Be.prototype.emitReserved=Be.prototype.emit,Be.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Be.prototype.hasListeners=function(e){return!!this.listeners(e).length};var qe="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function ze(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce((function(t,r){return e.hasOwnProperty(r)&&(t[r]=e[r]),t}),{})}var Je=qe.setTimeout,He=qe.clearTimeout;function We(e,t){t.useNativeTimers?(e.setTimeoutFn=Je.bind(qe),e.clearTimeoutFn=He.bind(qe)):(e.setTimeoutFn=qe.setTimeout.bind(qe),e.clearTimeoutFn=qe.clearTimeout.bind(qe))}var Ye,Ve=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i){var a;return(0,s.Z)(this,r),(a=t.call(this,e)).description=n,a.context=i,a.type="TransportError",a}return(0,c.Z)(r)}((0,xe.Z)(Error)),Xe=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this)).writable=!1,We((0,p.Z)(n),e),n.opts=e,n.query=e.query,n.socket=e.socket,n}return(0,c.Z)(r,[{key:"onError",value:function(e,t,n){return(0,u.Z)((0,l.Z)(r.prototype),"emitReserved",this).call(this,"error",new Ve(e,t,n)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,(0,u.Z)((0,l.Z)(r.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=De(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){(0,u.Z)((0,l.Z)(r.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",(0,u.Z)((0,l.Z)(r.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}]),r}(Be),Ge="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),$e=64,Qe={},et=0,tt=0;function rt(e){var t="";do{t=Ge[e%$e]+t,e=Math.floor(e/$e)}while(e>0);return t}function nt(){var e=rt(+new Date);return e!==Ye?(et=0,Ye=e):e+"."+rt(et++)}for(;tt<$e;tt++)Qe[Ge[tt]]=tt;var it=!1;try{it="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Ki){}var at=it;function ot(e){var t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||at))return new XMLHttpRequest}catch(r){}if(!t)try{return new(qe[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(r){}}function st(){}var ct=null!=new ot({xdomain:!1}).responseType,ut=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;if((0,s.Z)(this,r),(n=t.call(this,e)).polling=!1,"undefined"!==typeof location){var i="https:"===location.protocol,a=location.port;a||(a=i?"443":"80"),n.xd="undefined"!==typeof location&&e.hostname!==location.hostname||a!==e.port}var o=e&&e.forceBase64;return n.supportsBinary=ct&&!o,n.opts.withCredentials&&(n.cookieJar=void 0),n}return(0,c.Z)(r,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var r=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var n=0;this.polling&&(n++,this.once("pollComplete",(function(){--n||r()}))),this.writable||(n++,this.once("drain",(function(){--n||r()})))}else r()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var r=e.split(Ue),n=[],i=0;i<r.length;i++){var a=De(r[i],t);if(n.push(a),"error"===a.type)break}return n})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var r=e.length,n=new Array(r),i=0;e.forEach((function(e,a){Te(e,!1,(function(e){n[a]=e,++i===r&&t(n.join(Ue))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emitReserved("drain")}))}))}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=nt()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new lt(this.uri(),e)}},{key:"doWrite",value:function(e,t){var r=this,n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(function(e,t){r.onError("xhr post error",e,t)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,r){e.onError("xhr poll error",t,r)})),this.pollXhr=t}}]),r}(Xe),lt=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),i=t.call(this),We((0,p.Z)(i),n),i.opts=n,i.method=n.method||"GET",i.uri=e,i.data=void 0!==n.data?n.data:null,i.create(),i}return(0,c.Z)(r,[{key:"create",value:function(){var e,t=this,n=ze(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;var i=this.xhr=new ot(n);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var a in i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(a)&&i.setRequestHeader(a,this.opts.extraHeaders[a])}catch(o){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(o){}try{i.setRequestHeader("Accept","*/*")}catch(o){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=function(){var e;3===i.readyState&&(null===(e=t.opts.cookieJar)||void 0===e||e.parseCookies(i)),4===i.readyState&&(200===i.status||1223===i.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"===typeof i.status?i.status:0)}),0))},i.send(this.data)}catch(o){return void this.setTimeoutFn((function(){t.onError(o)}),0)}"undefined"!==typeof document&&(this.index=r.requestsCount++,r.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=st,e)try{this.xhr.abort()}catch(t){}"undefined"!==typeof document&&delete r.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),r}(Be);if(lt.requestsCount=0,lt.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",ft);else if("function"===typeof addEventListener){addEventListener("onpagehide"in qe?"pagehide":"unload",ft,!1)}function ft(){for(var e in lt.requests)lt.requests.hasOwnProperty(e)&&lt.requests[e].abort()}var dt="function"===typeof Promise&&"function"===typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},ht=qe.WebSocket||qe.MozWebSocket,pt=(r(80080).Buffer,"undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()),vt=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).supportsBinary=!e.forceBase64,n}return(0,c.Z)(r,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,r=pt?{}:ze(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=pt?new ht(e,t,r):t?new ht(e,t):new ht(e)}catch(Ki){return this.emitReserved("error",Ki)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var r=function(){var r=e[n],i=n===e.length-1;Te(r,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(r){}i&&dt((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},n=0;n<e.length;n++)r()}},{key:"doClose",value:function(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=nt()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!ht}}]),r}(Xe);var mt=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,c.Z)(r,[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;"function"===typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this.transport.ready.then((function(){e.transport.createBidirectionalStream().then((function(t){var r,n=t.readable.getReader();e.writer=t.writable.getWriter();!function t(){n.read().then((function(n){var i=n.done,a=n.value;i||(r||1!==a.byteLength||54!==a[0]?(e.onPacket(function(e,t,r){Ce||(Ce=new TextDecoder);var n=t||e[0]<48||e[0]>54;return De(n?e:Ce.decode(e),r)}(a,r,"arraybuffer")),r=!1):r=!0,t())})).catch((function(e){}))}();var i=e.query.sid?'0{"sid":"'.concat(e.query.sid,'"}'):"0";e.writer.write((new TextEncoder).encode(i)).then((function(){return e.onOpen()}))}))})))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var r=function(){var r=e[n],i=n===e.length-1;!function(e,t){Pe&&e.data instanceof Blob?e.data.arrayBuffer().then(Ne).then(t):Ee&&(e.data instanceof ArrayBuffer||Me(e.data))?t(Ne(e.data)):Te(e,!1,(function(e){_e||(_e=new TextEncoder),t(_e.encode(e))}))}(r,(function(e){(function(e,t){return"message"===e.type&&"string"!==typeof e.data&&t[0]>=48&&t[0]<=54})(r,e)&&t.writer.write(Uint8Array.of(54)),t.writer.write(e).then((function(){i&&dt((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))}))},n=0;n<e.length;n++)r()}},{key:"doClose",value:function(){var e;null===(e=this.transport)||void 0===e||e.close()}}]),r}(Xe),gt={websocket:vt,webtransport:mt,polling:ut},yt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,bt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function wt(e){var t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));for(var i=yt.exec(e||""),a={},o=14;o--;)a[bt[o]]=i[o]||"";return-1!=r&&-1!=n&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){var r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,a.path),a.queryKey=function(e,t){var r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,a.query),a}var kt=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.Z)(this,r),(n=t.call(this)).writeBuffer=[],e&&"object"===typeof e&&(i=e,e=null),e?(e=wt(e),i.hostname=e.host,i.secure="https"===e.protocol||"wss"===e.protocol,i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=wt(i.host).host),We((0,p.Z)(n),i),n.secure=null!=i.secure?i.secure:"undefined"!==typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=n.secure?"443":"80"),n.hostname=i.hostname||("undefined"!==typeof location?location.hostname:"localhost"),n.port=i.port||("undefined"!==typeof location&&location.port?location.port:n.secure?"443":"80"),n.transports=i.transports||["polling","websocket","webtransport"],n.writeBuffer=[],n.prevBufferLen=0,n.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),n.opts.path=n.opts.path.replace(/\/$/,"")+(n.opts.addTrailingSlash?"/":""),"string"===typeof n.opts.query&&(n.opts.query=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var a=r[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}(n.opts.query)),n.id=null,n.upgrades=null,n.pingInterval=null,n.pingTimeout=null,n.pingTimeoutTimer=null,"function"===typeof addEventListener&&(n.opts.closeOnBeforeunload&&(n.beforeunloadEventListener=function(){n.transport&&(n.transport.removeAllListeners(),n.transport.close())},addEventListener("beforeunload",n.beforeunloadEventListener,!1)),"localhost"!==n.hostname&&(n.offlineEventListener=function(){n.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",n.offlineEventListener,!1))),n.open(),n}return(0,c.Z)(r,[{key:"createTransport",value:function(e){var t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new gt[e](r)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&r.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(e){return t.onClose("transport close",e)}))}},{key:"probe",value:function(e){var t=this,n=this.createTransport(e),i=!1;r.priorWebsocketSuccess=!1;var a=function(){i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(function(e){if(!i)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",n),!n)return;r.priorWebsocketSuccess="websocket"===n.name,t.transport.pause((function(){i||"closed"!==t.readyState&&(f(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))}else{var a=new Error("probe error");a.transport=n.name,t.emitReserved("upgradeError",a)}})))};function o(){i||(i=!0,f(),n.close(),n=null)}var s=function(e){var r=new Error("probe error: "+e);r.transport=n.name,o(),t.emitReserved("upgradeError",r)};function c(){s("transport closed")}function u(){s("socket closed")}function l(e){n&&e.name!==n.name&&o()}var f=function(){n.removeListener("open",a),n.removeListener("error",s),n.removeListener("close",c),t.off("close",u),t.off("upgrading",l)};n.once("open",a),n.once("error",s),n.once("close",c),this.once("close",u),this.once("upgrading",l),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){i||n.open()}),200):n.open()}},{key:"onOpen",value:function(){if(this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,r=0;r<this.writeBuffer.length;r++){var n=this.writeBuffer[r].data;if(n&&(t+="string"===typeof(e=n)?function(e){for(var t=0,r=0,n=0,i=e.length;n<i;n++)(t=e.charCodeAt(n))<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil(1.33*(e.byteLength||e.size))),r>0&&t>this.maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,r){return this.sendPacket("message",e,t,r),this}},{key:"send",value:function(e,t,r){return this.sendPacket("message",e,t,r),this}},{key:"sendPacket",value:function(e,t,r,n){if("function"===typeof t&&(n=t,t=void 0),"function"===typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},r=function r(){e.off("upgrade",r),e.off("upgradeError",r),t()},n=function(){e.once("upgrade",r),e.once("upgradeError",r)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?n():t()})):this.upgrading?n():t()),this}},{key:"onError",value:function(e){r.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],r=0,n=e.length;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}]),r}(Be);kt.protocol=4;kt.protocol;var xt="function"===typeof ArrayBuffer,St=function(e){return"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},Ot=Object.prototype.toString,_t="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Ot.call(Blob),Zt="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Ot.call(File);function Pt(e){return xt&&(e instanceof ArrayBuffer||St(e))||_t&&e instanceof Blob||Zt&&e instanceof File}function Et(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(var r=0,n=e.length;r<n;r++)if(Et(e[r]))return!0;return!1}if(Pt(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Et(e.toJSON(),!0);for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&Et(e[i]))return!0;return!1}function Mt(e){var t=[],r=e.data,n=e;return n.data=Tt(r,t),n.attachments=t.length,{packet:n,buffers:t}}function Tt(e,t){if(!e)return e;if(Pt(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){for(var n=new Array(e.length),i=0;i<e.length;i++)n[i]=Tt(e[i],t);return n}if("object"===typeof e&&!(e instanceof Date)){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(a[o]=Tt(e[o],t));return a}return e}function It(e,t){return e.data=Nt(e.data,t),delete e.attachments,e}function Nt(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]=Nt(e[r],t);else if("object"===typeof e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Nt(e[n],t));return e}var At,Lt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],jt=5;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(At||(At={}));var Ct=function(){function e(t){(0,s.Z)(this,e),this.replacer=t}return(0,c.Z)(e,[{key:"encode",value:function(e){return e.type!==At.EVENT&&e.type!==At.ACK||!Et(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===At.EVENT?At.BINARY_EVENT:At.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==At.BINARY_EVENT&&e.type!==At.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var t=Mt(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}]),e}();function Rt(e){return"[object Object]"===Object.prototype.toString.call(e)}var Dt=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this)).reviver=e,n}return(0,c.Z)(r,[{key:"add",value:function(e){var t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var n=(t=this.decodeString(e)).type===At.BINARY_EVENT;n||t.type===At.BINARY_ACK?(t.type=n?At.EVENT:At.ACK,this.reconstructor=new Kt(t),0===t.attachments&&(0,u.Z)((0,l.Z)(r.prototype),"emitReserved",this).call(this,"decoded",t)):(0,u.Z)((0,l.Z)(r.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!Pt(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,(0,u.Z)((0,l.Z)(r.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===At[n.type])throw new Error("unknown packet type "+n.type);if(n.type===At.BINARY_EVENT||n.type===At.BINARY_ACK){for(var i=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var a=e.substring(i,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(a)}if("/"===e.charAt(t+1)){for(var o=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(o,t)}else n.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var c=t+1;++t;){var u=e.charAt(t);if(null==u||Number(u)!=u){--t;break}if(t===e.length)break}n.id=Number(e.substring(c,t+1))}if(e.charAt(++t)){var l=this.tryParse(e.substr(t));if(!r.isPayloadValid(n.type,l))throw new Error("invalid payload");n.data=l}return n}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case At.CONNECT:return Rt(t);case At.DISCONNECT:return void 0===t;case At.CONNECT_ERROR:return"string"===typeof t||Rt(t);case At.EVENT:case At.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===Lt.indexOf(t[0]));case At.ACK:case At.BINARY_ACK:return Array.isArray(t)}}}]),r}(Be),Kt=function(){function e(t){(0,s.Z)(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return(0,c.Z)(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=It(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}();function Ft(e,t,r){return e.on(t,r),function(){e.off(t,r)}}var Ut=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Bt=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i){var a;return(0,s.Z)(this,r),(a=t.call(this)).connected=!1,a.recovered=!1,a.receiveBuffer=[],a.sendBuffer=[],a._queue=[],a._queueSeq=0,a.ids=0,a.acks={},a.flags={},a.io=e,a.nsp=n,i&&i.auth&&(a.auth=i.auth),a._opts=Object.assign({},i),a.io._autoConnect&&a.open(),a}return(0,c.Z)(r,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[Ft(e,"open",this.onopen.bind(this)),Ft(e,"packet",this.onpacket.bind(this)),Ft(e,"error",this.onerror.bind(this)),Ft(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Ut.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(r.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;var i={type:At.EVENT,data:r,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"===typeof r[r.length-1]){var a=this.ids++,o=r.pop();this._registerAckCallback(a,o),i.id=a}var s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var r,n=this,i=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0!==i){var a=this.io.setTimeoutFn((function(){delete n.acks[e];for(var r=0;r<n.sendBuffer.length;r++)n.sendBuffer[r].id===e&&n.sendBuffer.splice(r,1);t.call(n,new Error("operation has timed out"))}),i);this.acks[e]=function(){n.io.clearTimeoutFn(a);for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];t.apply(n,[null].concat(r))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(r,i){n.push((function(e,t){return a?e?i(e):r(t):r(e)})),t.emit.apply(t,[e].concat(n))}))}},{key:"_addToQueue",value:function(e){var t,r=this;"function"===typeof e[e.length-1]&&(t=e.pop());var n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(n===r._queue[0]){if(null!==e)n.tryCount>r._opts.retries&&(r._queue.shift(),t&&t(e));else if(r._queue.shift(),t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];t.apply(void 0,[null].concat(a))}return n.pending=!1,r._drainQueue()}})),this._queue.push(n),this._drainQueue()}},{key:"_drainQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.connected&&0!==this._queue.length){var t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:At.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case At.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case At.EVENT:case At.BINARY_EVENT:this.onevent(e);break;case At.ACK:case At.BINARY_ACK:this.onack(e);break;case At.DISCONNECT:this.ondisconnect();break;case At.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=this._anyListeners.slice(),i=(0,D.Z)(n);try{for(i.s();!(t=i.n()).done;){t.value.apply(this,e)}}catch(Ki){i.e(Ki)}finally{i.f()}}(0,u.Z)((0,l.Z)(r.prototype),"emit",this).apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,r=!1;return function(){if(!r){r=!0;for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];t.packet({type:At.ACK,id:e,data:i})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"===typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:At.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,r=this._anyOutgoingListeners.slice(),n=(0,D.Z)(r);try{for(n.s();!(t=n.n()).done;){t.value.apply(this,e.data)}}catch(Ki){n.e(Ki)}finally{n.f()}}}}]),r}(Be);function qt(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}qt.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},qt.prototype.reset=function(){this.attempts=0},qt.prototype.setMin=function(e){this.ms=e},qt.prototype.setMax=function(e){this.max=e},qt.prototype.setJitter=function(e){this.jitter=e};var zt=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,i){var a,o;(0,s.Z)(this,r),(a=t.call(this)).nsps={},a.subs=[],e&&"object"===typeof e&&(i=e,e=void 0),(i=i||{}).path=i.path||"/socket.io",a.opts=i,We((0,p.Z)(a),i),a.reconnection(!1!==i.reconnection),a.reconnectionAttempts(i.reconnectionAttempts||1/0),a.reconnectionDelay(i.reconnectionDelay||1e3),a.reconnectionDelayMax(i.reconnectionDelayMax||5e3),a.randomizationFactor(null!==(o=i.randomizationFactor)&&void 0!==o?o:.5),a.backoff=new qt({min:a.reconnectionDelay(),max:a.reconnectionDelayMax(),jitter:a.randomizationFactor()}),a.timeout(null==i.timeout?2e4:i.timeout),a._readyState="closed",a.uri=e;var c=i.parser||n;return a.encoder=new c.Encoder,a.decoder=new c.Decoder,a._autoConnect=!1!==i.autoConnect,a._autoConnect&&a.open(),a}return(0,c.Z)(r,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new kt(this.uri,this.opts);var r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;var i=Ft(r,"open",(function(){n.onopen(),e&&e()})),a=function(r){t.cleanup(),t._readyState="closed",t.emitReserved("error",r),e?e(r):t.maybeReconnectOnOpen()},o=Ft(r,"error",a);if(!1!==this._timeout){var s=this._timeout,c=this.setTimeoutFn((function(){i(),a(new Error("timeout")),r.close()}),s);this.opts.autoUnref&&c.unref(),this.subs.push((function(){t.clearTimeoutFn(c)}))}return this.subs.push(i),this.subs.push(o),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(Ft(e,"ping",this.onping.bind(this)),Ft(e,"data",this.ondata.bind(this)),Ft(e,"error",this.onerror.bind(this)),Ft(e,"close",this.onclose.bind(this)),Ft(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}},{key:"ondecoded",value:function(e){var t=this;dt((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Bt(this,e,t),this.nsps[e]=r),r}},{key:"_destroy",value:function(e){for(var t=0,r=Object.keys(this.nsps);t<r.length;t++){var n=r[t];if(this.nsps[n].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),r=0;r<t.length;r++)this.engine.write(t[r],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var r=this.backoff.duration();this._reconnecting=!0;var n=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(r){r?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",r)):t.onreconnect()})))}),r);this.opts.autoUnref&&n.unref(),this.subs.push((function(){e.clearTimeoutFn(n)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),r}(Be),Jt={};function Ht(e,t){"object"===typeof e&&(t=e,e=void 0);var r,n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=e;r=r||"undefined"!==typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof r?r.protocol+"//"+e:"https://"+e),n=wt(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+t,n.href=n.protocol+"://"+i+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),i=n.source,a=n.id,o=n.path,s=Jt[a]&&o in Jt[a].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||s?r=new zt(i,t):(Jt[a]||(Jt[a]=new zt(i,t)),r=Jt[a]),n.query&&!t.query&&(t.query=n.queryKey),r.socket(n.path,t)}Object.assign(Ht,{Manager:zt,Socket:Bt,io:Ht,connect:Ht});var Wt=r(80082),Yt=r(60107),Vt=r(80080).Buffer;function Xt(e){return Vt.from((0,Yt.wn)(e))}var Gt=new Wt.ec("secp256k1");function $t(e){return{iv:Vt.from(e.iv,"hex"),ephemPublicKey:Vt.from(e.ephemPublicKey,"hex"),ciphertext:Vt.from(e.ciphertext,"hex"),mac:Vt.from(e.mac,"hex")}}function Qt(e){return{iv:Vt.from(e.iv).toString("hex"),ephemPublicKey:Vt.from(e.ephemPublicKey).toString("hex"),ciphertext:Vt.from(e.ciphertext).toString("hex"),mac:Vt.from(e.mac).toString("hex")}}function er(e,t){return tr.apply(this,arguments)}function tr(){return(tr=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify(r),a=Vt.from(n,"utf-8"),e.next=4,(0,k.HI)((0,k.rc)(Vt.from(t,"hex")),a);case 4:return o=e.sent,s=Qt(o),c=JSON.stringify(s),e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rr(e,t){return nr.apply(this,arguments)}function nr(){return(nr=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s,c,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(r),a=$t(n),o=Gt.keyFromPrivate(t),e.next=5,(0,k.pe)(Vt.from(o.getPrivate().toString("hex",64),"hex"),a);case 5:return s=e.sent,c=s.toString("utf-8"),u=JSON.parse(c),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ir=r(80080).Buffer,ar=Q,or="pubkey.broadcastChannel-",sr=null,cr=new Set;function ur(e){return or+e}function lr(e,t,r){var n=function(e){if(sr)return sr;var t=Ht(e,{transports:["websocket","polling"],withCredentials:!0,reconnectionDelayMax:1e4,reconnectionAttempts:10});return t.on("connect_error",(function(e){t.io.opts.transports=["polling","websocket"],ee.error("connect error",e)})),t.on("connect",(0,a.Z)(ke().mark((function e(){var r;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.io.engine,ee.debug("initially connected to",r.transport.name),r.once("upgrade",(function(){ee.debug("upgraded",r.transport.name)})),r.once("close",(function(e){ee.debug("connection closed",e)}));case 4:case"end":return e.stop()}}),e)})))),t.on("error",(function(e){ee.error("socket errored",e),t.disconnect()})),sr=t,t}(e),i=ur(t),o=Xt(ir.from(i,"utf8")),s=(0,k.rc)(o).toString("hex");n.connected?n.emit("check_auth_status",s):n.once("connect",(function(){ee.debug("connected with socket"),n.emit("check_auth_status",s)}));var c=function(){n.once("connect",(0,a.Z)(ke().mark((function e(){return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.emit("check_auth_status",s);case 1:case"end":return e.stop()}}),e)}))))},u=function(){var e=(0,a.Z)(ke().mark((function e(t){var n;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,rr(o.toString("hex"),t);case 3:n=e.sent,ee.info(n),r(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),ee.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}();return n.on("disconnect",(function(){ee.debug("socket disconnected"),cr.has(t)&&(ee.error("socket disconnected unexpectedly, reconnecting socket"),c())})),n.on(s+"_success",u),"undefined"!==typeof document&&document.addEventListener("visibilitychange",(function e(){n?n.connected||"visible"!==document.visibilityState||c():document.removeEventListener("visibilitychange",e)})),n}function fr(){return!0}var dr={create:function(e,t){t=ie(t);var r={channelName:e,uuid:X(),eMIs:new re(t.server.removeTimeout),serverUrl:t.server.url};return t.server.timeout&&(r.timeout=t.server.timeout),lr(t.server.url,e,(function(e){r.messagesCallback&&e.uuid!==r.uuid&&e.token&&!r.eMIs.has(e.token)&&(r.eMIs.add(e.token),r.messagesCallback(e.data))})),cr.add(e),r},close:function(e){cr.delete(e.channelName)},onMessage:function(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(r,n){V().then((0,a.Z)(ke().mark((function i(){var a,o,s,c;return ke().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=ur(e.channelName),o=Xt(ir.from(a,"utf8")),i.next=4,er(o.toString("hex"),{token:X(),time:(new Date).getTime(),data:t,uuid:e.uuid});case 4:return s=i.sent,i.t0=(0,k.rc)(o).toString("hex"),i.t1=s,i.next=9,(0,k.Xx)(o,Xt(ir.from(s,"utf8")));case 9:return i.t2=i.sent.toString("hex"),c={key:i.t0,data:i.t1,signature:i.t2},e.timeout&&(c.timeout=e.timeout),i.abrupt("return",fetch(e.serverUrl+"/channel/set",{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(r).catch(n));case 13:case"end":return i.stop()}}),i)}))))}))},canBeUsed:fr,type:"server",averageResponseTime:function(){return 500},microSeconds:ar},hr=Q,pr=new Set;var vr={create:function(e){var t={name:e,messagesCallback:null};return pr.add(t),t},close:function(e){pr.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(r){return setTimeout((function(){Array.from(pr).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),r()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:hr},mr=[te,pe,be,dr];var gr,yr=new Set,br=0,wr=function(e,t){this.id=br++,yr.add(this),this.name=e,gr&&(t=gr),this.options=ie(t),this.method=function(e){var t=[].concat(e.methods,mr).filter(Boolean);if(e.type){if("simulate"===e.type)return vr;var r=t.find((function(t){return t.type===e.type}));if(r)return r;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((function(e){return"idb"!==e.type})));var n=t.find((function(t){return t.canBeUsed(e)}));if(n)return n;throw new Error("No useable method found in "+JSON.stringify(mr.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,function(e){var t=e.method.create(e.name,e.options);r=t,r&&"function"===typeof r.then?(e._prepP=t,t.then((function(t){e._state=t}))):e._state=t;var r}(this)};function kr(e,t,r){var n={time:e.method.microSeconds(),type:t,data:r};return(e._prepP?e._prepP:Y).then((function(){var t=e.method.postMessage(e._state,n);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function xr(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function Sr(e,t,r){e._addEL[t].push(r),function(e){if(!e._iL&&xr(e)){var t=function(t){e._addEL[t.type].forEach((function(r){var n=1e5,i=r.time-n;(t.time>=i||"server"===e.method.type)&&r.fn(t.data)}))},r=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,r)})):(e._iL=!0,e.method.onMessage(e._state,t,r))}}(e)}function Or(e,t,r){e._addEL[t]=e._addEL[t].filter((function(e){return e!==r})),function(e){if(e._iL&&!xr(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}wr._pubkey=!0,wr.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return kr(this,"message",e)},postInternal:function(e){return kr(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};Or(this,"message",this._onML),e&&"function"===typeof e?(this._onML=t,Sr(this,"message",t)):this._onML=null},addEventListener:function(e,t){Sr(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){Or(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){yr.delete(this),this.closed=!0;var t=this._prepP?this._prepP:Y;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var _r,Zr=r(41803),Pr=r(48888),Er=r(88902),Mr=(_r={},(0,o.Z)(_r,Er.at.SAPPHIRE_DEVNET,["https://sapphire-dev-2-1.authnetwork.dev","https://sapphire-dev-2-2.authnetwork.dev","https://sapphire-dev-2-3.authnetwork.dev","https://sapphire-dev-2-4.authnetwork.dev","https://sapphire-dev-2-5.authnetwork.dev"]),(0,o.Z)(_r,Er.at.SAPPHIRE_TESTNET,["https://lrc1.authnetwork.dev","https://lrc2.authnetwork.dev","https://lrc3.authnetwork.dev","https://lrc4.authnetwork.dev","https://lrc5.authnetwork.dev"]),(0,o.Z)(_r,Er.at.SAPPHIRE_MAINNET,["https://sapphire-1.auth.network","https://sapphire-2.auth.network","https://sapphire-3.auth.network","https://sapphire-4.auth.network","https://sapphire-5.auth.network"]),_r),Tr=function(e){var t=Mr[e];if(!t||0===t.length)throw new Error("Unsupported network: ".concat(e));return t.map((function(e){return"".concat(e,"/sss/jrpc")}))},Ir=function(e){var t=Mr[e];if(!t||0===t.length)throw new Error("Unsupported network: ".concat(e));return t.map((function(e){return"".concat(e,"/rss")}))},Nr=function(e){var t=Mr[e];if(!t||0===t.length)throw new Error("Unsupported network: ".concat(e));return t.map((function(e){return"".concat(e,"/tss")}))},Ar={currentEpoch:"19",torusNodeEndpoints:["https://torus-19.torusnode.com/jrpc","https://torus-node.ens.domains/jrpc","https://torus-node.matic.network/jrpc","https://torus.zilliqa.network/jrpc","https://torus-mainnet.cosmos.network/jrpc","https://torus2.etherscan.com/jrpc","https://torus-node-v2.skalelabs.com/jrpc","https://torus-node.binancex.dev/jrpc","https://torusnode.ont.io/jrpc"],torusIndexes:[1,2,3,4,5,6,7,8,9],torusNodePub:[{X:"bbe83c64177c3775550e6ba6ac2bc059f6847d644c9e4894e42c60d7974d8c2b",Y:"82b49a7caf70def38cdad2740af45c1e4f969650105c5019a29bb18b21a9acb5"},{X:"c208cac4ef9a47d386097a9c915b28e9cb89213abee8d26a17198ee261201b0d",Y:"c7db2fe4631109f40833de9dc78d07e35706549ee48fa557b33e4e75e1047873"},{X:"ca1766bb426d4ca5582818a0c5439d560ea64f5baa060793ab29dd3d0ceacfe",Y:"d46c1d08c40e1306e1bca328c2287b8268166b11a1ba4b8442ea2ad0c5e32152"},{X:"c3934dd2f6f4b3d2e1e398cc501e143c1e1a381b52feb6d1525af34d16253768",Y:"71f5141a5035799099f5ea3e241e66946bc55dc857ac3bd7d6fcdb8dcd3eeeef"},{X:"22e66f1929631d00bf026227581597f085fd94fd952fc0dca9f0833398b5c064",Y:"6088b3912e10a1e9d50355a609c10db7d188f16a2e2fd7357e51bf4f6a74f0a1"},{X:"9dc9fa410f3ce9eb70df70cdea00a49f2c4cc7a31c08c0dab5f863ed35ff5139",Y:"627a291cb87a75c61da3f65d6818e1e05e360217179817ed27e8c73bca7ec122"},{X:"118b9fc07e97b096d899b9f6658463ce6a8caa64038e37fc969df4e6023dd8c6",Y:"baf9fa4e51770f4796ea165dd03a769b8606681a38954a0a92c4cbffd6609ce9"},{X:"8a6d8b925da15a273dec3d8f8395ec35cd6878f274b2b180e4e106999db64043",Y:"96f67f870c157743da0b1eb84d89bf30500d74dc84c11f501ee1cb013acc8c46"},{X:"39cecb62e863729f572f7dfc46c24867981bf04bb405fed0df39e33984bfade5",Y:"61c2364434012e68a2be2e9952805037e52629d7762fafc8e10e9fb5bad8f790"}]},Lr={currentEpoch:"1",torusNodeEndpoints:Mr[Er.X_.SAPPHIRE_DEVNET],torusNodeSSSEndpoints:Tr(Er.X_.SAPPHIRE_DEVNET),torusNodeRSSEndpoints:Ir(Er.X_.SAPPHIRE_DEVNET),torusNodeTSSEndpoints:Nr(Er.X_.SAPPHIRE_DEVNET),torusIndexes:[1,2,3,4,5],torusNodePub:[{X:"f74389b0a4c8d10d2a687ae575f69b20f412d41ab7f1fe6b358aa14871327247",Y:"54e3a73098ed9bced3ef8821736e9794f9264a1420c0c7ad15d2fa617ba35ef7"},{X:"bc38813a6873e526087918507c78fc3a61624670ee851ecfb4f3bef55d027b5a",Y:"ac4b21229f662a0aefdfdac21cf17c3261a392c74a8790db218b34e3e4c1d56a"},{X:"b56541684ea5fa40c8337b7688d502f0e9e092098962ad344c34e94f06d293fb",Y:"759a998cef79d389082f9a75061a29190eec0cac99b8c25ddcf6b58569dad55c"},{X:"7bcb058d4c6ffc6ba4bfdfd93d141af35a66338a62c7c27cdad2ae3f8289b767",Y:"336ab1935e41ed4719e162587f0ab55518db4207a1eb36cc72303f1b86689d2b"},{X:"bf12a136ef94399ea098f926f04e26a4ec4ac70f69cce274e8893704c4951773",Y:"bdd44828020f52ce510e026338216ada184a6867eb4e19fb4c2d495d4a7e15e4"}]},jr={currentEpoch:"1",torusNodeEndpoints:Mr[Er.X_.SAPPHIRE_TESTNET],torusNodeSSSEndpoints:Tr(Er.X_.SAPPHIRE_TESTNET),torusNodeRSSEndpoints:Ir(Er.X_.SAPPHIRE_TESTNET),torusNodeTSSEndpoints:Nr(Er.X_.SAPPHIRE_TESTNET),torusIndexes:[1,2,3,4,5],torusNodePub:[{X:"d0e57d0fb29f37888a71c5d1d8312b191121b53e7e77968ca59e5c2ceee89386",Y:"2190e5e78c02ecdd4e5e04a01d3c12d847d53682ade7b6f715df1e1f3911081d"},{X:"69d4fcd1ab4dedc06ac0bafaccac8e5459275ec12a8b3feaef26646ece902e38",Y:"2319469c4344d78140ed9672c5231a0d045467dec66c77b53dfbefc56496ff3c"},{X:"9b0ea52ef5d8fc68e02b3ea242b2b11556ab5746b92779a7c4d61ff57c054710",Y:"0f9fc9e706e0a2d2b5c8511177583cdf5fa5379e2c3c1ed4db74aaded08b1a28"},{X:"e08bb1de0c017241be3c8e2ab3e788b64cb83d77ddd5517424626d1e3a4a5406",Y:"d4a87ae195e1f55fe4751caf22123d495cc4b51df48f234c956262fd1d8baafc"},{X:"29154aaa5b76bdb5082ea9616769f1940e56de5c6d8afb8cc75fbd228302d961",Y:"3535fb808e205f5589ca2dd28014103771266148ebc372f364dae0f3905dd811"}]},Cr={currentEpoch:"1",torusNodeEndpoints:Mr[Er.X_.SAPPHIRE_MAINNET],torusNodeSSSEndpoints:Tr(Er.X_.SAPPHIRE_MAINNET),torusNodeRSSEndpoints:Ir(Er.X_.SAPPHIRE_MAINNET),torusNodeTSSEndpoints:Nr(Er.X_.SAPPHIRE_MAINNET),torusIndexes:[1,2,3,4,5],torusNodePub:[{X:"e0925898fee0e9e941fdca7ee88deec99939ae9407e923535c4d4a3a3ff8b052",Y:"54b9fea924e3f3e40791f9987f4234ae4222412d65b74068032fa5d8b63375c1"},{X:"9124cf1e280aab32ba50dffd2de81cecabc13d82d2c1fe9de82f3b3523f9b637",Y:"fca939a1ceb42ce745c55b21ef094f543b457630cb63a94ef4f1afeee2b1f107"},{X:"555f681a63d469cc6c3a58a97e29ebd277425f0e6159708e7c7bf05f18f89476",Y:"606f2bcc0884fa5b64366fc3e8362e4939841b56acd60d5f4553cf36b891ac4e"},{X:"2b5f58d8e340f1ab922e89b3a69a68930edfe51364644a456335e179bc130128",Y:"4b4daa05939426e3cbe7d08f0e773d2bf36f64c00d04620ee6df2a7af4d2247"},{X:"3ecbb6a68afe72cf34ec6c0a12b5cb78a0d2e83ba402983b6adbc5f36219861a",Y:"dc1031c5cc8f0472bd521a62a64ebca9e163902c247bf05937daf4ae835091e4"}]},Rr={currentEpoch:"15",torusNodeEndpoints:["https://teal-15-1.torusnode.com/jrpc","https://teal-15-3.torusnode.com/jrpc","https://teal-15-4.torusnode.com/jrpc","https://teal-15-5.torusnode.com/jrpc","https://teal-15-2.torusnode.com/jrpc"],torusNodePub:[{X:"1363aad8868cacd7f8946c590325cd463106fb3731f08811ab4302d2deae35c3",Y:"d77eebe5cdf466b475ec892d5b4cffbe0c1670525debbd97eee6dae2f87a7cbe"},{X:"7c8cc521c48690f016bea593f67f88ad24f447dd6c31bbab541e59e207bf029d",Y:"b359f0a82608db2e06b953b36d0c9a473a00458117ca32a5b0f4563a7d539636"},{X:"8a86543ca17df5687719e2549caa024cf17fe0361e119e741eaee668f8dd0a6f",Y:"9cdb254ff915a76950d6d13d78ef054d5d0dc34e2908c00bb009a6e4da701891"},{X:"25a98d9ae006aed1d77e81d58be8f67193d13d01a9888e2923841894f4b0bf9c",Y:"f63d40df480dacf68922004ed36dbab9e2969181b047730a5ce0797fb6958249"},{X:"d908f41f8e06324a8a7abcf702adb6a273ce3ae63d86a3d22723e1bbf1438c9a",Y:"f977530b3ec0e525438c72d1e768380cbc5fb3b38a760ee925053b2e169428ce"}],torusIndexes:[1,2,3,4,5]};var Dr,Kr=W().getLogger("fnd"),Fr=function(){function e(){(0,s.Z)(this,e);var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.network,n=void 0===r?Er.at.MAINNET:r,i=t.fndServerEndpoint,a=t.enableLogging,c=void 0!==a&&a;(0,o.Z)(this,"fndServerEndpoint","https://fnd.tor.us/node-details"),(0,o.Z)(this,"_currentEpoch","1"),(0,o.Z)(this,"_torusNodeEndpoints",[]),(0,o.Z)(this,"_torusNodeRSSEndpoints",[]),(0,o.Z)(this,"_torusNodeSSSEndpoints",[]),(0,o.Z)(this,"_torusNodeTSSEndpoints",[]),(0,o.Z)(this,"_torusNodePub",[]),(0,o.Z)(this,"_torusIndexes",[]),(0,o.Z)(this,"updated",void 0),(0,o.Z)(this,"network",void 0),this.network=n,this.updated=!1,i&&(this.fndServerEndpoint=i),c?Kr.enableAll():Kr.disableAll()}return(0,c.Z)(e,[{key:"_nodeDetails",get:function(){return{currentEpoch:this._currentEpoch,torusNodeEndpoints:this._torusNodeEndpoints,torusNodeSSSEndpoints:this._torusNodeSSSEndpoints,torusNodeRSSEndpoints:this._torusNodeRSSEndpoints,torusNodeTSSEndpoints:this._torusNodeTSSEndpoints,torusNodePub:this._torusNodePub,torusIndexes:this._torusIndexes,updated:this.updated}}},{key:"getNodeDetails",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.verifier,n=t.verifierId,e.prev=1,!this.updated||Er.wd.includes(this.network)){e.next=4;break}return e.abrupt("return",this._nodeDetails);case 4:return e.prev=4,e.next=7,(0,F.U2)("".concat(this.fndServerEndpoint,"?network=").concat(this.network,"&verifier=").concat(r,"&verifierId=").concat(n));case 7:return a=e.sent,o=a.nodeDetails,this.setNodeDetails(o),e.abrupt("return",this._nodeDetails);case 13:e.prev=13,e.t0=e.catch(4),Kr.error("Failed to fetch node details from server, using local.",e.t0);case 16:if(i=this.network,s=i===Er.at.SAPPHIRE_DEVNET?Lr:i===Er.at.SAPPHIRE_TESTNET?jr:i===Er.at.SAPPHIRE_MAINNET?Cr:i===Er.at.MAINNET?Ar:i===Er.at.TESTNET?Rr:void 0){e.next=19;break}throw new Error("Failed to fetch node details");case 19:return this.setNodeDetails(s),e.abrupt("return",this._nodeDetails);case 23:throw e.prev=23,e.t1=e.catch(1),Kr.error("Failed to fetch node details",e.t1),e.t1;case 27:case"end":return e.stop()}var i}),e,this,[[1,23],[4,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setNodeDetails",value:function(e){var t=e.currentEpoch,r=e.torusNodeEndpoints,n=e.torusNodeSSSEndpoints,i=e.torusNodeRSSEndpoints,a=e.torusNodeTSSEndpoints,o=e.torusNodePub,s=e.torusIndexes;this._torusNodeEndpoints=r,this._torusNodeSSSEndpoints=n||[],this._torusNodeRSSEndpoints=i||[],this._torusNodeTSSEndpoints=a||[],this._torusNodePub=o,this._torusIndexes=s,this._currentEpoch=t,this.updated=!0}}]),e}(),Ur=r(49977),Br=r(80080).Buffer,qr="google",zr="facebook",Jr="reddit",Hr="discord",Wr="twitch",Yr="apple",Vr="github",Xr="linkedin",Gr="twitter",$r="weibo",Qr="line",en="email_password",tn="passwordless",rn="jwt",nn="webauthn",an="single_id_verifier",on="popup",sn="redirect",cn="localStorage",un="server",ln="triggerLogin",fn="triggerAggregateLogin",dn="triggerHybridAggregateLogin",hn="fetchNodeDetails",pn="pubAddressLookup",vn="fetchShares",mn=W().getLogger("customauth");var gn=(Dr={},(0,o.Z)(Dr,Yr,"apple"),(0,o.Z)(Dr,Vr,"github"),(0,o.Z)(Dr,Xr,"linkedin"),(0,o.Z)(Dr,Gr,"twitter"),(0,o.Z)(Dr,$r,"weibo"),(0,o.Z)(Dr,Qr,"line"),(0,o.Z)(Dr,en,"Username-Password-Authentication"),(0,o.Z)(Dr,tn,"email"),Dr),yn=function(e){return e.href.endsWith("/")?e.href:"".concat(e.href,"/")},bn={webWorkerSupport:!1};function wn(e,t){return t?e:e.toLowerCase()}var kn=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.name,a=e.sub;if(r)return wn(e[r],n);switch(t){case tn:case en:return wn(i,n);case $r:case Vr:case Gr:case Yr:case Xr:case Qr:case rn:return wn(a,n);default:throw new Error("Invalid login type")}},xn=function(e,t){var r=e.split("&").reduce((function(e,t){var r=t.split("="),n=(0,K.Z)(r,2),i=n[0],a=n[1];return e[i]=a,e}),{});mn.info(r,t);var n={},i="";return Object.keys(r).length>0&&r.state?(n=JSON.parse(atob(decodeURIComponent(decodeURIComponent(r.state))))||{},i=r.error_description||r.error||i):Object.keys(t).length>0&&t.state&&(n=JSON.parse(atob(decodeURIComponent(decodeURIComponent(t.state))))||{},t.error&&(i=t.error)),{error:i,instanceParameters:n,hashParameters:r}};var Sn=function(){var e,t;return(null===(e=window)||void 0===e||null===(t=e.navigator)||void 0===t?void 0:t.userAgent.toLowerCase().indexOf("firefox"))>-1||!1};function On(e){var t=e.baseURL,r=e.query,n=e.hash,i=new URL(t);if(r&&Object.keys(r).forEach((function(e){i.searchParams.append(e,r[e])})),n){var a=new URL(On({baseURL:t,query:n})).searchParams.toString();i.hash=a}return i.toString()}var _n=function(e){try{return new URL(decodeURIComponent(e))}catch(t){throw new Error("".concat((null===t||void 0===t?void 0:t.message)||"",", Note: Your jwt domain: (i.e ").concat(e,") must have http:// or https:// prefix"))}},Zn=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;(0,s.Z)(this,r);var i=e.url,a=e.target,c=e.features;return n=t.call(this),(0,o.Z)((0,p.Z)(n),"url",void 0),(0,o.Z)((0,p.Z)(n),"target",void 0),(0,o.Z)((0,p.Z)(n),"features",void 0),(0,o.Z)((0,p.Z)(n),"window",void 0),(0,o.Z)((0,p.Z)(n),"windowTimer",void 0),(0,o.Z)((0,p.Z)(n),"iClosedWindow",void 0),n.url=i,n.target=a||"_blank",n.features=c||function(){var e=void 0!==window.screenLeft?window.screenLeft:window.screenX,t=void 0!==window.screenTop?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,n=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,i=Math.abs((r-1200)/2/1+e),a=Math.abs((n-700)/2/1+t);return"titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=".concat(700,",width=").concat(1200,",top=").concat(a,",left=").concat(i)}(),n.window=void 0,n.windowTimer=void 0,n.iClosedWindow=!1,n._setupTimer(),n}return(0,c.Z)(r,[{key:"_setupTimer",value:function(){var e=this;this.windowTimer=Number(setInterval((function(){e.window&&e.window.closed&&(clearInterval(e.windowTimer),e.iClosedWindow||e.emit("close"),e.iClosedWindow=!1,e.window=void 0),void 0===e.window&&clearInterval(e.windowTimer)}),500))}},{key:"open",value:function(){var e;return this.window=window.open(this.url.href,this.target,this.features),null!==(e=this.window)&&void 0!==e&&e.focus&&this.window.focus(),Promise.resolve()}},{key:"close",value:function(){this.iClosedWindow=!0,this.window&&this.window.close()}},{key:"redirect",value:function(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}]),r}(Zr.EventEmitter),Pn=["access_token","id_token"];function En(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Mn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?En(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):En(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Tn=function(){function e(t,r,n,i,a,c,u,l){(0,s.Z)(this,e),(0,o.Z)(this,"clientId",void 0),(0,o.Z)(this,"verifier",void 0),(0,o.Z)(this,"redirect_uri",void 0),(0,o.Z)(this,"typeOfLogin",void 0),(0,o.Z)(this,"uxMode",void 0),(0,o.Z)(this,"redirectToOpener",void 0),(0,o.Z)(this,"jwtParams",void 0),(0,o.Z)(this,"customState",void 0),(0,o.Z)(this,"nonce",Math.random().toString(36).slice(2)),(0,o.Z)(this,"finalURL",void 0),this.clientId=t,this.verifier=r,this.redirect_uri=n,this.typeOfLogin=i,this.uxMode=a,this.redirectToOpener=c,this.jwtParams=u,this.customState=l}return(0,c.Z)(e,[{key:"state",get:function(){return encodeURIComponent(window.btoa(JSON.stringify(Mn(Mn({},this.customState||{}),{},{instanceId:this.nonce,verifier:this.verifier,typeOfLogin:this.typeOfLogin,redirectToOpener:this.redirectToOpener||!1}))))}},{key:"handleLoginWindow",value:function(e){var t=this,r=new Zn({url:this.finalURL,features:e.popupFeatures});return this.uxMode!==sn?new Promise((function(e,n){var o,s=function(){var r=(0,a.Z)((0,i.Z)().mark((function r(a){var s,c,u,l,f,d,h,p;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,s=a.error,c=a.data,l=(u=c||{}).instanceParams,f=u.hashParams,d=f.access_token,h=f.id_token,p=(0,q.Z)(u.hashParams,Pn),!s){r.next=7;break}return mn.error(a),n(new Error("Error: ".concat(s,". Info: ").concat(JSON.stringify(a.data||{})))),r.abrupt("return");case 7:if(!a.data||l.verifier!==t.verifier){r.next=13;break}if(mn.info(a.data),t.redirectToOpener||!o){r.next=12;break}return r.next=12,o.postMessage({success:!0});case 12:e(Mn(Mn({accessToken:d,idToken:h||""},p),{},{state:l}));case 13:r.next=19;break;case 15:r.prev=15,r.t0=r.catch(0),mn.error(r.t0),n(r.t0);case 19:case"end":return r.stop()}}),r,null,[[0,15]])})));return function(e){return r.apply(this,arguments)}}();if(t.redirectToOpener){var c=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.data){e.next=2;break}return e.abrupt("return");case 2:if((a=n.data).channel==="redirect_channel_".concat(t.nonce)){e.next=5;break}return e.abrupt("return");case 5:window.removeEventListener("message",c),s(a),r.close();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();window.addEventListener("message",c)}else(o=new wr("redirect_channel_".concat(t.nonce),bn)).addEventListener("message",function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(t);case 2:o.close(),r.close();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());r.open(),r.once("close",(function(){o&&o.close(),n(new Error("user closed popup"))}))})):(r.redirect(e.locationReplaceOnRedirect),null)}}]),e}(),In=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),(0,o.Z)((0,p.Z)(d),"RESPONSE_TYPE","token"),(0,o.Z)((0,p.Z)(d),"SCOPE","identify email"),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=new URL("https://discord.com/api/oauth2/authorize"),t=JSON.parse(JSON.stringify(this.jwtParams||{})),r=B()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.clientId,redirect_uri:this.redirect_uri,scope:this.SCOPE},t);Object.keys(r).forEach((function(t){r[t]&&e.searchParams.append(t,r[t])})),this.finalURL=e}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accessToken,e.next=3,(0,F.U2)("https://discord.com/api/users/@me",{headers:{Authorization:"Bearer ".concat(r)}});case 3:return n=e.sent,a=n.id,o=n.avatar,s=n.email,c=void 0===s?"":s,u=n.username,l=void 0===u?"":u,f=n.discriminator,d=void 0===f?"":f,h=null===o?"https://cdn.discordapp.com/embed/avatars/".concat(Number(d)%5,".png"):"https://cdn.discordapp.com/avatars/".concat(a,"/").concat(o,".png?size=2048"),e.abrupt("return",{profileImage:h,name:"".concat(l,"#").concat(d),email:c,verifierId:a,verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Tn),Nn=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),(0,o.Z)((0,p.Z)(d),"RESPONSE_TYPE","token"),(0,o.Z)((0,p.Z)(d),"SCOPE","public_profile email"),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=new URL("https://www.facebook.com/v15.0/dialog/oauth"),t=JSON.parse(JSON.stringify(this.jwtParams||{})),r=B()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.clientId,redirect_uri:this.redirect_uri,scope:this.SCOPE},t);Object.keys(r).forEach((function(t){r[t]&&e.searchParams.append(t,r[t])})),this.finalURL=e}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accessToken,e.next=3,(0,F.U2)("https://graph.facebook.com/me?fields=name,email,picture.type(large)",{headers:{Authorization:"Bearer ".concat(r)}});case 3:return n=e.sent,a=n.name,o=void 0===a?"":a,s=n.id,c=n.picture,u=n.email,l=void 0===u?"":u,e.abrupt("return",{email:l,name:o,profileImage:c.data.url||"",verifier:this.verifier,verifierId:s,typeOfLogin:this.typeOfLogin});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Tn),An=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),(0,o.Z)((0,p.Z)(d),"RESPONSE_TYPE","token id_token"),(0,o.Z)((0,p.Z)(d),"SCOPE","profile email openid"),(0,o.Z)((0,p.Z)(d),"PROMPT","consent select_account"),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=new URL("https://accounts.google.com/o/oauth2/v2/auth"),t=JSON.parse(JSON.stringify(this.jwtParams||{})),r=B()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.clientId,prompt:this.PROMPT,redirect_uri:this.redirect_uri,scope:this.SCOPE,nonce:this.nonce},t);Object.keys(r).forEach((function(t){r[t]&&e.searchParams.append(t,r[t])})),this.finalURL=e}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accessToken,e.next=3,(0,F.U2)("https://www.googleapis.com/userinfo/v2/me",{headers:{Authorization:"Bearer ".concat(r)}});case 3:return n=e.sent,a=n.picture,o=void 0===a?"":a,s=n.email,c=void 0===s?"":s,u=n.name,l=void 0===u?"":u,e.abrupt("return",{email:c,name:l,profileImage:o,verifier:this.verifier,verifierId:c.toLowerCase(),typeOfLogin:this.typeOfLogin});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Tn),Ln=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),(0,o.Z)((0,p.Z)(d),"SCOPE","openid profile email"),(0,o.Z)((0,p.Z)(d),"RESPONSE_TYPE","token id_token"),(0,o.Z)((0,p.Z)(d),"PROMPT","login"),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=this.jwtParams.domain,t=_n(e);t.pathname+=t.pathname.endsWith("/")?"authorize":"/authorize";var r=JSON.parse(JSON.stringify(this.jwtParams));delete r.domain;var n=B()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.clientId,prompt:this.PROMPT,redirect_uri:this.redirect_uri,scope:this.SCOPE,connection:gn[this.typeOfLogin],nonce:this.nonce},r);Object.keys(n).forEach((function(e){n[e]&&t.searchParams.append(e,n[e])})),this.finalURL=t}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,v,m,g,y,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.idToken,n=t.accessToken,a=this.jwtParams,o=a.domain,s=a.verifierIdField,c=a.isVerifierIdCaseSensitive,u=a.user_info_route,l=void 0===u?"userinfo":u,!n){e.next=15;break}return e.prev=3,f=new URL(o),e.next=7,(0,F.U2)("".concat(yn(f)).concat(l),{headers:{Authorization:"Bearer ".concat(n)}});case 7:return d=e.sent,h=d.picture,p=d.name,v=d.email,e.abrupt("return",{email:v,name:p,profileImage:h,verifierId:kn(d,this.typeOfLogin,s,c),verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 12:e.prev=12,e.t0=e.catch(3),W().warn(e.t0,"Unable to get userinfo from endpoint");case 15:if(!r){e.next=19;break}return m=(0,Pr.Z)(r),g=m.name,y=m.email,b=m.picture,e.abrupt("return",{profileImage:b,name:g,email:y,verifierId:kn(m,this.typeOfLogin,s,c),verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 19:throw new Error("Access/id token not available");case 20:case"end":return e.stop()}}),e,this,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(Tn),jn=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=JSON.parse(JSON.stringify(this.jwtParams));delete e.domain;var t=B()({state:this.state,client_id:this.clientId,nonce:this.nonce},e);this.finalURL=new URL(On({baseURL:this.redirect_uri,query:null,hash:t}))}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,v,m,g,y,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.idToken,n=t.accessToken,a=this.jwtParams,o=a.domain,s=a.verifierIdField,c=a.isVerifierIdCaseSensitive,u=a.user_info_route,l=void 0===u?"userinfo":u,!n){e.next=15;break}return e.prev=3,f=new URL(o),e.next=7,(0,F.U2)("".concat(yn(f)).concat(l),{headers:{Authorization:"Bearer ".concat(n)}});case 7:return d=e.sent,h=d.picture,p=d.name,v=d.email,e.abrupt("return",{email:v,name:p,profileImage:h,verifierId:kn(d,this.typeOfLogin,s,c),verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 12:e.prev=12,e.t0=e.catch(3),W().warn(e.t0,"Unable to get userinfo from endpoint");case 15:if(!r){e.next=19;break}return m=(0,Pr.Z)(r),g=m.name,y=m.email,b=m.picture,e.abrupt("return",{profileImage:b,name:g,email:y,verifierId:kn(m,this.typeOfLogin,s,c),verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 19:throw new Error("Access/id token not available");case 20:case"end":return e.stop()}}),e,this,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleLoginWindow",value:function(e){var t=this.jwtParams,r=t.id_token,n=t.access_token,i=new Zn({url:this.finalURL,features:e.popupFeatures});return this.uxMode!==sn?Promise.resolve({state:{},idToken:r,accessToken:n}):(i.redirect(e.locationReplaceOnRedirect),null)}}]),r}(Tn),Cn=["access_token","id_token"];function Rn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Kn=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),(0,o.Z)((0,p.Z)(d),"SCOPE","openid profile email"),(0,o.Z)((0,p.Z)(d),"RESPONSE_TYPE","token id_token"),(0,o.Z)((0,p.Z)(d),"PROMPT","login"),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=this.jwtParams.domain,t=_n(e);t.pathname="/passwordless/start",this.finalURL=t}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,v,m,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.idToken,n=t.accessToken,a=this.jwtParams,o=a.domain,s=a.verifierIdField,c=a.isVerifierIdCaseSensitive,e.prev=2,u=new URL(o),e.next=6,(0,F.U2)("".concat(yn(u),"userinfo"),{headers:{Authorization:"Bearer ".concat(n)}});case 6:return l=e.sent,f=l.picture,d=l.name,h=l.email,e.abrupt("return",{email:h,name:d,profileImage:f,verifierId:kn(l,this.typeOfLogin,s,c),verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 11:return e.prev=11,e.t0=e.catch(2),mn.error(e.t0),p=(0,Pr.Z)(r),v=p.name,m=p.email,g=p.picture,e.abrupt("return",{profileImage:g,name:v,email:m,verifierId:kn(p,this.typeOfLogin,s,c),verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 17:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleLoginWindow",value:function(){var e=this;return new Promise((function(t,r){if(e.redirectToOpener)r(new Error("Cannot use redirect to opener for passwordless"));else{var n=function(n){try{var i=n.error,a=n.data||{},o=a.instanceParams,s=a.hashParams,c=s.access_token,u=s.id_token,l=(0,q.Z)(a.hashParams,Cn);if(i)return mn.error(n.error),void r(new Error(i));n.data&&o.verifier===e.verifier&&(mn.info(n.data),t(Dn(Dn({accessToken:c,idToken:u||""},l),{},{state:o})))}catch(i){mn.error(i),r(i)}},o=new wr("redirect_channel_".concat(e.nonce),bn);o.addEventListener("message",function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(t),o.close();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());try{var s=e.jwtParams,c=s.connection,u=void 0===c?"email":c,l=s.login_hint,f=B()({client_id:e.clientId,connection:u,email:"email"===u?l:void 0,phone_number:"sms"===u?l:void 0,send:"link",authParams:{scope:e.SCOPE,state:e.state,response_type:e.RESPONSE_TYPE,redirect_uri:e.redirect_uri,nonce:e.nonce,prompt:e.PROMPT}},{authParams:e.jwtParams});(0,F.v_)(e.finalURL.href,JSON.parse(JSON.stringify(f))).then((function(e){mn.info("posted",e)})).catch((function(e){mn.error(e),r(e)}))}catch(d){mn.error(d),r(d)}}}))}}]),r}(Tn),Fn=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),(0,o.Z)((0,p.Z)(d),"RESPONSE_TYPE","token"),(0,o.Z)((0,p.Z)(d),"SCOPE","identity"),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=new URL("https://www.reddit.com/api/v1/authorize".concat(window.innerWidth<600?".compact":"")),t=JSON.parse(JSON.stringify(this.jwtParams||{})),r=B()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.clientId,redirect_uri:this.redirect_uri,scope:this.SCOPE},t);Object.keys(r).forEach((function(t){r[t]&&e.searchParams.append(t,r[t])})),this.finalURL=e}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accessToken,e.next=3,(0,F.U2)("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:"Bearer ".concat(r)}});case 3:return n=e.sent,a=n.icon_img,o=void 0===a?"":a,s=n.name,c=void 0===s?"":s,e.abrupt("return",{email:"",name:c,profileImage:o.split("?").length>0?o.split("?")[0]:o,verifier:this.verifier,verifierId:c.toLowerCase(),typeOfLogin:this.typeOfLogin});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Tn),Un=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f){var d;return(0,s.Z)(this,r),d=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(d),"clientId",void 0),(0,o.Z)((0,p.Z)(d),"verifier",void 0),(0,o.Z)((0,p.Z)(d),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(d),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(d),"uxMode",void 0),(0,o.Z)((0,p.Z)(d),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(d),"jwtParams",void 0),(0,o.Z)((0,p.Z)(d),"customState",void 0),(0,o.Z)((0,p.Z)(d),"RESPONSE_TYPE","token"),(0,o.Z)((0,p.Z)(d),"SCOPE","user:read:email"),d.clientId=e,d.verifier=n,d.redirect_uri=i,d.typeOfLogin=a,d.uxMode=c,d.redirectToOpener=u,d.jwtParams=l,d.customState=f,d.setFinalUrl(),d}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=new URL("https://id.twitch.tv/oauth2/authorize"),t=JSON.parse(JSON.stringify(this.jwtParams||{})),r=B()({state:this.state,response_type:this.RESPONSE_TYPE,client_id:this.clientId,redirect_uri:this.redirect_uri,scope:this.SCOPE,force_verify:!0},t);Object.keys(r).forEach((function(t){r[t]&&e.searchParams.append(t,r[t])})),this.finalURL=e}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accessToken,e.next=3,(0,F.U2)("https://api.twitch.tv/helix/users",{headers:{Authorization:"Bearer ".concat(r),"Client-ID":this.clientId}});case 3:return n=e.sent,a=n.data||[],o=(0,K.Z)(a,1),s=o[0],c=s.profile_image_url,u=void 0===c?"":c,l=s.display_name,f=void 0===l?"":l,d=s.email,h=void 0===d?"":d,p=s.id,e.abrupt("return",{profileImage:u,name:f,email:h,verifierId:p,verifier:this.verifier,typeOfLogin:this.typeOfLogin});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Tn),Bn="https://api.webauthn.openlogin.com",qn=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,c,u,l,f,d){var h;return(0,s.Z)(this,r),h=t.call(this,e,n,i,a,c,u,l,f),(0,o.Z)((0,p.Z)(h),"clientId",void 0),(0,o.Z)((0,p.Z)(h),"verifier",void 0),(0,o.Z)((0,p.Z)(h),"redirect_uri",void 0),(0,o.Z)((0,p.Z)(h),"typeOfLogin",void 0),(0,o.Z)((0,p.Z)(h),"uxMode",void 0),(0,o.Z)((0,p.Z)(h),"redirectToOpener",void 0),(0,o.Z)((0,p.Z)(h),"jwtParams",void 0),(0,o.Z)((0,p.Z)(h),"customState",void 0),(0,o.Z)((0,p.Z)(h),"registerOnly",void 0),h.clientId=e,h.verifier=n,h.redirect_uri=i,h.typeOfLogin=a,h.uxMode=c,h.redirectToOpener=u,h.jwtParams=l,h.customState=f,h.registerOnly=d,h.setFinalUrl(),h}return(0,c.Z)(r,[{key:"setFinalUrl",value:function(){var e=new URL("https://webauthn.openlogin.com"),t=JSON.parse(JSON.stringify(this.jwtParams||{})),r=B()({register_only:!!this.registerOnly,state:this.state,client_id:this.clientId,redirect_uri:this.redirect_uri},t);Object.keys(r).forEach((function(t){r[t]&&e.searchParams.append(t,r[t])})),this.finalURL=e}},{key:"getUserInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,v,m,g,y;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.idToken,n=t.ref,a=t.extraParamsPassed,o=t.extraParams,"true"!==a){e.next=33;break}mn.debug("extraParamsPassed is true, using extraParams passed through hashParams"),e.prev=3,m=JSON.parse(atob(o)),s=m.verifier_id,c=m.signature,u=m.clientDataJSON,l=m.authenticatorData,f=m.publicKey,d=m.challenge,h=m.rpOrigin,p=m.credId,v=m.transports,e.next=31;break;case 16:return e.prev=16,e.t0=e.catch(3),mn.warn("unable to parse extraParams",e.t0),e.next=21,(0,F.U2)("".concat(Bn,"/signature/fetch/").concat(r));case 21:g=e.sent,s=g.verifier_id,c=g.signature,u=g.clientDataJSON,l=g.authenticatorData,f=g.publicKey,d=g.challenge,h=g.rpOrigin,p=g.credId,v=g.transports;case 31:e.next=46;break;case 33:return mn.debug("extraParamsPassed is false, using extraParams passed through bridge server"),e.next=36,(0,F.U2)("".concat(Bn,"/signature/fetch/").concat(r));case 36:y=e.sent,s=y.verifier_id,c=y.signature,u=y.clientDataJSON,l=y.authenticatorData,f=y.publicKey,d=y.challenge,h=y.rpOrigin,p=y.credId,v=y.transports;case 46:if(c===r){e.next=48;break}throw new Error("idtoken should be equal to signature");case 48:return e.abrupt("return",{email:"",name:"WebAuthn Login",profileImage:"",verifier:this.verifier,verifierId:s,typeOfLogin:this.typeOfLogin,ref:n,registerOnly:this.registerOnly,extraVerifierParams:{signature:c,clientDataJSON:u,authenticatorData:l,publicKey:f,challenge:d,rpOrigin:h,credId:p,transports:v}});case 49:case"end":return e.stop()}}),e,this,[[3,16]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(Tn),zn=function(e){var t=e.clientId,r=e.redirect_uri,n=e.typeOfLogin,i=e.verifier,a=e.jwtParams,o=e.redirectToOpener,s=e.uxMode,c=e.customState,u=e.registerOnly;if(!i||!n||!t)throw new Error("Invalid params");var l=a||{},f=l.domain,d=l.login_hint,h=l.id_token,p=l.access_token;switch(n){case qr:return new An(t,i,r,n,s,o,a,c);case zr:return new Nn(t,i,r,n,s,o,a,c);case Wr:return new Un(t,i,r,n,s,o,a,c);case Jr:return new Fn(t,i,r,n,s,o,a,c);case Hr:return new In(t,i,r,n,s,o,a,c);case tn:if(!f||!d)throw new Error("Invalid params");return new Kn(t,i,r,n,s,o,a,c);case Yr:case Vr:case Xr:case Gr:case $r:case Qr:case en:case rn:if(h||p)return new jn(t,i,r,n,s,o,a,c);if(!f)throw new Error("Invalid params");return new Ln(t,i,r,n,s,o,a,c);case nn:return new qn(t,i,r,n,s,o,a,c,u);default:throw new Error("Invalid login type")}},Jn=function(e){return new Promise((function(t,r){var n="".concat(e,"sw.js");"serviceWorker"in window.navigator?(0,Ur.z)(n,{ready:function(){mn.info("App is being served from cache by a service worker.\n For more details, visit https://goo.gl/AFskqB"),t(void 0)},registered:function(){mn.info("Service worker has been registered."),t(void 0)},cached:function(){mn.info("Content has been cached for offline use."),t(void 0)},updatefound:function(){mn.info("New content is downloading.")},updated:function(){mn.info("New content is available; please refresh.")},offline:function(){mn.info("No internet connection found. App is running in offline mode."),r(new Error("App is offline"))},error:function(e){mn.error("Error during service worker registration:",e),r(e)}}):r(new Error("Service workers are not supported"))}))},Hn=function(){function e(t){(0,s.Z)(this,e),(0,o.Z)(this,"sentry",null),this.sentry=t}return(0,c.Z)(e,[{key:"startTransaction",value:function(e){if(this.sentry)return this.sentry.startTransaction(e)}},{key:"finishTransaction",value:function(e){e&&e.finish()}}]),e}(),Wn=function(){function e(t){(0,s.Z)(this,e),(0,o.Z)(this,"currentStorageMethod",cn),(0,o.Z)(this,"isInitialized",!1),(0,o.Z)(this,"storageServerUrl","https://broadcast-server.tor.us"),this.storageServerUrl=t}return(0,c.Z)(e,[{key:"init",value:function(){var e=function(){var e,t=J().parse(navigator.userAgent);mn.info(JSON.stringify(t),"current browser info");var r=!0;return null!==(e=navigator)&&void 0!==e&&e.brave&&(r=!1),t.engine.name!==J().ENGINE_MAP.WebKit&&t.engine.name!==J().ENGINE_MAP.Gecko||(r=!1),r}(),t=function(e){var t;try{t=window[e];var r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(n){return n&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&t&&0!==t.length}}(cn);this.currentStorageMethod=e&&t?cn:un,this.isInitialized=!0}},{key:"storeLoginDetails",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized){e.next=2;break}throw new Error("StorageHelper is not initialized");case 2:if(this.currentStorageMethod!==un){e.next=16;break}return n=Xt(Br.from(r,"utf8")),a=n.toString("hex"),o=(0,k.rc)(n).toString("hex"),e.next=8,er(a,t);case 8:return s=e.sent,e.next=11,(0,k.Xx)(n,Xt(Br.from(s,"utf8")));case 11:return c=e.sent.toString("hex"),e.next=14,(0,F.v_)("".concat(this.storageServerUrl,"/store/set"),{key:o,data:s,signature:c});case 14:e.next=17;break;case 16:window.localStorage.setItem("torus_login_".concat(r),JSON.stringify(t));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"retrieveLoginDetails",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized){e.next=2;break}throw new Error("StorageHelper is not initialized");case 2:if(this.currentStorageMethod!==un){e.next=24;break}return r=Xt(Br.from(t,"utf8")),n=r.toString("hex"),a=(0,k.rc)(r).toString("hex"),e.prev=6,e.next=9,(0,F.U2)("".concat(this.storageServerUrl,"/store/get?key=").concat(a));case 9:if(!(o=e.sent).message){e.next=15;break}return e.next=13,rr(n,o.message);case 13:return s=e.sent,e.abrupt("return",s);case 15:e.next=24;break;case 17:if(e.prev=17,e.t0=e.catch(6),404!==e.t0.status){e.next=23;break}mn.warn(e.t0,"Session likely expired"),e.next=24;break;case 23:throw e.t0;case 24:return c=window.localStorage.getItem("torus_login_".concat(t)),e.abrupt("return",JSON.parse(c||"{}"));case 26:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"clearLoginDetailsStorage",value:function(e){if(!this.isInitialized)throw new Error("StorageHelper is not initialized");this.currentStorageMethod===cn&&window.localStorage.removeItem("torus_login_".concat(e))}},{key:"clearOrphanedLoginDetails",value:function(){if(!this.isInitialized)throw new Error("StorageHelper is not initialized");this.currentStorageMethod===cn&&Object.keys(window.localStorage).forEach((function(e){e.startsWith("torus_login_")&&window.localStorage.removeItem(e)}))}}]),e}(),Yn=["access_token","id_token"],Vn=["access_token","id_token"],Xn=["access_token","id_token"],Gn=["args","method"];function $n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ei=function(){function e(t){(0,s.Z)(this,e);var r=t.baseUrl,n=t.network,i=void 0===n?Er.at.MAINNET:n,a=t.enableLogging,c=void 0!==a&&a,u=t.enableOneKey,l=void 0!==u&&u,f=t.redirectToOpener,d=void 0!==f&&f,h=t.redirectPathName,p=void 0===h?"redirect":h,v=t.apiKey,g=void 0===v?"torus-default":v,y=t.uxMode,b=void 0===y?on:y,w=t.locationReplaceOnRedirect,k=void 0!==w&&w,x=t.popupFeatures,S=t.metadataUrl,O=void 0===S?"https://metadata.tor.us":S,_=t.storageServerUrl,Z=void 0===_?"https://broadcast-server.tor.us":_,P=t.sentry,E=t.web3AuthClientId;if((0,o.Z)(this,"isInitialized",void 0),(0,o.Z)(this,"config",void 0),(0,o.Z)(this,"torus",void 0),(0,o.Z)(this,"nodeDetailManager",void 0),(0,o.Z)(this,"storageHelper",void 0),(0,o.Z)(this,"sentryHandler",void 0),!E)throw Error("Please provide a valid web3AuthClientId in constructor");this.isInitialized=!1;var M=new URL(r);this.config={baseUrl:yn(M),get redirect_uri(){return"".concat(this.baseUrl).concat(p)},redirectToOpener:d,uxMode:b,locationReplaceOnRedirect:k,popupFeatures:x};var T=new m.ZP({enableOneKey:l,metadataHost:O,network:i,clientId:E});m.ZP.setAPIKey(g),this.torus=T,this.nodeDetailManager=new Fr({network:i}),c?mn.enableAll():mn.disableAll(),this.storageHelper=new Wn(Z),this.sentryHandler=new Hn(P)}return(0,c.Z)(e,[{key:"init",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,o,s,c,u=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=u.length>0&&void 0!==u[0]?u[0]:{}).skipSw,n=void 0!==r&&r,a=t.skipInit,o=void 0!==a&&a,s=t.skipPrefetch,c=void 0!==s&&s,this.storageHelper.init(),!o){e.next=5;break}return this.isInitialized=!0,e.abrupt("return");case 5:if(n){e.next=23;break}return e.next=8,fetch("".concat(this.config.baseUrl,"sw.js"),{cache:"reload"});case 8:if(!e.sent.ok){e.next=22;break}return e.prev=10,e.next=13,Jn(this.config.baseUrl);case 13:return this.isInitialized=!0,e.abrupt("return");case 17:e.prev=17,e.t0=e.catch(10),mn.warn(e.t0);case 20:e.next=23;break;case 22:throw new Error("Service worker is not being served. Please serve it");case 23:if(c){e.next=30;break}if(!Sn()){e.next=27;break}return this.isInitialized=!0,e.abrupt("return");case 27:return e.next=29,this.handlePrefetchRedirectUri();case 29:return e.abrupt("return");case 30:this.isInitialized=!0;case 31:case"end":return e.stop()}}),e,this,[[10,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"triggerLogin",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,v,m,g,y,b,w,k,x,S,O,_,Z,P,E,M;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.verifier,n=t.typeOfLogin,a=t.clientId,o=t.jwtParams,s=t.hash,c=t.queryParameters,u=t.customState,l=t.registerOnly,mn.info("Verifier: ",r),this.isInitialized){e.next=4;break}throw new Error("Not initialized yet");case 4:if(!l||n===nn){e.next=6;break}throw new Error("registerOnly flag can only be passed for webauthn");case 6:if(f=zn({typeOfLogin:n,clientId:a,verifier:r,redirect_uri:this.config.redirect_uri,redirectToOpener:this.config.redirectToOpener,jwtParams:o,uxMode:this.config.uxMode,customState:u,registerOnly:l}),!s||!c){e.next=15;break}if(h=xn(s,c),p=h.error,v=h.hashParameters,m=h.instanceParameters,!p){e.next=11;break}throw new Error(p);case 11:g=v.access_token,y=v.id_token,b=(0,q.Z)(v,Yn),d=Qn(Qn({accessToken:g,idToken:y},b),{},{state:m}),e.next=24;break;case 15:if(this.storageHelper.clearOrphanedLoginDetails(),this.config.uxMode!==sn){e.next=19;break}return e.next=19,this.storageHelper.storeLoginDetails({method:ln,args:t},f.nonce);case 19:return e.next=21,f.handleLoginWindow({locationReplaceOnRedirect:this.config.locationReplaceOnRedirect,popupFeatures:this.config.popupFeatures});case 21:if(d=e.sent,this.config.uxMode!==sn){e.next=24;break}return e.abrupt("return",null);case 24:return e.next=26,f.getUserInfo(d);case 26:if(w=e.sent,!l){e.next=45;break}return k=this.sentryHandler.startTransaction({name:hn}),e.next=31,this.nodeDetailManager.getNodeDetails({verifier:r,verifierId:w.verifierId});case 31:return x=e.sent,S=x.torusNodeEndpoints,O=x.torusNodePub,this.sentryHandler.finishTransaction(k),_=this.sentryHandler.startTransaction({name:pn}),e.next=38,this.torus.getPublicAddress(S,O,{verifier:r,verifierId:w.verifierId},!0);case 38:if(Z=e.sent,this.sentryHandler.finishTransaction(_),P={userInfo:Qn(Qn({},w),d)},"string"!==typeof Z){e.next=43;break}throw new Error("should have returned extended pub key");case 43:return E={typeOfUser:Z.typeOfUser,pubKey:{pub_key_X:Z.X,pub_key_Y:Z.Y},publicAddress:Z.address,privateKey:null,metadataNonce:null},e.abrupt("return",Qn(Qn({},P),E));case 45:return e.next=47,this.getTorusKey(r,w.verifierId,{verifier_id:w.verifierId},d.idToken||d.accessToken,w.extraVerifierParams);case 47:return M=e.sent,e.abrupt("return",Qn(Qn({},M),{},{userInfo:Qn(Qn({},w),d)}));case 49:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"triggerAggregateLogin",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,v,g,y,b,w,k,x,S,O,_,Z,P,E,M,T,I,N,A,L,j,C,R,K,F,U;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.aggregateVerifierType,n=t.verifierIdentifier,a=t.subVerifierDetailsArray,this.isInitialized){e.next=3;break}throw new Error("Not initialized yet");case 3:if(r&&n&&Array.isArray(a)){e.next=5;break}throw new Error("Invalid params");case 5:if(r!==an||1===a.length){e.next=7;break}throw new Error("Single id verifier can only have one sub verifier");case 7:o=[],s=[],c=(0,D.Z)(a),e.prev=10,c.s();case 12:if((u=c.n()).done){e.next=38;break}if(l=u.value,f=l.clientId,d=l.typeOfLogin,h=l.verifier,p=l.jwtParams,v=l.hash,g=l.queryParameters,y=l.customState,b=zn({typeOfLogin:d,clientId:f,verifier:h,redirect_uri:this.config.redirect_uri,redirectToOpener:this.config.redirectToOpener,jwtParams:p,uxMode:this.config.uxMode,customState:y}),w=void 0,!v||!g){e.next=25;break}if(k=xn(v,g),x=k.error,S=k.hashParameters,O=k.instanceParameters,!x){e.next=21;break}throw new Error(x);case 21:_=S.access_token,Z=S.id_token,P=(0,q.Z)(S,Vn),w=Qn(Qn({accessToken:_,idToken:Z},P),{},{state:O}),e.next=34;break;case 25:if(this.storageHelper.clearOrphanedLoginDetails(),this.config.uxMode!==sn){e.next=29;break}return e.next=29,this.storageHelper.storeLoginDetails({method:fn,args:t},b.nonce);case 29:return e.next=31,b.handleLoginWindow({locationReplaceOnRedirect:this.config.locationReplaceOnRedirect,popupFeatures:this.config.popupFeatures});case 31:if(w=e.sent,this.config.uxMode!==sn){e.next=34;break}return e.abrupt("return",null);case 34:o.push(b.getUserInfo(w)),s.push(w);case 36:e.next=12;break;case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(10),c.e(e.t0);case 43:return e.prev=43,c.f(),e.finish(43);case 46:return e.next=48,Promise.all(o);case 48:for(E=e.sent,M=E.map((function(e){return Qn(Qn({},e),{},{aggregateVerifier:n})})),T={verify_params:[],sub_verifier_ids:[],verifier_id:""},I=[],N="",A={},L=0;L<a.length;L+=1)j=s[L],C=j.idToken,R=j.accessToken,K=M[L],T.verify_params.push({verifier_id:K.verifierId,idtoken:C||R}),T.sub_verifier_ids.push(K.verifier),I.push(C||R),N=K.verifierId,A=K.extraVerifierParams;return I.sort(),F=(0,m.wn)(Br.from(I.join(String.fromCharCode(29)),"utf8")).slice(2),T.verifier_id=N,e.next=60,this.getTorusKey(n,N,T,F,A);case 60:return U=e.sent,e.abrupt("return",Qn(Qn({},U),{},{userInfo:M.map((function(e,t){return Qn(Qn({},e),s[t])}))}));case 62:case"end":return e.stop()}}),e,this,[[10,40,43,46]])})));return function(t){return e.apply(this,arguments)}}()},{key:"triggerHybridAggregateLogin",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c,u,l,f,d,h,p,v,g,y,b,w,k,x,S,O,_,Z,P,E,M,T,I,N,A,L,j,C,R,D,F;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.singleLogin,n=t.aggregateLoginParams,this.isInitialized){e.next=3;break}throw new Error("Not initialized yet");case 3:if(n.aggregateVerifierType&&n.verifierIdentifier&&Array.isArray(n.subVerifierDetailsArray)){e.next=5;break}throw new Error("Invalid params");case 5:if(n.aggregateVerifierType!==an||1===n.subVerifierDetailsArray.length){e.next=7;break}throw new Error("Single id verifier can only have one sub verifier");case 7:if(a=r.typeOfLogin,o=r.clientId,s=r.verifier,c=r.jwtParams,u=r.hash,l=r.queryParameters,f=r.customState,d=zn({typeOfLogin:a,clientId:o,verifier:s,redirect_uri:this.config.redirect_uri,redirectToOpener:this.config.redirectToOpener,jwtParams:c,uxMode:this.config.uxMode,customState:f}),!u||!l){e.next=17;break}if(p=xn(u,l),v=p.error,g=p.hashParameters,y=p.instanceParameters,!v){e.next=13;break}throw new Error(v);case 13:b=g.access_token,w=g.id_token,k=(0,q.Z)(g,Xn),h=Qn(Qn({accessToken:b,idToken:w},k),{},{state:y}),e.next=26;break;case 17:if(this.storageHelper.clearOrphanedLoginDetails(),this.config.uxMode!==sn){e.next=21;break}return e.next=21,this.storageHelper.storeLoginDetails({method:dn,args:t},d.nonce);case 21:return e.next=23,d.handleLoginWindow({locationReplaceOnRedirect:this.config.locationReplaceOnRedirect,popupFeatures:this.config.popupFeatures});case 23:if(h=e.sent,this.config.uxMode!==sn){e.next=26;break}return e.abrupt("return",null);case 26:return e.next=28,d.getUserInfo(h);case 28:for(x=e.sent,S=this.getTorusKey(s,x.verifierId,{verifier_id:x.verifierId},h.idToken||h.accessToken,x.extraVerifierParams),O=n.verifierIdentifier,_=n.subVerifierDetailsArray,Z={verify_params:[],sub_verifier_ids:[],verifier_id:""},P=[],E="",M=0;M<_.length;M+=1)T=_[M],N=(I=h).idToken,A=I.accessToken,Z.verify_params.push({verifier_id:x.verifierId,idtoken:N||A}),Z.sub_verifier_ids.push(T.verifier),P.push(N||A),E=x.verifierId;return P.sort(),L=(0,m.wn)(Br.from(P.join(String.fromCharCode(29)),"utf8")).slice(2),Z.verifier_id=E,j=this.getTorusKey(O,E,Z,L,x.extraVerifierParams),e.next=41,Promise.all([S,j]);case 41:return C=e.sent,R=(0,K.Z)(C,2),D=R[0],F=R[1],e.abrupt("return",{singleLogin:Qn({userInfo:Qn(Qn({},x),h)},D),aggregateLogins:[F]});case 46:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTorusKey",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a,o){var s,c,u,l,f,d,h,p,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.sentryHandler.startTransaction({name:hn}),e.next=3,this.nodeDetailManager.getNodeDetails({verifier:t,verifierId:r});case 3:return c=e.sent,u=c.torusNodeEndpoints,l=c.torusNodePub,f=c.torusIndexes,this.sentryHandler.finishTransaction(s),mn.debug("torus-direct/getTorusKey",{torusNodeEndpoints:u,torusNodePub:l,torusIndexes:f}),d=this.sentryHandler.startTransaction({name:pn}),e.next=12,this.torus.getPublicAddress(u,l,{verifier:t,verifierId:r},!0);case 12:if(h=e.sent,this.sentryHandler.finishTransaction(d),"string"!==typeof h){e.next=16;break}throw new Error("must use extended pub key");case 16:return mn.debug("torus-direct/getTorusKey",{getPublicAddress:h}),p=this.sentryHandler.startTransaction({name:vn}),e.next=20,this.torus.retrieveShares(u,f,t,n,a,o);case 20:if(v=e.sent,this.sentryHandler.finishTransaction(p),v.ethAddress.toLowerCase()===h.address.toLowerCase()){e.next=24;break}throw new Error("data ethAddress does not match response address");case 24:return mn.debug("torus-direct/getTorusKey",{retrieveShares:v}),e.abrupt("return",{publicAddress:v.ethAddress.toString(),privateKey:v.privKey.toString(),metadataNonce:v.metadataNonce.toString("hex"),typeOfUser:h.typeOfUser,pubKey:{pub_key_X:h.X,pub_key_Y:h.Y}});case 26:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"getAggregateTorusKey",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,o,s,c,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a={verify_params:[],sub_verifier_ids:[],verifier_id:""},o=[],s={},c=0;c<n.length;c+=1)u=n[c],a.verify_params.push({verifier_id:r,idtoken:u.idToken}),a.sub_verifier_ids.push(u.verifier),o.push(u.idToken),s=u.extraVerifierParams;return o.sort(),l=(0,m.wn)(Br.from(o.join(String.fromCharCode(29)),"utf8")).slice(2),a.verifier_id=r,e.abrupt("return",this.getTorusKey(t,r,a,l,s));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getPostboxKeyFrom1OutOf1",value:function(e,t){return this.torus.getPostboxKeyFrom1OutOf1(e,t)}},{key:"getRedirectResult",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,o,s,c,u,l,f,d,h,p,v,m,g,y,b,w,k,x,S,O=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t=O.length>0&&void 0!==O[0]?O[0]:{}).replaceUrl,n=void 0===r||r,a=t.clearLoginDetails,o=void 0===a||a,e.next=3,this.init({skipInit:!0});case 3:if(s=new URL(window.location.href),c=s.hash.substring(1),u={},s.searchParams.forEach((function(e,t){u[t]=e})),n&&(l=window.location.origin+window.location.pathname,window.history.replaceState(null,"",l)),c||0!==Object.keys(u).length){e.next=10;break}throw new Error("Unable to fetch result from OAuth login");case 10:return f=xn(c,u),d=f.error,h=f.instanceParameters,p=f.hashParameters,v=h.instanceId,mn.info(v,"instanceId"),e.next=15,this.storageHelper.retrieveLoginDetails(v);case 15:if(m=e.sent,g=m.args,y=m.method,b=(0,q.Z)(m,Gn),mn.info(g,y),o&&this.storageHelper.clearLoginDetailsStorage(v),!d){e.next=23;break}return e.abrupt("return",{error:d,state:h||{},method:y,result:{},hashParameters:p,args:g});case 23:if(e.prev=23,y!==ln){e.next=33;break}return(k=g).hash=c,k.queryParameters=u,e.next=30,this.triggerLogin(k);case 30:w=e.sent,e.next=48;break;case 33:if(y!==fn){e.next=41;break}return(x=g).subVerifierDetailsArray.forEach((function(e){e.hash=c,e.queryParameters=u})),e.next=38,this.triggerAggregateLogin(x);case 38:w=e.sent,e.next=48;break;case 41:if(y!==dn){e.next=48;break}return(S=g).singleLogin.hash=c,S.singleLogin.queryParameters=u,e.next=47,this.triggerHybridAggregateLogin(S);case 47:w=e.sent;case 48:e.next=54;break;case 50:return e.prev=50,e.t0=e.catch(23),mn.error(e.t0),e.abrupt("return",Qn({error:"Could not get result from torus nodes \n ".concat((null===e.t0||void 0===e.t0?void 0:e.t0.message)||""),state:h||{},method:y,result:{},hashParameters:p,args:g},b));case 54:if(w){e.next=56;break}return e.abrupt("return",Qn({error:"Unsupported method type",state:h||{},method:y,result:{},hashParameters:p,args:g},b));case 56:return e.abrupt("return",Qn({method:y,result:w,state:h||{},hashParameters:p,args:g},b));case 57:case"end":return e.stop()}}),e,this,[[23,50]])})));return function(){return e.apply(this,arguments)}}()},{key:"handlePrefetchRedirectUri",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(document){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",new Promise((function(e,r){var n=document.createElement("link");n.href=t.config.redirect_uri,window.location.origin!==new URL(t.config.redirect_uri).origin&&(n.crossOrigin="anonymous"),n.type="text/html",n.rel="prefetch";var i=function(){t.isInitialized=!0,e()};try{n.relList&&n.relList.supports&&n.relList.supports("prefetch")?(n.onload=i,n.onerror=function(){r(new Error("Please serve redirect.html present in serviceworker folder of this package on ".concat(t.config.redirect_uri)))},document.head.appendChild(n)):i()}catch(Ki){i()}})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function ti(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ri(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ti(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ti(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ni=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;(0,s.Z)(this,r);var i=e.enableLogging,a=void 0!==i&&i,c=e.postboxKey,u=e.customAuthArgs;return n=t.call(this,{enableLogging:a,postboxKey:c}),(0,o.Z)((0,p.Z)(n),"directWeb",void 0),(0,o.Z)((0,p.Z)(n),"singleLoginKey",void 0),(0,o.Z)((0,p.Z)(n),"customAuthArgs",void 0),n.customAuthArgs=u,n.directWeb=new ei(u),n.serviceProviderName="TorusServiceProvider",n}return(0,c.Z)(r,[{key:"init",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.directWeb.init(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"triggerLogin",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.directWeb.triggerLogin(t);case 2:return r=e.sent,this.postboxKey=new(w())(r.privateKey,"hex"),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"triggerAggregateLogin",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.directWeb.triggerAggregateLogin(t);case 2:return r=e.sent,this.postboxKey=new(w())(r.privateKey,"hex"),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"triggerHybridAggregateLogin",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.directWeb.triggerHybridAggregateLogin(t);case 2:return r=e.sent,n=r.aggregateLogins[0].privateKey,this.postboxKey=new(w())(n,"hex"),this.singleLoginKey=new(w())(r.singleLogin.privateKey,"hex"),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return ri(ri({},(0,u.Z)((0,l.Z)(r.prototype),"toJSON",this).call(this)),{},{serviceProviderName:this.serviceProviderName,customAuthArgs:this.customAuthArgs})}}],[{key:"fromJSON",value:function(e){var t=e.enableLogging,n=e.postboxKey,i=e.customAuthArgs;if("TorusServiceProvider"===e.serviceProviderName)return new r({enableLogging:t,postboxKey:n,customAuthArgs:i})}}]),r}(R),ii=r(89274),ai=r(21944);var oi=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this)).blockLen=e,o.outputLen=n,o.padOffset=i,o.isLE=a,o.finished=!1,o.length=0,o.pos=0,o.destroyed=!1,o.buffer=new Uint8Array(e),o.view=(0,ai.GL)(o.buffer),o}return(0,c.Z)(r,[{key:"update",value:function(e){ii.ZP.exists(this);for(var t=this.view,r=this.buffer,n=this.blockLen,i=(e=(0,ai.O0)(e)).length,a=0;a<i;){var o=Math.min(n-this.pos,i-a);if(o!==n)r.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===n&&(this.process(t,0),this.pos=0);else for(var s=(0,ai.GL)(e);n<=i-a;a+=n)this.process(s,a)}return this.length+=e.length,this.roundClean(),this}},{key:"digestInto",value:function(e){ii.ZP.exists(this),ii.ZP.output(e,this),this.finished=!0;var t=this.buffer,r=this.view,n=this.blockLen,i=this.isLE,a=this.pos;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>n-a&&(this.process(r,0),a=0);for(var o=a;o<n;o++)t[o]=0;!function(e,t,r,n){if("function"===typeof e.setBigUint64)return e.setBigUint64(t,r,n);var i=BigInt(32),a=BigInt(4294967295),o=Number(r>>i&a),s=Number(r&a),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,s,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);var s=(0,ai.GL)(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");var u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(var f=0;f<u;f++)s.setUint32(4*f,l[f],i)}},{key:"digest",value:function(){var e=this.buffer,t=this.outputLen;this.digestInto(e);var r=e.slice(0,t);return this.destroy(),r}},{key:"_cloneInto",value:function(e){var t;e||(e=new this.constructor),(t=e).set.apply(t,(0,h.Z)(this.get()));var r=this.blockLen,n=this.buffer,i=this.length,a=this.finished,o=this.destroyed,s=this.pos;return e.length=i,e.pos=s,e.finished=a,e.destroyed=o,i%r&&e.buffer.set(n),e}}]),r}(ai.kb),si=function(e,t,r){return e&t^e&r^t&r},ci=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ui=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),li=new Uint32Array(64),fi=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.call(this,64,32,8,!1)).A=0|ui[0],e.B=0|ui[1],e.C=0|ui[2],e.D=0|ui[3],e.E=0|ui[4],e.F=0|ui[5],e.G=0|ui[6],e.H=0|ui[7],e}return(0,c.Z)(r,[{key:"get",value:function(){return[this.A,this.B,this.C,this.D,this.E,this.F,this.G,this.H]}},{key:"set",value:function(e,t,r,n,i,a,o,s){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|a,this.G=0|o,this.H=0|s}},{key:"process",value:function(e,t){for(var r=0;r<16;r++,t+=4)li[r]=e.getUint32(t,!1);for(var n=16;n<64;n++){var i=li[n-15],a=li[n-2],o=(0,ai.np)(i,7)^(0,ai.np)(i,18)^i>>>3,s=(0,ai.np)(a,17)^(0,ai.np)(a,19)^a>>>10;li[n]=s+li[n-7]+o+li[n-16]|0}for(var c,u=this.A,l=this.B,f=this.C,d=this.D,h=this.E,p=this.F,v=this.G,m=this.H,g=0;g<64;g++){var y=m+((0,ai.np)(h,6)^(0,ai.np)(h,11)^(0,ai.np)(h,25))+((c=h)&p^~c&v)+ci[g]+li[g]|0,b=((0,ai.np)(u,2)^(0,ai.np)(u,13)^(0,ai.np)(u,22))+si(u,l,f)|0;m=v,v=p,p=h,h=d+y|0,d=f,f=l,l=u,u=y+b|0}u=u+this.A|0,l=l+this.B|0,f=f+this.C|0,d=d+this.D|0,h=h+this.E|0,p=p+this.F|0,v=v+this.G|0,m=m+this.H|0,this.set(u,l,f,d,h,p,v,m)}},{key:"roundClean",value:function(){li.fill(0)}},{key:"destroy",value:function(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}]),r}(oi),di=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.call(this)).A=-1056596264,e.B=914150663,e.C=812702999,e.D=-150054599,e.E=-4191439,e.F=1750603025,e.G=1694076839,e.H=-1090891868,e.outputLen=28,e}return(0,c.Z)(r)}(fi),hi=(0,ai.hE)((function(){return new fi})),pi=((0,ai.hE)((function(){return new di})),(0,r(9642).gn)(hi)),vi=r(80080).Buffer,mi=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),i=t.call(this,e,n),Object.defineProperty((0,p.Z)(i),"name",{value:"ShareSerializationError"}),i}return(0,c.Z)(r,null,[{key:"fromCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new r(e,"".concat(r.messages[e]).concat(t))}},{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new r(7e3,"".concat(r.messages[7e3]).concat(e))}},{key:"typeNotSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(7010,e)}},{key:"invalidEntropy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(7011,e)}},{key:"invalidChecksum",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(7012,e)}},{key:"invalidMnemonic",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(7013,e)}}]),r}(v.VZ);(0,o.Z)(mi,"messages",{7e3:"Custom",7010:"Type is not supported",7011:"Invalid Entropy",7012:"Invalid Checksum",7013:"Invalid mnemonic"});var gi=["abandon","ability","able","about","above","absent","absorb","abstract","absurd","abuse","access","accident","account","accuse","achieve","acid","acoustic","acquire","across","act","action","actor","actress","actual","adapt","add","addict","address","adjust","admit","adult","advance","advice","aerobic","affair","afford","afraid","again","age","agent","agree","ahead","aim","air","airport","aisle","alarm","album","alcohol","alert","alien","all","alley","allow","almost","alone","alpha","already","also","alter","always","amateur","amazing","among","amount","amused","analyst","anchor","ancient","anger","angle","angry","animal","ankle","announce","annual","another","answer","antenna","antique","anxiety","any","apart","apology","appear","apple","approve","april","arch","arctic","area","arena","argue","arm","armed","armor","army","around","arrange","arrest","arrive","arrow","art","artefact","artist","artwork","ask","aspect","assault","asset","assist","assume","asthma","athlete","atom","attack","attend","attitude","attract","auction","audit","august","aunt","author","auto","autumn","average","avocado","avoid","awake","aware","away","awesome","awful","awkward","axis","baby","bachelor","bacon","badge","bag","balance","balcony","ball","bamboo","banana","banner","bar","barely","bargain","barrel","base","basic","basket","battle","beach","bean","beauty","because","become","beef","before","begin","behave","behind","believe","below","belt","bench","benefit","best","betray","better","between","beyond","bicycle","bid","bike","bind","biology","bird","birth","bitter","black","blade","blame","blanket","blast","bleak","bless","blind","blood","blossom","blouse","blue","blur","blush","board","boat","body","boil","bomb","bone","bonus","book","boost","border","boring","borrow","boss","bottom","bounce","box","boy","bracket","brain","brand","brass","brave","bread","breeze","brick","bridge","brief","bright","bring","brisk","broccoli","broken","bronze","broom","brother","brown","brush","bubble","buddy","budget","buffalo","build","bulb","bulk","bullet","bundle","bunker","burden","burger","burst","bus","business","busy","butter","buyer","buzz","cabbage","cabin","cable","cactus","cage","cake","call","calm","camera","camp","can","canal","cancel","candy","cannon","canoe","canvas","canyon","capable","capital","captain","car","carbon","card","cargo","carpet","carry","cart","case","cash","casino","castle","casual","cat","catalog","catch","category","cattle","caught","cause","caution","cave","ceiling","celery","cement","census","century","cereal","certain","chair","chalk","champion","change","chaos","chapter","charge","chase","chat","cheap","check","cheese","chef","cherry","chest","chicken","chief","child","chimney","choice","choose","chronic","chuckle","chunk","churn","cigar","cinnamon","circle","citizen","city","civil","claim","clap","clarify","claw","clay","clean","clerk","clever","click","client","cliff","climb","clinic","clip","clock","clog","close","cloth","cloud","clown","club","clump","cluster","clutch","coach","coast","coconut","code","coffee","coil","coin","collect","color","column","combine","come","comfort","comic","common","company","concert","conduct","confirm","congress","connect","consider","control","convince","cook","cool","copper","copy","coral","core","corn","correct","cost","cotton","couch","country","couple","course","cousin","cover","coyote","crack","cradle","craft","cram","crane","crash","crater","crawl","crazy","cream","credit","creek","crew","cricket","crime","crisp","critic","crop","cross","crouch","crowd","crucial","cruel","cruise","crumble","crunch","crush","cry","crystal","cube","culture","cup","cupboard","curious","current","curtain","curve","cushion","custom","cute","cycle","dad","damage","damp","dance","danger","daring","dash","daughter","dawn","day","deal","debate","debris","decade","december","decide","decline","decorate","decrease","deer","defense","define","defy","degree","delay","deliver","demand","demise","denial","dentist","deny","depart","depend","deposit","depth","deputy","derive","describe","desert","design","desk","despair","destroy","detail","detect","develop","device","devote","diagram","dial","diamond","diary","dice","diesel","diet","differ","digital","dignity","dilemma","dinner","dinosaur","direct","dirt","disagree","discover","disease","dish","dismiss","disorder","display","distance","divert","divide","divorce","dizzy","doctor","document","dog","doll","dolphin","domain","donate","donkey","donor","door","dose","double","dove","draft","dragon","drama","drastic","draw","dream","dress","drift","drill","drink","drip","drive","drop","drum","dry","duck","dumb","dune","during","dust","dutch","duty","dwarf","dynamic","eager","eagle","early","earn","earth","easily","east","easy","echo","ecology","economy","edge","edit","educate","effort","egg","eight","either","elbow","elder","electric","elegant","element","elephant","elevator","elite","else","embark","embody","embrace","emerge","emotion","employ","empower","empty","enable","enact","end","endless","endorse","enemy","energy","enforce","engage","engine","enhance","enjoy","enlist","enough","enrich","enroll","ensure","enter","entire","entry","envelope","episode","equal","equip","era","erase","erode","erosion","error","erupt","escape","essay","essence","estate","eternal","ethics","evidence","evil","evoke","evolve","exact","example","excess","exchange","excite","exclude","excuse","execute","exercise","exhaust","exhibit","exile","exist","exit","exotic","expand","expect","expire","explain","expose","express","extend","extra","eye","eyebrow","fabric","face","faculty","fade","faint","faith","fall","false","fame","family","famous","fan","fancy","fantasy","farm","fashion","fat","fatal","father","fatigue","fault","favorite","feature","february","federal","fee","feed","feel","female","fence","festival","fetch","fever","few","fiber","fiction","field","figure","file","film","filter","final","find","fine","finger","finish","fire","firm","first","fiscal","fish","fit","fitness","fix","flag","flame","flash","flat","flavor","flee","flight","flip","float","flock","floor","flower","fluid","flush","fly","foam","focus","fog","foil","fold","follow","food","foot","force","forest","forget","fork","fortune","forum","forward","fossil","foster","found","fox","fragile","frame","frequent","fresh","friend","fringe","frog","front","frost","frown","frozen","fruit","fuel","fun","funny","furnace","fury","future","gadget","gain","galaxy","gallery","game","gap","garage","garbage","garden","garlic","garment","gas","gasp","gate","gather","gauge","gaze","general","genius","genre","gentle","genuine","gesture","ghost","giant","gift","giggle","ginger","giraffe","girl","give","glad","glance","glare","glass","glide","glimpse","globe","gloom","glory","glove","glow","glue","goat","goddess","gold","good","goose","gorilla","gospel","gossip","govern","gown","grab","grace","grain","grant","grape","grass","gravity","great","green","grid","grief","grit","grocery","group","grow","grunt","guard","guess","guide","guilt","guitar","gun","gym","habit","hair","half","hammer","hamster","hand","happy","harbor","hard","harsh","harvest","hat","have","hawk","hazard","head","health","heart","heavy","hedgehog","height","hello","helmet","help","hen","hero","hidden","high","hill","hint","hip","hire","history","hobby","hockey","hold","hole","holiday","hollow","home","honey","hood","hope","horn","horror","horse","hospital","host","hotel","hour","hover","hub","huge","human","humble","humor","hundred","hungry","hunt","hurdle","hurry","hurt","husband","hybrid","ice","icon","idea","identify","idle","ignore","ill","illegal","illness","image","imitate","immense","immune","impact","impose","improve","impulse","inch","include","income","increase","index","indicate","indoor","industry","infant","inflict","inform","inhale","inherit","initial","inject","injury","inmate","inner","innocent","input","inquiry","insane","insect","inside","inspire","install","intact","interest","into","invest","invite","involve","iron","island","isolate","issue","item","ivory","jacket","jaguar","jar","jazz","jealous","jeans","jelly","jewel","job","join","joke","journey","joy","judge","juice","jump","jungle","junior","junk","just","kangaroo","keen","keep","ketchup","key","kick","kid","kidney","kind","kingdom","kiss","kit","kitchen","kite","kitten","kiwi","knee","knife","knock","know","lab","label","labor","ladder","lady","lake","lamp","language","laptop","large","later","latin","laugh","laundry","lava","law","lawn","lawsuit","layer","lazy","leader","leaf","learn","leave","lecture","left","leg","legal","legend","leisure","lemon","lend","length","lens","leopard","lesson","letter","level","liar","liberty","library","license","life","lift","light","like","limb","limit","link","lion","liquid","list","little","live","lizard","load","loan","lobster","local","lock","logic","lonely","long","loop","lottery","loud","lounge","love","loyal","lucky","luggage","lumber","lunar","lunch","luxury","lyrics","machine","mad","magic","magnet","maid","mail","main","major","make","mammal","man","manage","mandate","mango","mansion","manual","maple","marble","march","margin","marine","market","marriage","mask","mass","master","match","material","math","matrix","matter","maximum","maze","meadow","mean","measure","meat","mechanic","medal","media","melody","melt","member","memory","mention","menu","mercy","merge","merit","merry","mesh","message","metal","method","middle","midnight","milk","million","mimic","mind","minimum","minor","minute","miracle","mirror","misery","miss","mistake","mix","mixed","mixture","mobile","model","modify","mom","moment","monitor","monkey","monster","month","moon","moral","more","morning","mosquito","mother","motion","motor","mountain","mouse","move","movie","much","muffin","mule","multiply","muscle","museum","mushroom","music","must","mutual","myself","mystery","myth","naive","name","napkin","narrow","nasty","nation","nature","near","neck","need","negative","neglect","neither","nephew","nerve","nest","net","network","neutral","never","news","next","nice","night","noble","noise","nominee","noodle","normal","north","nose","notable","note","nothing","notice","novel","now","nuclear","number","nurse","nut","oak","obey","object","oblige","obscure","observe","obtain","obvious","occur","ocean","october","odor","off","offer","office","often","oil","okay","old","olive","olympic","omit","once","one","onion","online","only","open","opera","opinion","oppose","option","orange","orbit","orchard","order","ordinary","organ","orient","original","orphan","ostrich","other","outdoor","outer","output","outside","oval","oven","over","own","owner","oxygen","oyster","ozone","pact","paddle","page","pair","palace","palm","panda","panel","panic","panther","paper","parade","parent","park","parrot","party","pass","patch","path","patient","patrol","pattern","pause","pave","payment","peace","peanut","pear","peasant","pelican","pen","penalty","pencil","people","pepper","perfect","permit","person","pet","phone","photo","phrase","physical","piano","picnic","picture","piece","pig","pigeon","pill","pilot","pink","pioneer","pipe","pistol","pitch","pizza","place","planet","plastic","plate","play","please","pledge","pluck","plug","plunge","poem","poet","point","polar","pole","police","pond","pony","pool","popular","portion","position","possible","post","potato","pottery","poverty","powder","power","practice","praise","predict","prefer","prepare","present","pretty","prevent","price","pride","primary","print","priority","prison","private","prize","problem","process","produce","profit","program","project","promote","proof","property","prosper","protect","proud","provide","public","pudding","pull","pulp","pulse","pumpkin","punch","pupil","puppy","purchase","purity","purpose","purse","push","put","puzzle","pyramid","quality","quantum","quarter","question","quick","quit","quiz","quote","rabbit","raccoon","race","rack","radar","radio","rail","rain","raise","rally","ramp","ranch","random","range","rapid","rare","rate","rather","raven","raw","razor","ready","real","reason","rebel","rebuild","recall","receive","recipe","record","recycle","reduce","reflect","reform","refuse","region","regret","regular","reject","relax","release","relief","rely","remain","remember","remind","remove","render","renew","rent","reopen","repair","repeat","replace","report","require","rescue","resemble","resist","resource","response","result","retire","retreat","return","reunion","reveal","review","reward","rhythm","rib","ribbon","rice","rich","ride","ridge","rifle","right","rigid","ring","riot","ripple","risk","ritual","rival","river","road","roast","robot","robust","rocket","romance","roof","rookie","room","rose","rotate","rough","round","route","royal","rubber","rude","rug","rule","run","runway","rural","sad","saddle","sadness","safe","sail","salad","salmon","salon","salt","salute","same","sample","sand","satisfy","satoshi","sauce","sausage","save","say","scale","scan","scare","scatter","scene","scheme","school","science","scissors","scorpion","scout","scrap","screen","script","scrub","sea","search","season","seat","second","secret","section","security","seed","seek","segment","select","sell","seminar","senior","sense","sentence","series","service","session","settle","setup","seven","shadow","shaft","shallow","share","shed","shell","sheriff","shield","shift","shine","ship","shiver","shock","shoe","shoot","shop","short","shoulder","shove","shrimp","shrug","shuffle","shy","sibling","sick","side","siege","sight","sign","silent","silk","silly","silver","similar","simple","since","sing","siren","sister","situate","six","size","skate","sketch","ski","skill","skin","skirt","skull","slab","slam","sleep","slender","slice","slide","slight","slim","slogan","slot","slow","slush","small","smart","smile","smoke","smooth","snack","snake","snap","sniff","snow","soap","soccer","social","sock","soda","soft","solar","soldier","solid","solution","solve","someone","song","soon","sorry","sort","soul","sound","soup","source","south","space","spare","spatial","spawn","speak","special","speed","spell","spend","sphere","spice","spider","spike","spin","spirit","split","spoil","sponsor","spoon","sport","spot","spray","spread","spring","spy","square","squeeze","squirrel","stable","stadium","staff","stage","stairs","stamp","stand","start","state","stay","steak","steel","stem","step","stereo","stick","still","sting","stock","stomach","stone","stool","story","stove","strategy","street","strike","strong","struggle","student","stuff","stumble","style","subject","submit","subway","success","such","sudden","suffer","sugar","suggest","suit","summer","sun","sunny","sunset","super","supply","supreme","sure","surface","surge","surprise","surround","survey","suspect","sustain","swallow","swamp","swap","swarm","swear","sweet","swift","swim","swing","switch","sword","symbol","symptom","syrup","system","table","tackle","tag","tail","talent","talk","tank","tape","target","task","taste","tattoo","taxi","teach","team","tell","ten","tenant","tennis","tent","term","test","text","thank","that","theme","then","theory","there","they","thing","this","thought","three","thrive","throw","thumb","thunder","ticket","tide","tiger","tilt","timber","time","tiny","tip","tired","tissue","title","toast","tobacco","today","toddler","toe","together","toilet","token","tomato","tomorrow","tone","tongue","tonight","tool","tooth","top","topic","topple","torch","tornado","tortoise","toss","total","tourist","toward","tower","town","toy","track","trade","traffic","tragic","train","transfer","trap","trash","travel","tray","treat","tree","trend","trial","tribe","trick","trigger","trim","trip","trophy","trouble","truck","true","truly","trumpet","trust","truth","try","tube","tuition","tumble","tuna","tunnel","turkey","turn","turtle","twelve","twenty","twice","twin","twist","two","type","typical","ugly","umbrella","unable","unaware","uncle","uncover","under","undo","unfair","unfold","unhappy","uniform","unique","unit","universe","unknown","unlock","until","unusual","unveil","update","upgrade","uphold","upon","upper","upset","urban","urge","usage","use","used","useful","useless","usual","utility","vacant","vacuum","vague","valid","valley","valve","van","vanish","vapor","various","vast","vault","vehicle","velvet","vendor","venture","venue","verb","verify","version","very","vessel","veteran","viable","vibrant","vicious","victory","video","view","village","vintage","violin","virtual","virus","visa","visit","visual","vital","vivid","vocal","voice","void","volcano","volume","vote","voyage","wage","wagon","wait","walk","wall","walnut","want","warfare","warm","warrior","wash","wasp","waste","water","wave","way","wealth","weapon","wear","weasel","weather","web","wedding","weekend","weird","welcome","west","wet","whale","what","wheat","wheel","when","where","whip","whisper","wide","width","wife","wild","will","win","window","wine","wing","wink","winner","winter","wire","wisdom","wise","wish","witness","wolf","woman","wonder","wood","wool","word","work","world","worry","worth","wrap","wreck","wrestle","wrist","write","wrong","yard","year","yellow","you","young","youth","zebra","zero","zone","zoo"];function yi(e){return parseInt(e,2)}function bi(e,t,r){for(var n=e;n.length<r;)n=t+n;return n}function wi(e){return e.map((function(e){return bi(e.toString(2),"0",8)})).join("")}function ki(e){var t=8*e.length/32,r=pi(e);return wi(Array.from(r)).slice(0,t)}var xi="shareSerialization",Si=function(){function e(){(0,s.Z)(this,e),(0,o.Z)(this,"moduleName",void 0),(0,o.Z)(this,"tbSDK",void 0),this.moduleName=xi}return(0,c.Z)(e,[{key:"setModuleReferences",value:function(e){this.tbSDK=e,this.tbSDK._addShareSerializationMiddleware(this.serialize.bind(this),this.deserialize.bind(this))}},{key:"initialize",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("mnemonic"!==n){t.next=2;break}return t.abrupt("return",e.serializeMnemonic(r));case 2:throw mi.typeNotSupported();case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"deserialize",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("mnemonic"!==n){t.next=2;break}return t.abrupt("return",e.deserializeMnemonic(r));case 2:throw mi.typeNotSupported();case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}],[{key:"serializeMnemonic",value:function(e){return function(e,t){var r;if(vi.isBuffer(e)||(r=vi.from(e,"hex")),r.length<16)throw mi.invalidEntropy();if(r.length>32)throw mi.invalidEntropy();if(r.length%4!==0)throw mi.invalidEntropy();var n=(wi(Array.from(r))+ki(r)).match(/(.{1,11})/g).map((function(e){var r=yi(e);return t[r]}));return"\u3042\u3044\u3053\u304f\u3057\u3093"===t[0]?n.join("\u3000"):n.join(" ")}(e.toString("hex").padStart(64,"0"),gi)}},{key:"deserializeMnemonic",value:function(e){return new(w())(function(e,t){var r,n=(r=e,(r||"").normalize("NFKD")).split(" ");if(n.length%3!==0)throw mi.invalidMnemonic();var i=n.map((function(e){var r=t.indexOf(e);if(-1===r)throw mi.invalidMnemonic();return bi(r.toString(2),"0",11)})).join(""),a=32*Math.floor(i.length/33),o=i.slice(0,a),s=i.slice(a),c=o.match(/(.{1,8})/g).map(yi);if(c.length<16)throw mi.invalidEntropy();if(c.length>32)throw mi.invalidEntropy();if(c.length%4!==0)throw mi.invalidEntropy();var u=vi.from(c);if(ki(u)!==s)throw mi.invalidChecksum();return u.toString("hex")}(e,gi),"hex")}}]),e}(),Oi=r(80080).Buffer,_i=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),i=t.call(this,e,n),Object.defineProperty((0,p.Z)(i),"name",{value:"ShareTransferError"}),i}return(0,c.Z)(r,null,[{key:"fromCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new r(e,"".concat(r.messages[e]).concat(t))}},{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new r(8e3,"".concat(r.messages[8e3]).concat(e))}},{key:"missingEncryptionKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(8010,e)}},{key:"requestExists",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(8011,e)}},{key:"userCancelledRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(8012,e)}}]),r}(v.VZ);(0,o.Z)(_i,"messages",{8e3:"Custom",8010:"Missing current enc key",8011:"Current request already exists",8012:"User cancelled request"});var Zi=(0,c.Z)((function e(t){(0,s.Z)(this,e);var r=t.encPubKey,n=t.encShareInTransit,i=t.availableShareIndexes,a=t.userAgent,c=t.userIp,u=t.timestamp;(0,o.Z)(this,"encPubKey",void 0),(0,o.Z)(this,"encShareInTransit",void 0),(0,o.Z)(this,"availableShareIndexes",void 0),(0,o.Z)(this,"userAgent",void 0),(0,o.Z)(this,"customInfo",void 0),(0,o.Z)(this,"userIp",void 0),(0,o.Z)(this,"timestamp",void 0);var l=r;"Buffer"===l.type?this.encPubKey=Oi.from(l.data):this.encPubKey=r,this.availableShareIndexes=i,this.encShareInTransit=n,this.userAgent=a,this.userIp=c,this.timestamp=u})),Pi=(0,c.Z)((function e(t){(0,s.Z)(this,e);var r=t.pointer;(0,o.Z)(this,"pointer",void 0),this.pointer=new(w())(r,"hex")}));function Ei(){return Mi.apply(this,arguments)}function Mi(){return(Mi=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,F.nK)(1e4,fetch("https://icanhazip.com",{}).then((function(e){if(e.ok)return e.text();throw e})));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return","");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var Ti="shareTransfer",Ii=function(){function e(){(0,s.Z)(this,e),(0,o.Z)(this,"moduleName",void 0),(0,o.Z)(this,"tbSDK",void 0),(0,o.Z)(this,"currentEncKey",void 0),(0,o.Z)(this,"requestStatusCheckId",void 0),(0,o.Z)(this,"requestStatusCheckInterval",void 0),this.moduleName=Ti,this.requestStatusCheckInterval=1e3}return(0,c.Z)(e,[{key:"setModuleReferences",value:function(t){this.tbSDK=t,this.tbSDK._addRefreshMiddleware(this.moduleName,e.refreshShareTransferMiddleware)}},{key:"setRequestStatusCheckInterval",value:function(e){this.requestStatusCheckInterval=e}},{key:"initialize",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.tbSDK.getMetadata(),(r=t.getGeneralStoreDomain(this.moduleName))?n=new Pi(r):(n={pointer:new(w())((0,k.oq)())},t.setGeneralStoreDomain(this.moduleName,n));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestNewShare",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var o,s,c,u,l,f=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.currentEncKey){e.next=2;break}throw _i.requestExists("".concat(this.currentEncKey.toString("hex")));case 2:return this.currentEncKey=new(w())((0,k.oq)()),e.next=5,Promise.all([this.getShareTransferStore(),Ei()]);case 5:return o=e.sent,s=(0,K.Z)(o,2),c=s[0],u=s[1],l=(0,v.I_)(this.currentEncKey).x.toString("hex"),c[l]=new Zi({encPubKey:(0,v.W)(this.currentEncKey),encShareInTransit:void 0,availableShareIndexes:r,userAgent:t,userIp:u,timestamp:Date.now()}),e.next=13,this.setShareTransferStore(c);case 13:return n&&(this.requestStatusCheckId=Number(setInterval((0,a.Z)((0,i.Z)().mark((function e(){var t,r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.getShareTransferStore();case 3:if(t=e.sent,f.currentEncKey){e.next=6;break}throw _i.missingEncryptionKey();case 6:if(!t[l].encShareInTransit){e.next=17;break}return e.next=9,(0,v.pe)((0,v.Kx)(f.currentEncKey),t[l].encShareInTransit);case 9:return r=e.sent,a=v.$O.fromJSON(JSON.parse(r.toString())),e.next=13,f.tbSDK.inputShareStoreSafe(a,!0);case 13:f._cleanUpCurrentRequest(),n(null,a),e.next=18;break;case 17:t[l]||(f._cleanUpCurrentRequest(),n(_i.userCancelledRequest()));case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),f._cleanUpCurrentRequest(),n(e.t0);case 24:case"end":return e.stop()}}),e,null,[[0,20]])}))),this.requestStatusCheckInterval))),e.abrupt("return",l);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"addCustomInfoToShareRequest",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getShareTransferStore();case 2:if((n=e.sent)[t]){e.next=5;break}throw _i.missingEncryptionKey();case 5:return n[t].customInfo=r,e.next=8,this.setShareTransferStore(n);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"lookForRequests",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getShareTransferStore();case 2:return t=e.sent,e.abrupt("return",Object.keys(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"approveRequest",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s,c,u,l,f,d,h,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getShareTransferStore();case 2:if((n=e.sent)[t]){e.next=5;break}throw _i.missingEncryptionKey();case 5:return r?a=Oi.from(JSON.stringify(r)):(o=new Zi(n[t]),s=o.availableShareIndexes,c=this.tbSDK.getMetadata(),u=c.getLatestPublicPolynomial(),l=u.getPolynomialID(),f=c.getShareIndexesForPolynomial(l),d=f.filter((function(e){return!s.includes(e)})),h=this.tbSDK.outputShareStore(d[0]),a=Oi.from(JSON.stringify(h))),p=new Zi(n[t]),e.next=9,(0,v.HI)(p.encPubKey,a);case 9:return n[t].encShareInTransit=e.sent,e.next=12,this.setShareTransferStore(n);case 12:this.currentEncKey=void 0;case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"approveRequestWithShareIndex",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.tbSDK.outputShareStore(r),e.abrupt("return",this.approveRequest(t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getShareTransferStore",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tbSDK.getMetadata(),r=new Pi(t.getGeneralStoreDomain(this.moduleName)),n=this.tbSDK.getStorageLayer(),e.abrupt("return",n.getMetadata({privKey:r.pointer}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setShareTransferStore",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.tbSDK.getMetadata(),n=new Pi(r.getGeneralStoreDomain(this.moduleName)),a=this.tbSDK.getStorageLayer(),e.next=5,a.setMetadata({input:t,privKey:n.pointer});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startRequestStatusCheck",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n.requestStatusCheckId=Number(setInterval((0,a.Z)((0,i.Z)().mark((function a(){var s,c,u;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,n.getShareTransferStore();case 3:if(s=i.sent,n.currentEncKey){i.next=6;break}throw _i.missingEncryptionKey();case 6:if(s[t]){i.next=11;break}n._cleanUpCurrentRequest(),o(_i.userCancelledRequest()),i.next=23;break;case 11:if(!s[t].encShareInTransit){i.next=23;break}return i.next=14,(0,v.pe)((0,v.Kx)(n.currentEncKey),s[t].encShareInTransit);case 14:return c=i.sent,u=v.$O.fromJSON(JSON.parse(c.toString())),i.next=18,n.tbSDK.inputShareStoreSafe(u,!0);case 18:if(!r){i.next=21;break}return i.next=21,n.deleteShareTransferStore(t);case 21:n._cleanUpCurrentRequest(),e(u);case 23:i.next=29;break;case 25:i.prev=25,i.t0=i.catch(0),n._cleanUpCurrentRequest(),o(i.t0);case 29:case"end":return i.stop()}}),a,null,[[0,25]])}))),n.requestStatusCheckInterval))})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"cancelRequestStatusCheck",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearInterval(this.requestStatusCheckId);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteShareTransferStore",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getShareTransferStore();case 2:return delete(r=e.sent)[t],e.next=6,this.setShareTransferStore(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetShareTransferStore",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tbSDK.getMetadata(),r={pointer:new(w())((0,k.oq)())},t.setGeneralStoreDomain(this.moduleName,r),e.next=5,this.tbSDK._syncShareMetadata();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_cleanUpCurrentRequest",value:function(){this.currentEncKey=void 0,clearInterval(this.requestStatusCheckId)}}],[{key:"refreshShareTransferMiddleware",value:function(e,t,r){var n=Object.keys(t).length;return Object.keys(r).length<=n?{pointer:new(w())((0,k.oq)())}:e}}]),e}(),Ni=r(80080).Buffer,Ai=function(){function e(){(0,s.Z)(this,e);var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dataMap:{},lockMap:{}},r=t.dataMap,n=t.lockMap;(0,o.Z)(this,"dataMap",void 0),(0,o.Z)(this,"storageLayerName",void 0),(0,o.Z)(this,"lockMap",void 0),(0,o.Z)(this,"serviceProvider",void 0),this.dataMap=r||{},this.lockMap=n||{},this.storageLayerName="MockStorageLayer"}return(0,c.Z)(e,[{key:"getMetadata",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.serviceProvider,n=t.privKey,a=n?(0,v.I_)(n).x:r.retrievePubKeyPoint().getX(),this.dataMap[a.toString("hex")]){e.next=5;break}return e.abrupt("return",Object.create({message:v.yu}));case 5:return e.abrupt("return",JSON.parse(this.dataMap[a.toString("hex")]));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setMetadata",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.serviceProvider,n=t.privKey,a=t.input,o=n?(0,v.I_)(n).x:r.retrievePubKeyPoint().getX(),this.dataMap[o.toString("hex")]=y()(a),e.abrupt("return",{message:"success"});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setMetadataStream",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.serviceProvider,n=t.privKey,t.input.forEach((function(e,t){var i;i=n&&n[t]?(0,v.I_)(n[t]).x:r.retrievePubKeyPoint().getX(),a.dataMap[i.toString("hex")]=y()(e)})),e.abrupt("return",{message:"success"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"acquireWriteLock",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.serviceProvider,n=t.privKey,a=n?(0,v.I_)(n).x:r.retrievePubKeyPoint().getX(),!this.lockMap[a.toString("hex")]){e.next=4;break}return e.abrupt("return",{status:0});case 4:return o=(0,v.y)(),this.lockMap[a.toString("hex")]=o,e.abrupt("return",{status:1,id:o});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"releaseWriteLock",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.serviceProvider,n=t.privKey,a=t.id,o=n?(0,v.I_)(n).x:r.retrievePubKeyPoint().getX(),this.lockMap[o.toString("hex")]){e.next=4;break}return e.abrupt("return",{status:0});case 4:if(a===this.lockMap[o.toString("hex")]){e.next=6;break}return e.abrupt("return",{status:2});case 6:return this.lockMap[o.toString("hex")]=null,e.abrupt("return",{status:1});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return{dataMap:this.dataMap,serviceProvider:this.serviceProvider,storageLayerName:this.storageLayerName}}}],[{key:"fromJSON",value:function(t){var r=t.dataMap,n=t.lockMap;if("MockStorageLayer"===t.storageLayerName)return new e({dataMap:r,lockMap:n})}}]),e}();function Li(e,t){return v.wz.sign((0,Yt.wn)(Ni.from(y()(e),"utf8")),(0,v.Kx)(t),"utf-8").toDER("hex")}var ji=function(){function e(t){(0,s.Z)(this,e);var r=t.enableLogging,n=void 0!==r&&r,i=t.hostUrl,a=void 0===i?"http://localhost:5051":i,c=t.serverTimeOffset,u=void 0===c?0:c;(0,o.Z)(this,"enableLogging",void 0),(0,o.Z)(this,"hostUrl",void 0),(0,o.Z)(this,"storageLayerName",void 0),(0,o.Z)(this,"serverTimeOffset",void 0),this.enableLogging=n,this.hostUrl=a,this.storageLayerName="TorusStorageLayer",this.serverTimeOffset=u}return(0,c.Z)(e,[{key:"getMetadata",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.serviceProvider,n=t.privKey,a=this.generateMetadataParams({},r,n),e.next=4,(0,F.v_)("".concat(this.hostUrl,"/get"),a);case 4:if(""!==(o=e.sent).message){e.next=7;break}return e.abrupt("return",Object.create({message:v.yu}));case 7:if(s=JSON.parse(atob(o.message)),!n){e.next=14;break}return e.next=11,(0,v.pe)((0,v.Kx)(n),s);case 11:c=e.sent,e.next=17;break;case 14:return e.next=16,r.decrypt(s);case 16:c=e.sent;case 17:return e.abrupt("return",JSON.parse(c.toString()));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setMetadata",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r){var n,a,o,s,c;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=r.serviceProvider,a=r.privKey,o=r.input,t.t0=this,t.next=5,e.serializeMetadataParamsInput(o,n,a);case 5:return t.t1=t.sent,t.t2=n,t.t3=a,s=t.t0.generateMetadataParams.call(t.t0,t.t1,t.t2,t.t3),t.next=11,(0,F.v_)("".concat(this.hostUrl,"/set"),s);case 11:return t.abrupt("return",t.sent);case 14:return t.prev=14,t.t4=t.catch(0),t.prev=16,t.next=19,t.t4.json();case 19:c=t.sent,t.next=25;break;case 22:throw t.prev=22,t.t5=t.catch(16),t.t4;case 25:if(!c){t.next=27;break}throw new Error((0,v.TV)(c));case 27:case"end":return t.stop()}}),t,this,[[0,14],[16,22]])})));return function(e){return t.apply(this,arguments)}}()},{key:"setMetadataStream",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r){var n,o,s,c,u,l,f,d,h,p=this;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=r.serviceProvider,o=r.privKey,s=r.input,c=s,t.next=5,Promise.all(c.map(function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,a){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=p,t.next=3,e.serializeMetadataParamsInput(r,n,o[a]);case 3:return t.t1=t.sent,t.t2=n,t.t3=o[a],t.abrupt("return",t.t0.generateMetadataParams.call(t.t0,t.t1,t.t2,t.t3));case 7:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 5:return u=t.sent,l=new FormData,u.forEach((function(e,t){l.append(t.toString(),JSON.stringify(e))})),f={mode:"cors",method:"POST",headers:{"Content-Type":void 0}},d={isUrlEncodedData:!0,timeout:6e5},t.next=12,(0,F.v_)("".concat(this.hostUrl,"/bulk_set_stream"),l,f,d);case 12:return t.abrupt("return",t.sent);case 15:return t.prev=15,t.t0=t.catch(0),t.prev=17,t.next=20,t.t0.json();case 20:h=t.sent,t.next=26;break;case 23:throw t.prev=23,t.t1=t.catch(17),t.t0;case 26:if(!h){t.next=28;break}throw new Error((0,v.TV)(h));case 28:case"end":return t.stop()}}),t,this,[[0,15],[17,23]])})));return function(e){return t.apply(this,arguments)}}()},{key:"generateMetadataParams",value:function(e,t,r){var n,i,a,o="tkey",s={data:e,timestamp:new(w())(~~((this.serverTimeOffset+Date.now())/1e3)).toString(16)};e===v.Nb&&(o=v.Wj,s.data="<deleted>");var c=(0,Yt.wn)(Ni.from(y()(s),"utf8"));if(r){var u=(0,v.nK)(r).sign(c);n=Ni.from(u.r.toString(16,64)+u.s.toString(16,64)+new(w())(0).toString(16,2),"hex").toString("base64");var l=(0,v.I_)(r);i=l.x.toString("hex"),a=l.y.toString("hex")}else{var f=t.retrievePubKeyPoint();n=t.sign(new(w())(c)),i=f.getX().toString("hex"),a=f.getY().toString("hex")}return{pub_key_X:i,pub_key_Y:a,set_data:s,signature:n,namespace:o}}},{key:"acquireWriteLock",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.serviceProvider,n=t.privKey,a={timestamp:Math.floor((this.serverTimeOffset+Date.now())/1e3)},o=n?Li(a,n):r.sign(new(w())((0,Yt.wn)(Ni.from(y()(a),"utf8")))),s={key:(0,v.nK)(n).getPublic("hex"),data:a,signature:o},e.abrupt("return",(0,F.v_)("".concat(this.hostUrl,"/acquireLock"),s));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"releaseWriteLock",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.serviceProvider,n=t.privKey,a=t.id,o={timestamp:Math.floor((this.serverTimeOffset+Date.now())/1e3)},s=n?Li(o,n):r.sign(new(w())((0,Yt.wn)(Ni.from(y()(o),"utf8")))),c={key:(0,v.nK)(n).getPublic("hex"),data:o,signature:s,id:a},e.abrupt("return",(0,F.v_)("".concat(this.hostUrl,"/releaseLock"),c));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return{enableLogging:this.enableLogging,hostUrl:this.hostUrl,storageLayerName:this.storageLayerName}}}],[{key:"serializeMetadataParamsInput",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,o,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==typeof t){e.next=5;break}if(!((a=t).message===v.Nb)){e.next=5;break}return e.abrupt("return",a.message);case 5:if(o=Ni.from(y()(t)),!n){e.next=12;break}return e.next=9,(0,v.HI)((0,v.W)(n),o);case 9:s=e.sent,e.next=15;break;case 12:return e.next=14,r.encrypt(o);case 14:s=e.sent;case 15:return c=btoa(y()(s)),e.abrupt("return",c);case 17:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(t){var r=t.enableLogging,n=t.hostUrl,i=t.storageLayerName,a=t.serverTimeOffset;if("TorusStorageLayer"===i)return new e({enableLogging:r,hostUrl:n,serverTimeOffset:void 0===a?0:a})}}]),e}();function Ci(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ri(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ci(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ci(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Di=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;(0,s.Z)(this,r);var i,a,c=e||{},u=c.modules,l=void 0===u?{}:u,f=c.serviceProvider,d=c.storageLayer,h=c.customAuthArgs,p=c.serverTimeOffset,v=(n={},(0,o.Z)(n,Ti,new Ii),(0,o.Z)(n,xi,new Si),n);return i=f||new ni({customAuthArgs:h}),a=d||new ji({hostUrl:"https://metadata.tor.us",serverTimeOffset:p}),t.call(this,Ri(Ri({},e||{}),{},{modules:Ri(Ri({},v),l),serviceProvider:i,storageLayer:a}))}return(0,c.Z)(r,null,[{key:"fromJSON",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a,s,c,f,d,h,p,v,m,g,y,b,w,k;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.storageLayer,c=t.serviceProvider,d=(f=n||{}).storageLayer,h=f.serviceProvider,p=f.modules,v=void 0===p?{}:p,m=f.customAuthArgs,g=f.serverTimeOffset,y=void 0===g?0:g,a={},(0,o.Z)(a,Ti,new Ii),(0,o.Z)(a,xi,new Si),b=a,w=h||ni.fromJSON(c)||R.fromJSON(c)||new ni({customAuthArgs:m}),s.serviceProvider=w,k=d||Ai.fromJSON(s)||ji.fromJSON(s)||new ji({hostUrl:"https://metadata.tor.us",serverTimeOffset:y}),e.abrupt("return",(0,u.Z)((0,l.Z)(r),"fromJSON",this).call(this,t,Ri(Ri({},n||{}),{},{modules:Ri(Ri({},b),v),serviceProvider:w,storageLayer:k})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(j)},62499:function(e,t,r){"use strict";r.d(t,{ZP:function(){return w}});var n=r(24611),i=r(53755),a=r(47061),o=r(59900),s=r(14771),c=r(24269),u=r(74086),l=r(20240),f=r(18771),d=r(54006),h=r.n(d),p=r(60107),v=r(80080).Buffer,m=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){var i;return(0,a.Z)(this,r),i=t.call(this,e,n),Object.defineProperty((0,s.Z)(i),"name",{value:"SecurityQuestionsError"}),i}return(0,o.Z)(r,null,[{key:"fromCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new r(e,"".concat(r.messages[e]).concat(t))}},{key:"unavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(2101,e)}},{key:"unableToReplace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(2102,e)}},{key:"incorrectAnswer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(2103,e)}},{key:"noPasswordSaved",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(2104,e)}}]),r}(f.VZ);(0,l.Z)(m,"messages",{2101:"security questions might not exist/be setup",2102:"security questions exists, cant replace, maybe change?",2103:"Incorrect answer",2104:"no password saved on tkeyStore"});var g=function(){function e(t){(0,a.Z)(this,e);var r=t.nonce,n=t.shareIndex,i=t.sqPublicShare,o=t.polynomialID,s=t.questions;(0,l.Z)(this,"nonce",void 0),(0,l.Z)(this,"shareIndex",void 0),(0,l.Z)(this,"sqPublicShare",void 0),(0,l.Z)(this,"polynomialID",void 0),(0,l.Z)(this,"questions",void 0),this.nonce=new(h())(r,"hex"),this.shareIndex=new(h())(n,"hex"),this.sqPublicShare=new f.su(i.shareIndex,i.shareCommitment),this.polynomialID=o,this.questions=s}return(0,o.Z)(e,[{key:"toJSON",value:function(){return{nonce:this.nonce.toString("hex"),shareIndex:this.shareIndex.toString("hex"),sqPublicShare:this.sqPublicShare,polynomialID:this.polynomialID.toString(),questions:this.questions}}}],[{key:"fromJSON",value:function(t){var r=t.nonce,n=t.shareIndex,i=t.sqPublicShare,a=t.polynomialID,o=t.questions;return new e({nonce:new(h())(r,"hex"),shareIndex:new(h())(n,"hex"),sqPublicShare:f.su.fromJSON(i),polynomialID:a,questions:o})}}]),e}();function y(e){return new(h())((0,p.wn)(v.from(e,"utf8")))}var b="answer",w=function(){function e(t){(0,a.Z)(this,e),(0,l.Z)(this,"moduleName",void 0),(0,l.Z)(this,"tbSDK",void 0),(0,l.Z)(this,"saveAnswers",void 0),this.saveAnswers=t,this.moduleName="securityQuestions"}return(0,o.Z)(e,[{key:"setModuleReferences",value:function(t){this.tbSDK=t,this.tbSDK._addRefreshMiddleware(this.moduleName,e.refreshSecurityQuestionsMiddleware)}},{key:"initialize",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"generateNewShareWithSecurityQuestions",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s,c,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tbSDK.getMetadata(),!i.getGeneralStoreDomain(this.moduleName)){e.next=4;break}throw m.unableToReplace();case 4:return e.next=6,this.tbSDK.generateNewShare();case 6:return a=e.sent,o=a.newShareStores[a.newShareIndex.toString("hex")],s=y(t),c=(c=o.share.share.sub(s)).umod(f.wz.curve.n),u=new g({nonce:c,questions:r,sqPublicShare:o.share.getPublicShare(),shareIndex:o.share.shareIndex,polynomialID:o.polynomialID}),i.setGeneralStoreDomain(this.moduleName,u),e.next=15,this.tbSDK.addShareDescription(a.newShareIndex.toString("hex"),JSON.stringify({module:this.moduleName,questions:r,dateAdded:Date.now()}),!1);case 15:return e.next=17,this.saveAnswerOnTkeyStore(t);case 17:return e.next=19,this.tbSDK._syncShareMetadata();case 19:return e.abrupt("return",a);case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSecurityQuestions",value:function(){var e=this.tbSDK.getMetadata();return new g(e.getGeneralStoreDomain(this.moduleName)).questions}},{key:"inputShareFromSecurityQuestions",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s,c,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.tbSDK.getMetadata(),i=r.getGeneralStoreDomain(this.moduleName)){e.next=4;break}throw m.unavailable();case 4:if(a=new g(i),o=y(t),s=(s=a.nonce.add(o)).umod(f.wz.curve.n),c=new f.$O(new f.mB(a.shareIndex,s),a.polynomialID),0===c.share.getPublicShare().shareCommitment.x.cmp(a.sqPublicShare.shareCommitment.x)){e.next=12;break}throw m.incorrectAnswer();case 12:return e.next=14,this.tbSDK.catchupToLatestShare({shareStore:c,includeLocalMetadataTransitions:!0});case 14:u=e.sent,this.tbSDK.inputShareStore(u.latestShare);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeSecurityQuestionAndAnswer",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s,c,u,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tbSDK.getMetadata(),a=i.getGeneralStoreDomain(this.moduleName)){e.next=4;break}throw m.unavailable();case 4:return o=new g(a),s=y(t),c=this.tbSDK.outputShareStore(o.shareIndex),u=(u=c.share.share.sub(s)).umod(f.wz.curve.n),l=new g({nonce:u,polynomialID:o.polynomialID,sqPublicShare:o.sqPublicShare,shareIndex:o.shareIndex,questions:r}),i.setGeneralStoreDomain(this.moduleName,l),e.next=13,this.saveAnswerOnTkeyStore(t);case 13:return e.next=15,this.tbSDK._syncShareMetadata();case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"saveAnswerOnTkeyStore",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.saveAnswers){e.next=2;break}return e.abrupt("return");case 2:return r={answer:t,id:b},e.next=5,this.tbSDK._setTKeyStoreItem(this.moduleName,r,!1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAnswer",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.saveAnswers){e.next=5;break}return e.next=3,this.tbSDK.getTKeyStoreItem(this.moduleName,b);case 3:return t=e.sent,e.abrupt("return",t.answer);case 5:throw m.noPasswordSaved();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"refreshSecurityQuestionsMiddleware",value:function(e,t,r){if(void 0===e||(0,f.Qr)(e))return e;var n=new g(e),i=n.shareIndex.toString("hex");if(t[i]&&r[i]){var a=t[i].share.share.sub(n.nonce),o=r[i].share.share.sub(a);return o=o.umod(f.wz.curve.n),new g({nonce:o,polynomialID:r[Object.keys(r)[0]].polynomialID,sqPublicShare:r[i].share.getPublicShare(),shareIndex:n.shareIndex,questions:n.questions})}}}]),e}()},77630:function(e,t,r){"use strict";r.d(t,{ZP:function(){return N}});var n=r(24611),i=r(53755),a=r(47061),o=r(59900),s=r(14771),c=r(24269),u=r(74086),l=r(20240),f=r(18771),d=r(54006),h=r.n(d),p=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){var i;return(0,a.Z)(this,r),i=t.call(this,e,n),Object.defineProperty((0,s.Z)(i),"name",{value:"WebStorageError"}),i}return(0,o.Z)(r,null,[{key:"fromCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new r(e,"".concat(r.messages[e]).concat(t))}},{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new r(3e3,"".concat(r.messages[3e3]).concat(e))}},{key:"unableToReadFromStorage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(3101,e)}},{key:"shareUnavailableInFileStorage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(3201,e)}},{key:"fileStorageUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(3202,e)}},{key:"localStorageUnavailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(3301,e)}},{key:"shareUnavailableInLocalStorage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.fromCode(3302,e)}}]),r}(f.VZ);function v(){if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self;throw new Error("Unable to locate window object.")}(0,l.Z)(p,"messages",{3e3:"default",3101:"unableToReadFromStorage",3201:"No Share exists in file system",3202:"No requestFileSystem",3301:"Local storage is not enabled",3302:"No share exists in localstorage"});var m=10485760;function g(e,t){var r=document.createElement("a");r.setAttribute("href","data:application/json;charset=utf-8,".concat(encodeURIComponent(t))),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}function y(){return b.apply(this,arguments)}function b(){return(b=(0,i.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){navigator.webkitPersistentStorage.requestQuota(m,e,t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var n=v();n.requestFileSystem=n.requestFileSystem||n.webkitRequestFileSystem,n.requestFileSystem(n.PERSISTENT,t,e,r)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t,r){return S.apply(this,arguments)}function S(){return(S=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.root.getFile(r,{create:i},(function(t){return e(t)}),n)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return _.apply(this,arguments)}function _(){return(_=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.file(e,r)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=v()).requestFileSystem=r.requestFileSystem||r.webkitRequestFileSystem,!r.requestFileSystem){e.next=18;break}return e.next=5,w(m);case 5:return i=e.sent,e.next=8,x(i,t,!1);case 8:return a=e.sent,e.next=11,O(a);case 11:return o=e.sent,e.next=14,o.text();case 14:if(s=e.sent){e.next=17;break}throw p.shareUnavailableInFileStorage();case 17:return e.abrupt("return",f.$O.fromJSON(JSON.parse(s)));case 18:throw p.fileStorageUnavailable();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s,c,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="".concat(r,".json"),a=JSON.stringify(t),(o=v()).requestFileSystem=o.requestFileSystem||o.webkitRequestFileSystem,!o.requestFileSystem){e.next=18;break}return e.next=7,y();case 7:return s=e.sent,e.next=10,w(s);case 10:return c=e.sent,e.next=13,x(c,r,!0);case 13:return u=e.sent,e.next=16,new Promise((function(e,t){u.createWriter((function(r){r.onwriteend=e,r.onerror=t;var n=new Blob([a],{type:"application/json"});r.write(n)}),t)}));case 16:e.next=19;break;case 18:g(i,a);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",navigator.permissions.query({name:"persistent-storage"}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function M(e){var t,r=v();try{t=r[e];var n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(i){return i instanceof DOMException&&(22===i.code||1014===i.code||"QuotaExceededError"===i.name||"NS_ERROR_DOM_QUOTA_REACHED"===i.name)&&t&&0!==t.length}}var T=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=JSON.stringify(t),M("localStorage")){e.next=3;break}throw p.localStorageUnavailable();case 3:v().localStorage.setItem(r,i);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M("localStorage")){e.next=2;break}throw p.localStorageUnavailable();case 2:if(r=v(),i=r.localStorage.getItem(t)){e.next=6;break}throw p.shareUnavailableInLocalStorage();case 6:return e.abrupt("return",f.$O.fromJSON(JSON.parse(i)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){function e(){(0,a.Z)(this,e);var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,l.Z)(this,"moduleName",void 0),(0,l.Z)(this,"tbSDK",void 0),(0,l.Z)(this,"canUseFileStorage",void 0),this.moduleName="webStorage",this.canUseFileStorage=t,this.setFileStorageAccess()}return(0,o.Z)(e,[{key:"setFileStorageAccess",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E();case 3:"denied"===(t=e.sent).state?this.canUseFileStorage=!1:"granted"===t.state&&(this.canUseFileStorage=!0),r=this,t.onchange=function(){"denied"===this.state?r.canUseFileStorage=!1:"granted"===this.state&&(r.canUseFileStorage=!0)},e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"setModuleReferences",value:function(e){this.tbSDK=e,this.tbSDK._setDeviceStorage(this.storeDeviceShare.bind(this))}},{key:"initialize",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"storeDeviceShare",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.tbSDK.getMetadata(),a=i.pubKey.x.toString("hex"),e.next=4,T(t,a);case 4:return o={module:this.moduleName,userAgent:navigator.userAgent,dateAdded:Date.now()},r&&(o.customDeviceInfo=JSON.stringify(r)),e.next=8,this.tbSDK.addShareDescription(t.share.shareIndex.toString("hex"),JSON.stringify(o),!0);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"storeDeviceShareOnFileStorage",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.tbSDK.getMetadata(),i=r.pubKey.x.toString("hex"),a=this.tbSDK.outputShareStore(new(h())(t)),e.abrupt("return",P(a,i));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDeviceShare",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t,r,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tbSDK.getMetadata(),r=t.pubKey.x.toString("hex"),e.prev=2,e.next=5,I(r);case 5:i=e.sent,e.next=22;break;case 8:if(e.prev=8,e.t0=e.catch(2),!this.canUseFileStorage){e.next=21;break}return e.prev=11,e.next=14,Z(r);case 14:i=e.sent,e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(11),null!==e.t1&&void 0!==e.t1&&null!==(a=e.t1.message)&&void 0!==a&&a.includes("storage quota")&&(this.canUseFileStorage=!1),p.unableToReadFromStorage("Error inputShareFromWebStorage: ".concat((0,f.TV)(e.t0)," and ").concat((0,f.TV)(e.t1)));case 21:throw p.unableToReadFromStorage("Error inputShareFromWebStorage: ".concat((0,f.TV)(e.t0)));case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,this,[[2,8],[11,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"inputShareFromWebStorage",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){var t,r,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDeviceShare();case 2:if(t=e.sent,r=t,(i=this.tbSDK.getMetadata()).getLatestPublicPolynomial().getPolynomialID()===t.polynomialID){e.next=12;break}return e.next=8,this.tbSDK.catchupToLatestShare({shareStore:t,includeLocalMetadataTransitions:!0});case 8:return r=e.sent.latestShare,a=i.pubKey.x.toString("hex"),e.next=12,T(r,a);case 12:this.tbSDK.inputShareStore(r);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}()},88902:function(e,t,r){"use strict";r.d(t,{X_:function(){return u},at:function(){return l},e9:function(){return d},wd:function(){return f}});var n,i,a,o=r(20240);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={SAPPHIRE_DEVNET:"sapphire_devnet",SAPPHIRE_TESTNET:"sapphire_testnet",SAPPHIRE_MAINNET:"sapphire_mainnet"},l=c(c({},{MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",AQUA:"aqua",CELESTE:"celeste"}),u),f=(n={},(0,o.Z)(n,l.MAINNET,"0xf20336e16B5182637f09821c27BDe29b0AFcfe80"),(0,o.Z)(n,l.TESTNET,"0xd084604e5FA387FbC2Da8bAab07fDD6aDED4614A"),(0,o.Z)(n,l.CYAN,"0x9f072ba19b3370e512aa1b4bfcdaf97283168005"),(0,o.Z)(n,l.AQUA,"0x29Dea82a0509153b91040ee13cDBba0f03efb625"),(0,o.Z)(n,l.CELESTE,"0x6Bffb4e89453069E7487f0fa5c9f4a2D771cce6c"),[l.AQUA,l.CELESTE,l.CYAN]),d=(i={},(0,o.Z)(i,l.MAINNET,"mainnet"),(0,o.Z)(i,l.TESTNET,"goerli"),(0,o.Z)(i,l.CYAN,"polygon-mainnet"),(0,o.Z)(i,l.AQUA,"polygon-mainnet"),(0,o.Z)(i,l.CELESTE,"polygon-mainnet"),a={},(0,o.Z)(a,l.MAINNET,"https://signer.tor.us"),(0,o.Z)(a,l.TESTNET,"https://signer.tor.us"),(0,o.Z)(a,l.CYAN,"https://signer-polygon.tor.us"),(0,o.Z)(a,l.AQUA,"https://signer-polygon.tor.us"),(0,o.Z)(a,l.CELESTE,"https://signer-polygon.tor.us"),a)},15826:function(e,t,r){"use strict";r.d(t,{HI:function(){return N},Xx:function(){return E},oq:function(){return Z},pe:function(){return A},rc:function(){return P}});var n=r(24611),i=r(53755),a=r(93220),o=r(80082),s=r(80080).Buffer,c=new o.ec("secp256k1"),u=r.g.crypto||r.g.msCrypto||{},l=u.subtle||u.webkitSubtle,f=s.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),d=s.alloc(32,0);function h(e,t){if(!e)throw new Error(t||"Assertion failed")}function p(e){return t=e,!(!s.isBuffer(t)||32!==t.length)&&(e.compare(d)>0&&e.compare(f)<0);var t}function v(e,t){if(e.length!==t.length)return!1;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}function m(e){var t=new Uint8Array(e);return"undefined"===typeof u.getRandomValues?s.from(a.randomBytes(e)):(u.getRandomValues(t),s.from(t))}function g(e){return y.apply(this,arguments)}function y(){return(y=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=6;break}return e.next=3,l.digest("SHA-512",t);case 3:return r=e.sent,i=new Uint8Array(r),e.abrupt("return",i);case 6:return o=a.createHash("sha512"),s=o.update(t).digest(),e.abrupt("return",new Uint8Array(s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return function(){var t=(0,i.Z)((0,n.Z)().mark((function t(r,i,o){var c,u,f,d,h,p,v,m,g,y;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!l){t.next=12;break}return c={name:"AES-CBC"},t.next=4,l.importKey("raw",i,c,!1,[e]);case 4:return u=t.sent,f={name:"AES-CBC",iv:r},t.next=8,l[e](f,u,o);case 8:return d=t.sent,t.abrupt("return",s.from(new Uint8Array(d)));case 12:if("encrypt"!==e){t.next=19;break}return h=a.createCipheriv("aes-256-cbc",i,r),p=h.update(o),v=h.final(),t.abrupt("return",s.concat([p,v]));case 19:if("decrypt"!==e){t.next=24;break}return m=a.createDecipheriv("aes-256-cbc",i,r),g=m.update(o),y=m.final(),t.abrupt("return",s.concat([g,y]));case 24:throw new Error("Unsupported operation: ".concat(e));case 25:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()}var w=b("encrypt"),k=b("decrypt");function x(e,t){return S.apply(this,arguments)}function S(){return(S=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,o,c,u,f,d;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=10;break}return i={name:"HMAC",hash:{name:"SHA-256"}},e.next=4,l.importKey("raw",new Uint8Array(t),i,!1,["sign","verify"]);case 4:return o=e.sent,e.next=7,l.sign("HMAC",o,r);case 7:return c=e.sent,u=s.from(new Uint8Array(c)),e.abrupt("return",u);case 10:return(f=a.createHmac("sha256",s.from(t))).update(r),d=f.digest(),e.abrupt("return",d);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t,r){return _.apply(this,arguments)}function _(){return(_=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t,r);case 2:return a=e.sent,e.abrupt("return",v(a,i));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(){for(var e=m(32);!p(e);)e=m(32);return e},P=function(e){return h(32===e.length,"Bad private key"),h(p(e),"Bad private key"),s.from(c.keyFromPrivate(e).getPublic("array"))},E=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(32===t.length,"Bad private key"),h(p(t),"Bad private key"),h(r.length>0,"Message should not be empty"),h(r.length<=32,"Message is too long"),e.abrupt("return",s.from(c.sign(r,t,{canonical:!0}).toDER()));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(s.isBuffer(t),"Bad private key"),h(s.isBuffer(r),"Bad public key"),h(32===t.length,"Bad private key"),h(p(t),"Bad private key"),h(65===r.length||33===r.length,"Bad public key"),65===r.length&&h(4===r[0],"Bad public key"),33===r.length&&h(2===r[0]||3===r[0],"Bad public key"),i=c.keyFromPrivate(t),a=c.keyFromPublic(r),o=i.derive(a.getPublic()),e.abrupt("return",s.from(o.toArray()));case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),T=M,I=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(s.isBuffer(t),"Bad private key"),h(s.isBuffer(r),"Bad public key"),h(32===t.length,"Bad private key"),h(p(t),"Bad private key"),h(65===r.length||33===r.length,"Bad public key"),65===r.length&&h(4===r[0],"Bad public key"),33===r.length&&h(2===r[0]||3===r[0],"Bad public key"),i=c.keyFromPrivate(t),a=c.keyFromPublic(r),o=i.derive(a.getPublic()),e.abrupt("return",s.from(o.toString(16,64),"hex"));case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),N=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,o,c,u,l,f,d,h,v,y,b;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=(i=i||{}).ephemPrivateKey||m(32);!p(a);)a=i.ephemPrivateKey||m(32);return o=P(a),e.next=6,T(a,t);case 6:return c=e.sent,e.next=9,g(c);case 9:return u=e.sent,l=i.iv||m(16),f=u.slice(0,32),d=u.slice(32),e.next=15,w(l,s.from(f),r);case 15:return h=e.sent,v=h,y=s.concat([l,o,v]),e.next=20,x(s.from(d),y);case 20:return b=e.sent,e.abrupt("return",{iv:l,ephemPublicKey:o,ciphertext:v,mac:b});case 22:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),A=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,o,c,u,l,f,d,h,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(a=null!==i&&void 0!==i&&i)?I:T,e.next=4,o(t,r.ephemPublicKey);case 4:return c=e.sent,e.next=7,g(c);case 7:return u=e.sent,l=u.slice(0,32),f=u.slice(32),d=s.concat([r.iv,r.ephemPublicKey,r.ciphertext]),e.next=13,O(f,d,r.mac);case 13:if((h=e.sent)||!1!==a){e.next=18;break}return e.abrupt("return",A(t,r,!0));case 18:if(h||!0!==a){e.next=20;break}throw new Error("bad MAC after trying padded");case 20:return e.next=22,k(r.iv,s.from(l),r.ciphertext);case 22:return p=e.sent,e.abrupt("return",s.from(new Uint8Array(p)));case 24:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},98368:function(e,t,r){"use strict";r.d(t,{U2:function(){return O},i:function(){return Z},nK:function(){return S},ut:function(){return y},v_:function(){return _},y1:function(){return g}});var n=r(24611),i=r(53755),a=r(20240),o=r(75509),s=r.n(o),c=r(20491);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=r.n(c)().getLogger("http-helpers");f.setLevel(c.levels.INFO);var d="torus-default",h="",p=null,v=[],m=[];function g(e){h=e}function y(e){d=e}function b(e,t){return w.apply(this,arguments)}function w(){return(w=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=null;try{i=new URL(t)}catch(n){}if(!p||!i||!v.includes(i.origin)&&!m.includes(i.pathname)){e.next=11;break}return a=p.startTransaction({name:t}),o=a.startChild({op:"http"}),e.next=7,fetch(t,r);case 7:return s=e.sent,o.finish(),a.finish(),e.abrupt("return",s);case 11:return e.abrupt("return",fetch(t,r));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){var e={};return d&&(e["x-api-key"]=d),h&&(e["x-embed-host"]=h),e}function x(e){f.info("Response: ".concat(e.status," ").concat(e.statusText)),f.info("Url: ".concat(e.url))}var S=function(e,t){var r=new Promise((function(t,r){var n=setTimeout((function(){clearTimeout(n),r(new Error("Timed out in ".concat(e,"ms")))}),e)}));return Promise.race([t,r])},O=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,c=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:{},i={mode:"cors",headers:{}},(c.length>2&&void 0!==c[2]?c[2]:{}).useAPIKey&&(i.headers=l(l({},i.headers),k())),a=s()(i,r,{method:"GET"}),e.next=7,b(t,a);case 7:if(!(o=e.sent).ok){e.next=10;break}return e.abrupt("return",o.json());case 10:throw x(o),o;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};n.useAPIKey&&(i.headers=l(l({},i.headers),k()));var a=s()(i,r,{method:"POST"});return n.isUrlEncodedData?(a.body=t,"application/json; charset=utf-8"===a.headers["Content-Type"]&&delete a.headers["Content-Type"]):a.body=JSON.stringify(t),S(n.timeout||6e4,b(e,a).then((function(e){if(n.logTracingHeader&&function(e){f.info("Request tracing with traceID=".concat(e.headers.get("x-web3-correlation-id")))}(e),e.ok)return e.json();throw x(e),e})))},Z=function(e,t){return{jsonrpc:"2.0",method:e,id:10,params:t}}},57413:function(e,t,r){"use strict";r.d(t,{ZP:function(){return F},wn:function(){return C}});var n=r(24611),i=r(53755),a=r(19961),o=r(59900),s=r(47061),c=r(14771),u=r(24269),l=r(74086),f=r(17204),d=r(20240),h=r(88902),p=r(15826),v=r(98368),m=r(54006),g=r.n(m),y=r(80082),b=r(1891),w=r.n(b),k=r(20491),x=r.n(k),S=r(60107),O=r(80080).Buffer,_=x().getLogger("torus.js");_.disableAll();var Z=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;(0,s.Z)(this,r);var i=e.errors,a=e.responses,o=e.predicate;return n=t.call(this,"Unable to resolve enough promises."),(0,d.Z)((0,c.Z)(n),"errors",void 0),(0,d.Z)((0,c.Z)(n),"responses",void 0),(0,d.Z)((0,c.Z)(n),"predicate",void 0),n.errors=i,n.responses=a,n.predicate=o,n}return(0,o.Z)(r)}((0,f.Z)(Error)),P=function(e,t){return new Promise((function(r,n){var i,a=0,o={resolved:!1},s=new Array(e.length).fill(void 0),c=new Array(e.length).fill(void 0);return e.forEach((function(u,l){return u.then((function(e){c[l]=e})).catch((function(e){s[l]=e})).finally((function(){if(!o.resolved)return t(c.slice(0),o).then((function(e){o.resolved=!0,r(e)})).catch((function(e){i=e})).finally((function(){if((a+=1)===e.length){var t=Object.values(c.reduce((function(e,t){if(t){var r,n=t.id,i=t.error;(null===i||void 0===i||null===(r=i.data)||void 0===r?void 0:r.length)>0&&(i.data.startsWith("Error occurred while verifying params")?e[n]=(a=i.data).charAt(0).toUpperCase()+a.slice(1):e[n]=i.data)}var a;return e}),{}));if(t.length>0){var r=t.length>1?"\n".concat(t.map((function(e){return"\u2022 ".concat(e)})).join("\n")):t[0];n(new Error(r))}else{var o;n(new Z({errors:s,responses:c,predicate:(null===(o=i)||void 0===o?void 0:o.message)||i}))}}}))}))}))}))};function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r)}((0,f.Z)(Error)),I=function e(t,r){var n=t;if("number"===typeof n&&(n=Array.from({length:n},(function(e,t){return t}))),r>n.length||r<=0)return[];if(r===n.length)return[n];if(1===r)return n.reduce((function(e,t){return[].concat((0,a.Z)(e),[[t]])}),[]);for(var i=[],o=[],s=0;s<=n.length-r+1;s+=1){o=e(n.slice(s+1),r-1);for(var c=0;c<o.length;c+=1)i.push([n[s]].concat((0,a.Z)(o[c])))}return i},N=function(e,t){for(var r={},n=0;n<e.length;n+=1){var i=w()(e[n]);if(r[i]=r[i]?r[i]+1:1,r[i]===t)return e[n]}},A=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.map((function(e){return(0,v.v_)(e,(0,v.i)("VerifierLookupRequest",{verifier:r,verifier_id:i.toString()})).catch((function(e){return _.error("lookup request failed",e)}))})),e.abrupt("return",P(a,(function(e){var r=e.filter((function(e){return e})),n=N(r.map((function(e){return e&&e.error})),1+~~(t.length/2)),i=N(r.map((function(e){return e&&e.result})),1+~~(t.length/2));return i||n?Promise.resolve({keyResult:i,errorResult:n}):Promise.reject(new Error("invalid results ".concat(JSON.stringify(e))))})));case 2:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),L=function(e,t,r,n){return new Promise((function(i,a){setTimeout((function(){A(e,t,r).then(i).catch(a)}),n)}))},j=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s,c,u,l,f,d,h,p,m,g;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.endpoints,i=t.torusNodePubs,a=t.lastPoint,o=t.firstPoint,s=t.verifier,c=t.verifierId,u=t.signerHost,l=t.network,f=t.clientId,void 0===a?(d=Math.floor(Math.random()*r.length),_.info("keyassign",d,r[d]),h=d):d=a%r.length,d!==o){e.next=4;break}throw new Error("Looped through all");case 4:return void 0!==o&&(h=o),p=(0,v.i)("KeyAssign",{verifier:s,verifier_id:c.toString()}),e.prev=6,e.next=9,(0,v.v_)(u,p,{headers:{pubKeyX:i[d].X,pubKeyY:i[d].Y,network:l,clientId:f}},{useAPIKey:!0});case 9:return m=e.sent,e.next=12,(0,v.v_)(r[d],M(M({},p),m),{headers:{"Content-Type":"application/json; charset=utf-8"}});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(6),_.error(e.t0.status,e.t0.message,e.t0,"key assign error"),g=["Timed out","Failed to fetch","cancelled","NetworkError when attempting to fetch resource.","TypeError: Failed to fetch","TypeError: cancelled","TypeError: NetworkError when attempting to fetch resource."],!(502===(null===e.t0||void 0===e.t0?void 0:e.t0.status)||504===(null===e.t0||void 0===e.t0?void 0:e.t0.status)||401===(null===e.t0||void 0===e.t0?void 0:e.t0.status)||g.includes(e.t0.message)||g.some((function(t){return e.t0.message.includes(t)}))||e.t0.message&&e.t0.message.includes("reason: getaddrinfo EAI_AGAIN"))){e.next=21;break}return e.abrupt("return",j({endpoints:r,torusNodePubs:i,lastPoint:d+1,firstPoint:h,verifier:s,verifierId:c,signerHost:u,network:l,clientId:f}));case 21:throw new Error("Sorry, the Torus Network that powers Web3Auth is currently very busy.\n    We will generate your key in time. Pls try again later. \n\n    ".concat(e.t0.message||""));case 22:case"end":return e.stop()}}),e,null,[[6,15]])})));return function(t){return e.apply(this,arguments)}}();function C(e){var t=O.from((0,S.wn)(e)).toString("hex");return"0x".concat(t)}function R(e){for(var t,r=(t=e,t.startsWith("0x")?t.slice(2):t).toLowerCase(),n=O.from(r,"utf8"),i=O.from((0,S.wn)(n)).toString("hex"),a="0x",o=0;o<r.length;o++)parseInt(i[o],16)>=8?a+=r[o].toUpperCase():a+=r[o];return a}function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var F=function(){function e(t){(0,s.Z)(this,e);var r=t.enableOneKey,n=void 0!==r&&r,i=t.metadataHost,a=void 0===i?"https://metadata.tor.us":i,o=t.allowHost,c=t.signerHost,u=t.serverTimeOffset,l=void 0===u?0:u,f=t.network,p=t.clientId;if((0,d.Z)(this,"metadataHost",void 0),(0,d.Z)(this,"allowHost",void 0),(0,d.Z)(this,"serverTimeOffset",void 0),(0,d.Z)(this,"enableOneKey",void 0),(0,d.Z)(this,"signerHost",void 0),(0,d.Z)(this,"network",void 0),(0,d.Z)(this,"clientId",void 0),(0,d.Z)(this,"ec",void 0),!p)throw Error("Please provide a valid clientId in constructor");if(!f)throw Error("Please provide a valid network in constructor");this.ec=new y.ec("secp256k1"),this.metadataHost=a,this.enableOneKey=n,this.serverTimeOffset=l||0,this.network=f,this.clientId=p,this.allowHost=o||"".concat(h.e9[f],"/api/allow"),this.signerHost=c||"".concat(h.e9[f],"/api/sign")}return(0,o.Z)(e,[{key:"getUserTypeAndAddress",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,o,s,c,u,l,f,d,h,p,v,m,y,b,w,k,x,S,O,Z,P,E,M=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.verifier,o=i.verifierId,s=M.length>3&&void 0!==M[3]&&M[3],e.next=4,A(t,a,o);case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0={};case 7:if(c=e.t0,u=c.keyResult,l=c.errorResult,f=!1,!l||!JSON.stringify(l).includes("Verifier not supported")){e.next=15;break}throw new Error("Verifier not supported. Check if you: \n\n      1. Are on the right network (Torus testnet/mainnet) \n\n      2. Have setup a verifier on dashboard.web3auth.io?");case 15:if(!l||!JSON.stringify(l).includes("Verifier + VerifierID has not yet been assigned")){e.next=27;break}if(s){e.next=18;break}throw new Error("Verifier + VerifierID has not yet been assigned");case 18:return e.next=20,j({endpoints:t,torusNodePubs:r,lastPoint:void 0,firstPoint:void 0,verifier:a,verifierId:o,signerHost:this.signerHost,network:this.network,clientId:this.clientId});case 20:return e.next=22,L(t,a,o,1e3);case 22:h=e.sent,d=null===h||void 0===h?void 0:h.keyResult,f=!0,e.next=32;break;case 27:if(!u){e.next=31;break}d=u,e.next=32;break;case 31:throw new Error("node results do not match at first lookup ".concat(JSON.stringify(u||{}),", ").concat(JSON.stringify(l||{})));case 32:if(_.debug("> torus.js/getUserTypeAndAddress",{finalKeyResult:d,isNewKey:f}),!d){e.next=61;break}return m=d.keys[0],y=m.pub_key_X,b=m.pub_key_Y,e.prev=35,e.next=38,this.getOrSetNonce(y,b,void 0,!f);case 38:w=e.sent,k=new(g())(w.nonce||"0",16),S=w.typeOfUser,e.next=46;break;case 43:throw e.prev=43,e.t1=e.catch(35),new T;case 46:if("v1"!==w.typeOfUser){e.next=50;break}x=this.ec.keyFromPublic({x:y,y:b}).getPublic().add(this.ec.keyFromPrivate(k.toString(16)).getPublic()),e.next=56;break;case 50:if("v2"!==w.typeOfUser){e.next=55;break}x=this.ec.keyFromPublic({x:y,y:b}).getPublic().add(this.ec.keyFromPublic({x:w.pubNonce.x,y:w.pubNonce.y}).getPublic()),O=w.pubNonce,e.next=56;break;case 55:throw new Error("getOrSetNonce should always return typeOfUser.");case 56:return Z=x.getX().toString(16),P=x.getY().toString(16),E=this.generateAddressFromPubKey(x.getX(),x.getY()),_.debug("> torus.js/getUserTypeAndAddress",{X:y,Y:b,address:E,typeOfUser:S,nonce:null===(p=k)||void 0===p?void 0:p.toString(16),pubNonce:O}),e.abrupt("return",{typeOfUser:S,address:E,X:Z,Y:P,metadataNonce:k,pubNonce:O,upgraded:(null===(v=w)||void 0===v?void 0:v.upgraded)||void 0});case 61:throw new Error("node results do not match at final lookup ".concat(JSON.stringify(u||{}),", ").concat(JSON.stringify(l||{})));case 62:case"end":return e.stop()}}),e,this,[[35,43]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"setCustomKey",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s,c,u,l,f;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.privKeyHex,i=t.metadataNonce,a=t.torusKeyHex,o=t.customKeyHex,a?s=new(g())(a,16):(c=new(g())(r,16),s=c.sub(i).umod(this.ec.curve.n)),u=new(g())(o,16),l=u.sub(s).umod(this.ec.curve.n),f=this.generateMetadataParams(l.toString(16),s),e.next=7,this.setMetadata(f);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"retrieveShares",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,a,o,s){var c,u,l,f,d,h,m,y,b,w=this,k=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=k.length>5&&void 0!==k[5]?k[5]:{},u=[],e.next=4,(0,v.U2)(this.allowHost,{headers:{verifier:a,verifierId:o.verifier_id,network:this.network,clientId:this.clientId}},{useAPIKey:!0});case 4:for(l=(0,p.oq)(),f=(0,p.rc)(l).toString("hex"),d=f.slice(2,66),h=f.slice(66),m=C(O.from(s,"utf8")),y=0;y<t.length;y+=1)b=(0,v.v_)(t[y],(0,v.i)("CommitmentRequest",{messageprefix:"mug00",tokencommitment:m.slice(2),temppubx:d,temppuby:h,verifieridentifier:a})).catch((function(e){_.error("commitment",e)})),u.push(b);return e.abrupt("return",P(u,(function(e){return e.filter((function(e){return!(!e||"object"!==typeof e)&&!e.error})).length>=3*~~(t.length/4)+1?Promise.resolve(e):Promise.reject(new Error("invalid ".concat(JSON.stringify(e))))})).then((function(e){for(var u=[],f=[],d=0;d<e.length;d+=1)e[d]&&f.push(e[d].result);for(var h=0;h<t.length;h+=1){var m=(0,v.v_)(t[h],(0,v.i)("ShareRequest",{encrypted:"yes",item:[K(K({},o),{},{idtoken:s,nodesignatures:f,verifieridentifier:a},c)]})).catch((function(e){return _.error("share req",e)}));u.push(m)}return P(u,function(){var e=(0,i.Z)((0,n.Z)().mark((function e(i,a){var o,s,c,u,f,d,h,v,m,y,b,k,x,S,Z,P,E;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i.filter((function(e){return e})),s=N(i.map((function(e){return e&&e.result&&e.result.keys[0].PublicKey})),1+~~(t.length/2)),!(o.length>=1+~~(t.length/2)&&s)){e.next=29;break}for(c=[],u=[],f=0;f<i.length;f+=1)(null===(v=i[f])||void 0===v||null===(d=v.result)||void 0===d||null===(h=d.keys)||void 0===h?void 0:h.length)>0?(v.result.keys.sort((function(e,t){return new(g())(e.Index,16).cmp(new(g())(t.Index,16))})),(m=v.result.keys[0]).Metadata?(y={ephemPublicKey:O.from(m.Metadata.ephemPublicKey,"hex"),iv:O.from(m.Metadata.iv,"hex"),mac:O.from(m.Metadata.mac,"hex")},c.push((0,p.pe)(l,K(K({},y),{},{ciphertext:O.from(O.from(m.Share,"base64").toString("binary").padStart(64,"0"),"hex")})).catch((function(e){return _.debug("share decryption",e)})))):c.push(Promise.resolve(O.from(m.Share.padStart(64,"0"),"hex")))):c.push(Promise.resolve(void 0)),u.push(new(g())(r[f],16));return e.next=8,Promise.all(c);case 8:if(b=e.sent,!a.resolved){e.next=11;break}return e.abrupt("return",void 0);case 11:k=b.reduce((function(e,t,r){return t&&e.push({index:u[r],value:new(g())(t)}),e}),[]),x=I(k.length,1+~~(t.length/2)),S=null,Z=(0,n.Z)().mark((function e(){var t,r,i,a,o,c,u,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x[P],r=k.filter((function(e,r){return t.includes(r)})),i=r.map((function(e){return e.value})),a=r.map((function(e){return e.index})),o=w.lagrangeInterpolation(i,a)){e.next=7;break}return e.abrupt("return","continue");case 7:if(c=(0,p.rc)(O.from(o.toString(16,64),"hex")).toString("hex"),u=c.slice(2,66),l=c.slice(66),0!==new(g())(u,16).cmp(new(g())(s.X,16))||0!==new(g())(l,16).cmp(new(g())(s.Y,16))){e.next=13;break}return S=o,e.abrupt("return","break");case 13:case"end":return e.stop()}}),e)})),P=0;case 16:if(!(P<x.length)){e.next=26;break}return e.delegateYield(Z(),"t0",18);case 18:if("continue"!==(E=e.t0)){e.next=21;break}return e.abrupt("continue",23);case 21:if("break"!==E){e.next=23;break}return e.abrupt("break",26);case 23:P+=1,e.next=16;break;case 26:if(void 0!==S&&null!==S){e.next=28;break}throw new Error("could not derive private key");case 28:return e.abrupt("return",S);case 29:throw new Error("invalid");case 30:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())})).then(function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s,c,u,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t){e.next=3;break}throw new Error("Invalid private key returned");case 3:if(i=(0,p.rc)(O.from(r.toString(16,64),"hex")).toString("hex"),a=i.slice(2,66),o=i.slice(66),!w.enableOneKey){e.next=14;break}return e.next=9,w.getNonce(a,o,r);case 9:c=e.sent,u=c.nonce,s=new(g())(u||"0",16),e.next=17;break;case 14:return e.next=16,w.getMetadata({pub_key_X:a,pub_key_Y:o});case 16:s=e.sent;case 17:return _.debug("> torus.js/retrieveShares",{privKey:r.toString(16),metadataNonce:s.toString(16)}),r=r.add(s).umod(w.ec.curve.n),l=w.generateAddressFromPrivKey(r),_.debug("> torus.js/retrieveShares",{ethAddress:l,privKey:r.toString(16)}),e.abrupt("return",{ethAddress:l,privKey:r.toString("hex",64),metadataNonce:s});case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},e.prev=1,e.next=4,(0,v.v_)("".concat(this.metadataHost,"/get"),t,r,{useAPIKey:!0});case 4:if((i=e.sent)&&i.message){e.next=7;break}return e.abrupt("return",new(g())(0));case 7:return e.abrupt("return",new(g())(i.message,16));case 10:return e.prev=10,e.t0=e.catch(1),_.error("get metadata error",e.t0),e.abrupt("return",new(g())(0));case 14:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"generateMetadataParams",value:function(e,t){var r=this.ec.keyFromPrivate(t.toString("hex",64)),n={data:e,timestamp:new(g())(~~(this.serverTimeOffset+Date.now()/1e3)).toString(16)},i=r.sign(C(O.from(w()(n),"utf8")).slice(2));return{pub_key_X:r.getPublic().getX().toString("hex"),pub_key_Y:r.getPublic().getY().toString("hex"),set_data:n,signature:O.from(i.r.toString(16,64)+i.s.toString(16,64)+new(g())("").toString(16,2),"hex").toString("base64")}}},{key:"setMetadata",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},e.prev=1,e.next=4,(0,v.v_)("".concat(this.metadataHost,"/set"),t,r,{useAPIKey:!0});case 4:return i=e.sent,e.abrupt("return",i.message);case 8:return e.prev=8,e.t0=e.catch(1),_.error("set metadata error",e.t0),e.abrupt("return","");case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"lagrangeInterpolation",value:function(e,t){if(e.length!==t.length)return null;for(var r=new(g())(0),n=0;n<e.length;n+=1){for(var i=new(g())(1),a=new(g())(1),o=0;o<e.length;o+=1)if(n!==o){i=(i=i.mul(t[o].neg())).umod(this.ec.curve.n);var s=t[n].sub(t[o]);s=s.umod(this.ec.curve.n),a=a.mul(s).umod(this.ec.curve.n)}var c=i.mul(a.invm(this.ec.curve.n)).umod(this.ec.curve.n);c=c.mul(e[n]).umod(this.ec.curve.n),r=r.add(c)}return r.umod(this.ec.curve.n)}},{key:"generateAddressFromPrivKey",value:function(e){var t=this.ec.keyFromPrivate(e.toString("hex",64),"hex").getPublic().encode("hex",!1).slice(2);return _.info(t,"public key"),R("0x".concat(C(O.from(t,"hex")).slice(26)))}},{key:"generateAddressFromPubKey",value:function(e,t){var r=this.ec.keyFromPublic({x:e.toString("hex",64),y:t.toString("hex",64)}),n=r.getPublic().encode("hex",!1).slice(2);return _.info(r.getPublic().encode("hex",!1),"public key"),R("0x".concat(C(O.from(n,"hex")).slice(26)))}},{key:"getPublicAddress",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,o,s,c,u,l,f,d,h,p,v,m,y,b,w,k,x,S,O,Z,P=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.verifier,o=i.verifierId,s=P.length>3&&void 0!==P[3]&&P[3],_.debug("> torus.js/getPublicAddress",{endpoints:t,torusNodePubs:r,verifier:a,verifierId:o,isExtended:s}),u=!1,e.next=6,A(t,a,o);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0={};case 9:if(l=e.t0,f=l.keyResult,!(d=l.errorResult)||!JSON.stringify(d).includes("Verifier not supported")){e.next=16;break}throw new Error("Verifier not supported. Check if you: \n\n      1. Are on the right network (Torus testnet/mainnet) \n\n      2. Have setup a verifier on dashboard.web3auth.io?");case 16:if(!d||!JSON.stringify(d).includes("Verifier + VerifierID has not yet been assigned")){e.next=26;break}return e.next=19,j({endpoints:t,torusNodePubs:r,lastPoint:void 0,firstPoint:void 0,verifier:a,verifierId:o,signerHost:this.signerHost,network:this.network,clientId:this.clientId});case 19:return e.next=21,L(t,a,o,1e3);case 21:h=e.sent,c=null===h||void 0===h?void 0:h.keyResult,u=!0,e.next=31;break;case 26:if(!f){e.next=30;break}c=f,e.next=31;break;case 30:throw new Error("node results do not match at first lookup ".concat(JSON.stringify(f||{}),", ").concat(JSON.stringify(d||{})));case 31:if(_.debug("> torus.js/getPublicAddress",{finalKeyResult:c,isNewKey:u}),!c){e.next=69;break}if(m=c.keys[0],y=m.pub_key_X,b=m.pub_key_Y,!this.enableOneKey){e.next=57;break}return e.prev=35,e.next=38,this.getOrSetNonce(y,b,void 0,!u);case 38:w=e.sent,k=new(g())(w.nonce||"0",16),S=w.typeOfUser,e.next=46;break;case 43:throw e.prev=43,e.t1=e.catch(35),new T;case 46:if("v1"!==w.typeOfUser){e.next=50;break}x=this.ec.keyFromPublic({x:y,y:b}).getPublic().add(this.ec.keyFromPrivate(k.toString(16)).getPublic()),e.next=55;break;case 50:if("v2"!==w.typeOfUser){e.next=54;break}w.upgraded?x=this.ec.keyFromPublic({x:y,y:b}).getPublic():(x=this.ec.keyFromPublic({x:y,y:b}).getPublic().add(this.ec.keyFromPublic({x:w.pubNonce.x,y:w.pubNonce.y}).getPublic()),O=w.pubNonce),e.next=55;break;case 54:throw new Error("getOrSetNonce should always return typeOfUser.");case 55:e.next=62;break;case 57:return S="v1",e.next=60,this.getMetadata({pub_key_X:y,pub_key_Y:b});case 60:k=e.sent,x=this.ec.keyFromPublic({x:y,y:b}).getPublic().add(this.ec.keyFromPrivate(k.toString(16)).getPublic());case 62:if(y=x.getX().toString(16),b=x.getY().toString(16),Z=this.generateAddressFromPubKey(x.getX(),x.getY()),_.debug("> torus.js/getPublicAddress",{X:y,Y:b,address:Z,typeOfUser:S,nonce:null===(p=k)||void 0===p?void 0:p.toString(16),pubNonce:O}),s){e.next=68;break}return e.abrupt("return",Z);case 68:return e.abrupt("return",{typeOfUser:S,address:Z,X:y,Y:b,metadataNonce:k,pubNonce:O,upgraded:(null===(v=w)||void 0===v?void 0:v.upgraded)||void 0});case 69:throw new Error("node results do not match at final lookup ".concat(JSON.stringify(f||{}),", ").concat(JSON.stringify(d||{})));case 70:case"end":return e.stop()}}),e,this,[[35,43]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getOrSetNonce",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,o,s=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.length>3&&void 0!==s[3]&&s[3]?"getNonce":"getOrSetNonce",a=i?this.generateMetadataParams(o,i):{pub_key_X:t,pub_key_Y:r,set_data:{data:o}},e.abrupt("return",(0,v.v_)("".concat(this.metadataHost,"/get_or_set_nonce"),a,void 0,{useAPIKey:!0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getNonce",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getOrSetNonce(t,r,i,!0));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getPostboxKeyFrom1OutOf1",value:function(e,t){var r=new(g())(e,16),n=new(g())(t,16);return r.sub(n).umod(this.ec.curve.n).toString("hex")}}],[{key:"enableLogging",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?_.enableAll():_.disableAll()}},{key:"setAPIKey",value:function(e){(0,v.ut)(e)}},{key:"setEmbedHost",value:function(e){(0,v.y1)(e)}},{key:"isGetOrSetNonceError",value:function(e){return e instanceof T}}]),e}()},95304:function(e){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),a=e.getVersionPrecision(r),o=Math.max(i,a),s=0,c=e.map([t,r],(function(t){var r=o-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(s=o-Math.min(i,a)),o-=1;o>=s;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===s)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(a));var s=function(){var e=a[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=a.length;t<r;t+=1)s();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},a=r(18);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(){}var t,r,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(r=null)&&o(t.prototype,r),n&&o(t,n),e}();t.default=s,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=c(r(92)),i=c(r(93)),a=c(r(94)),o=c(r(95)),s=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=s.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=s.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=s.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=s.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return s.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},a=0;if(Object.keys(e).forEach((function(t){var o=e[t];"string"==typeof o?(i[t]=o,a+=1):"object"==typeof o&&(r[t]=o,n+=1)})),n>0){var o=Object.keys(r),c=s.default.find(o,(function(e){return t.isOS(e)}));if(c){var u=this.satisfies(r[c]);if(void 0!==u)return u}var l=s.default.find(o,(function(e){return t.isPlatform(e)}));if(l){var f=this.satisfies(r[l]);if(void 0!==f)return f}}if(a>0){var d=Object.keys(i),h=s.default.find(d,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(i[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=s.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(s.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=u,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:a.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:a.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:a.OS_MAP.iOS},r=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:a.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:a.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:a.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:a.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:a.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:a.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:a.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:a.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:a.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:a.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})},75509:function(e,t,r){e=r.nmd(e);var n="__lodash_hash_undefined__",i=9007199254740991,a="[object Arguments]",o="[object AsyncFunction]",s="[object Function]",c="[object GeneratorFunction]",u="[object Null]",l="[object Object]",f="[object Proxy]",d="[object Undefined]",h=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,v={};v["[object Float32Array]"]=v["[object Float64Array]"]=v["[object Int8Array]"]=v["[object Int16Array]"]=v["[object Int32Array]"]=v["[object Uint8Array]"]=v["[object Uint8ClampedArray]"]=v["[object Uint16Array]"]=v["[object Uint32Array]"]=!0,v[a]=v["[object Array]"]=v["[object ArrayBuffer]"]=v["[object Boolean]"]=v["[object DataView]"]=v["[object Date]"]=v["[object Error]"]=v[s]=v["[object Map]"]=v["[object Number]"]=v[l]=v["[object RegExp]"]=v["[object Set]"]=v["[object String]"]=v["[object WeakMap]"]=!1;var m="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,g="object"==typeof self&&self&&self.Object===Object&&self,y=m||g||Function("return this")(),b=t&&!t.nodeType&&t,w=b&&e&&!e.nodeType&&e,k=w&&w.exports===b,x=k&&m.process,S=function(){try{var e=w&&w.require&&w.require("util").types;return e||x&&x.binding&&x.binding("util")}catch(t){}}(),O=S&&S.isTypedArray;var _,Z,P=Array.prototype,E=Function.prototype,M=Object.prototype,T=y["__core-js_shared__"],I=E.toString,N=M.hasOwnProperty,A=function(){var e=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),L=M.toString,j=I.call(Object),C=RegExp("^"+I.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),R=k?y.Buffer:void 0,D=y.Symbol,K=y.Uint8Array,F=R?R.allocUnsafe:void 0,U=(_=Object.getPrototypeOf,Z=Object,function(e){return _(Z(e))}),B=Object.create,q=M.propertyIsEnumerable,z=P.splice,J=D?D.toStringTag:void 0,H=function(){try{var e=ye(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),W=R?R.isBuffer:void 0,Y=Math.max,V=Date.now,X=ye(y,"Map"),G=ye(Object,"create"),$=function(){function e(){}return function(t){if(!Te(t))return{};if(B)return B(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function Q(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ee(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function te(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function re(e){var t=this.__data__=new ee(e);this.size=t.size}function ne(e,t){var r=_e(e),n=!r&&Oe(e),i=!r&&!n&&Pe(e),a=!r&&!n&&!i&&Ne(e),o=r||n||i||a,s=o?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],c=s.length;for(var u in e)!t&&!N.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||be(u,c))||s.push(u);return s}function ie(e,t,r){(void 0!==r&&!Se(e[t],r)||void 0===r&&!(t in e))&&se(e,t,r)}function ae(e,t,r){var n=e[t];N.call(e,t)&&Se(n,r)&&(void 0!==r||t in e)||se(e,t,r)}function oe(e,t){for(var r=e.length;r--;)if(Se(e[r][0],t))return r;return-1}function se(e,t,r){"__proto__"==t&&H?H(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}Q.prototype.clear=function(){this.__data__=G?G(null):{},this.size=0},Q.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Q.prototype.get=function(e){var t=this.__data__;if(G){var r=t[e];return r===n?void 0:r}return N.call(t,e)?t[e]:void 0},Q.prototype.has=function(e){var t=this.__data__;return G?void 0!==t[e]:N.call(t,e)},Q.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=G&&void 0===t?n:t,this},ee.prototype.clear=function(){this.__data__=[],this.size=0},ee.prototype.delete=function(e){var t=this.__data__,r=oe(t,e);return!(r<0)&&(r==t.length-1?t.pop():z.call(t,r,1),--this.size,!0)},ee.prototype.get=function(e){var t=this.__data__,r=oe(t,e);return r<0?void 0:t[r][1]},ee.prototype.has=function(e){return oe(this.__data__,e)>-1},ee.prototype.set=function(e,t){var r=this.__data__,n=oe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},te.prototype.clear=function(){this.size=0,this.__data__={hash:new Q,map:new(X||ee),string:new Q}},te.prototype.delete=function(e){var t=ge(this,e).delete(e);return this.size-=t?1:0,t},te.prototype.get=function(e){return ge(this,e).get(e)},te.prototype.has=function(e){return ge(this,e).has(e)},te.prototype.set=function(e,t){var r=ge(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},re.prototype.clear=function(){this.__data__=new ee,this.size=0},re.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},re.prototype.get=function(e){return this.__data__.get(e)},re.prototype.has=function(e){return this.__data__.has(e)},re.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ee){var n=r.__data__;if(!X||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new te(n)}return r.set(e,t),this.size=r.size,this};var ce,ue=function(e,t,r){for(var n=-1,i=Object(e),a=r(e),o=a.length;o--;){var s=a[ce?o:++n];if(!1===t(i[s],s,i))break}return e};function le(e){return null==e?void 0===e?d:u:J&&J in Object(e)?function(e){var t=N.call(e,J),r=e[J];try{e[J]=void 0;var n=!0}catch(a){}var i=L.call(e);n&&(t?e[J]=r:delete e[J]);return i}(e):function(e){return L.call(e)}(e)}function fe(e){return Ie(e)&&le(e)==a}function de(e){return!(!Te(e)||function(e){return!!A&&A in e}(e))&&(Ee(e)?C:h).test(function(e){if(null!=e){try{return I.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}function he(e){if(!Te(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=we(e),r=[];for(var n in e)("constructor"!=n||!t&&N.call(e,n))&&r.push(n);return r}function pe(e,t,r,n,i){e!==t&&ue(t,(function(a,o){if(i||(i=new re),Te(a))!function(e,t,r,n,i,a,o){var s=ke(e,r),c=ke(t,r),u=o.get(c);if(u)return void ie(e,r,u);var f=a?a(s,c,r+"",e,t,o):void 0,d=void 0===f;if(d){var h=_e(c),p=!h&&Pe(c),v=!h&&!p&&Ne(c);f=c,h||p||v?_e(s)?f=s:Ie(m=s)&&Ze(m)?f=function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(s):p?(d=!1,f=function(e,t){if(t)return e.slice();var r=e.length,n=F?F(r):new e.constructor(r);return e.copy(n),n}(c,!0)):v?(d=!1,f=function(e,t){var r=t?function(e){var t=new e.constructor(e.byteLength);return new K(t).set(new K(e)),t}(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(c,!0)):f=[]:function(e){if(!Ie(e)||le(e)!=l)return!1;var t=U(e);if(null===t)return!0;var r=N.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&I.call(r)==j}(c)||Oe(c)?(f=s,Oe(s)?f=function(e){return function(e,t,r,n){var i=!r;r||(r={});var a=-1,o=t.length;for(;++a<o;){var s=t[a],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?se(r,s,c):ae(r,s,c)}return r}(e,Ae(e))}(s):Te(s)&&!Ee(s)||(f=function(e){return"function"!=typeof e.constructor||we(e)?{}:$(U(e))}(c))):d=!1}var m;d&&(o.set(c,f),i(f,c,n,a,o),o.delete(c));ie(e,r,f)}(e,t,o,r,pe,n,i);else{var s=n?n(ke(e,o),a,o+"",e,t,i):void 0;void 0===s&&(s=a),ie(e,o,s)}}),Ae)}function ve(e,t){return xe(function(e,t,r){return t=Y(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=Y(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,s)}}(e,t,Ce),e+"")}var me=H?function(e,t){return H(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:Ce;function ge(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function ye(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return de(r)?r:void 0}function be(e,t){var r=typeof e;return!!(t=null==t?i:t)&&("number"==r||"symbol"!=r&&p.test(e))&&e>-1&&e%1==0&&e<t}function we(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||M)}function ke(e,t){if(("constructor"!==t||"function"!==typeof e[t])&&"__proto__"!=t)return e[t]}var xe=function(e){var t=0,r=0;return function(){var n=V(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(me);function Se(e,t){return e===t||e!==e&&t!==t}var Oe=fe(function(){return arguments}())?fe:function(e){return Ie(e)&&N.call(e,"callee")&&!q.call(e,"callee")},_e=Array.isArray;function Ze(e){return null!=e&&Me(e.length)&&!Ee(e)}var Pe=W||function(){return!1};function Ee(e){if(!Te(e))return!1;var t=le(e);return t==s||t==c||t==o||t==f}function Me(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}function Te(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ie(e){return null!=e&&"object"==typeof e}var Ne=O?function(e){return function(t){return e(t)}}(O):function(e){return Ie(e)&&Me(e.length)&&!!v[le(e)]};function Ae(e){return Ze(e)?ne(e,!0):he(e)}var Le,je=(Le=function(e,t,r){pe(e,t,r)},ve((function(e,t){var r=-1,n=t.length,i=n>1?t[n-1]:void 0,a=n>2?t[2]:void 0;for(i=Le.length>3&&"function"==typeof i?(n--,i):void 0,a&&function(e,t,r){if(!Te(r))return!1;var n=typeof t;return!!("number"==n?Ze(r)&&be(t,r.length):"string"==n&&t in r)&&Se(r[t],e)}(t[0],t[1],a)&&(i=n<3?void 0:i,n=1),e=Object(e);++r<n;){var o=t[r];o&&Le(e,o,r,i)}return e})));function Ce(e){return e}e.exports=je},20491:function(e,t,r){var n,i;!function(a,o){"use strict";n=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function i(e,t){var r=e[t];if("function"===typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(n){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&r?a:void 0!==console[n]?i(console,n):void 0!==console.log?i(console,"log"):e)}function s(t,r){for(var i=0;i<n.length;i++){var a=n[i];this[a]=i<t?e:this.methodFactory(a,t,r)}this.log=this.debug}function c(e,r,n){return function(){typeof console!==t&&(s.call(this,r,n),this[e].apply(this,arguments))}}function u(e,t,r){return o(e)||c.apply(this,arguments)}function l(e,r,i){var a,o=this;r=null==r?"WARN":r;var c="loglevel";function l(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=r)}catch(i){}try{window.document.cookie=encodeURIComponent(c)+"="+r+";"}catch(i){}}}function f(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(i){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(c)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(i){}return void 0===o.levels[e]&&(e=void 0),e}}function d(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}"string"===typeof e?c+=":"+e:"symbol"===typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||u,o.getLevel=function(){return a},o.setLevel=function(r,n){if("string"===typeof r&&void 0!==o.levels[r.toUpperCase()]&&(r=o.levels[r.toUpperCase()]),!("number"===typeof r&&r>=0&&r<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(a=r,!1!==n&&l(r),s.call(o,r,e),typeof console===t&&r<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){r=e,f()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(r,!1),d()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var h=f();null==h&&(h=r),o.setLevel(h,!1)}var f=new l,d={};f.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,f.getLevel(),f.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return f.noConflict=function(){return typeof window!==t&&window.log===f&&(window.log=h),f},f.getLoggers=function(){return d},f.default=f,f},void 0===(i="function"===typeof n?n.call(t,r,t,e):n)||(e.exports=i)}()},42890:function(e,t,r){"use strict";var n=r(80080).Buffer,i=r(10202).default,a=r(63298).default,o=r(51795).default,s=r(1185).default,c=r(17964).default,u=r(54790).default,l=function(e){c(r,e);var t=u(r);function r(e){var n;return a(this,r),n=t.call(this,r._prepareSuperMessage(e)),Object.defineProperty(s(n),"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(s(n),r),n}return o(r,null,[{key:"_prepareSuperMessage",value:function(e){try{return JSON.stringify(e)}catch(t){return String(e)}}}]),r}((0,r(51555).default)(Error)),f=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],d=Symbol(".toJSON called"),h=function e(t){var r=t.from,a=t.seen,o=t.to_,s=t.forceEnumerable,c=t.maxDepth,u=t.depth,l=o||(Array.isArray(r)?[]:{});if(a.push(r),u>=c)return l;if("function"===typeof r.toJSON&&!0!==r[d])return function(e){e[d]=!0;var t=e.toJSON();return delete e[d],t}(r);for(var h=0,p=Object.entries(r);h<p.length;h++){var v=i(p[h],2),m=v[0],g=v[1];"function"===typeof n&&n.isBuffer(g)?l[m]="[object Buffer]":"function"!==typeof g&&(g&&"object"===typeof g?a.includes(r[m])?l[m]="[Circular]":(u++,l[m]=e({from:r[m],seen:a.slice(),forceEnumerable:s,maxDepth:c,depth:u})):l[m]=g)}for(var y=0,b=f;y<b.length;y++){var w=b[y],k=w.property,x=w.enumerable;"string"===typeof r[k]&&Object.defineProperty(l,k,{value:r[k],enumerable:!!s||x,configurable:!0,writable:!0})}return l};e.exports={serializeError:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).maxDepth,r=void 0===t?Number.POSITIVE_INFINITY:t;return"object"===typeof e&&null!==e?h({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0}):"function"===typeof e?"[Function: ".concat(e.name||"anonymous","]"):e},deserializeError:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).maxDepth,r=void 0===t?Number.POSITIVE_INFINITY:t;if(e instanceof Error)return e;if("object"===typeof e&&null!==e&&!Array.isArray(e)){var n=new Error;return h({from:e,seen:[],to_:n,maxDepth:r,depth:0}),n}return new l(e)}}},13409:function(e){e.exports=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="swal-button";t.CLASS_NAMES={MODAL:"swal-modal",OVERLAY:"swal-overlay",SHOW_MODAL:"swal-overlay--show-modal",MODAL_TITLE:"swal-title",MODAL_TEXT:"swal-text",ICON:"swal-icon",ICON_CUSTOM:"swal-icon--custom",CONTENT:"swal-content",FOOTER:"swal-footer",BUTTON_CONTAINER:"swal-button-container",BUTTON:n,CONFIRM_BUTTON:n+"--confirm",CANCEL_BUTTON:n+"--cancel",DANGER_BUTTON:n+"--danger",BUTTON_LOADING:n+"--loading",BUTTON_LOADER:n+"__loader"},t.default=t.CLASS_NAMES},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNode=function(e){var t="."+e;return document.querySelector(t)},t.stringToNode=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},t.insertAfter=function(e,t){var r=t.nextSibling;t.parentNode.insertBefore(e,r)},t.removeNode=function(e){e.parentElement.removeChild(e)},t.throwErr=function(e){throw"SweetAlert: "+(e=e.replace(/ +(?= )/g,"")).trim()},t.isPlainObject=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},t.ordinalSuffixOf=function(e){var t=e%10,r=e%100;return 1===t&&11!==r?e+"st":2===t&&12!==r?e+"nd":3===t&&13!==r?e+"rd":e+"th"}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(25));var i=r(26);t.overlayMarkup=i.default,n(r(27)),n(r(28)),n(r(29));var a=r(0),o=a.default.MODAL_TITLE,s=a.default.MODAL_TEXT,c=a.default.ICON,u=a.default.FOOTER;t.iconMarkup='\n  <div class="'+c+'"></div>',t.titleMarkup='\n  <div class="'+o+'"></div>\n',t.textMarkup='\n  <div class="'+s+'"></div>',t.footerMarkup='\n  <div class="'+u+'"></div>\n'},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.CONFIRM_KEY="confirm",t.CANCEL_KEY="cancel";var i={visible:!0,text:null,value:null,className:"",closeModal:!0},a=Object.assign({},i,{visible:!1,text:"Cancel",value:null}),o=Object.assign({},i,{text:"OK",value:!0});t.defaultButtonList={cancel:a,confirm:o};var s=function(e){switch(e){case t.CONFIRM_KEY:return o;case t.CANCEL_KEY:return a;default:var r=e.charAt(0).toUpperCase()+e.slice(1);return Object.assign({},i,{text:r,value:e})}},c=function(e,t){var r=s(e);return!0===t?Object.assign({},r,{visible:!0}):"string"==typeof t?Object.assign({},r,{visible:!0,text:t}):n.isPlainObject(t)?Object.assign({visible:!0},r,t):Object.assign({},r,{visible:!1})},u=function(e){for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var i=n[r],o=e[i],s=c(i,o);t[i]=s}return t.cancel||(t.cancel=a),t},l=function(e){var r={};switch(e.length){case 1:r[t.CANCEL_KEY]=Object.assign({},a,{visible:!1});break;case 2:r[t.CANCEL_KEY]=c(t.CANCEL_KEY,e[0]),r[t.CONFIRM_KEY]=c(t.CONFIRM_KEY,e[1]);break;default:n.throwErr("Invalid number of 'buttons' in array ("+e.length+").\n      If you want more than 2 buttons, you need to use an object!")}return r};t.getButtonListOpts=function(e){var r=t.defaultButtonList;return"string"==typeof e?r[t.CONFIRM_KEY]=c(t.CONFIRM_KEY,e):Array.isArray(e)?r=l(e):n.isPlainObject(e)?r=u(e):!0===e?r=l([!0,!0]):!1===e?r=l([!1,!1]):void 0===e&&(r=t.defaultButtonList),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(2),a=r(0),o=a.default.MODAL,s=a.default.OVERLAY,c=r(30),u=r(31),l=r(32),f=r(33);t.injectElIntoModal=function(e){var t=n.getNode(o),r=n.stringToNode(e);return t.appendChild(r),r};var d=function(e){e.className=o,e.textContent=""},h=function(e,t){d(e);var r=t.className;r&&e.classList.add(r)};t.initModalContent=function(e){var t=n.getNode(o);h(t,e),c.default(e.icon),u.initTitle(e.title),u.initText(e.text),f.default(e.content),l.default(e.buttons,e.dangerMode)};var p=function(){var e=n.getNode(s),t=n.stringToNode(i.modalMarkup);e.appendChild(t)};t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i={isOpen:!1,promise:null,actions:{},timer:null},a=Object.assign({},i);t.resetState=function(){a=Object.assign({},i)},t.setActionValue=function(e){if("string"==typeof e)return o(n.CONFIRM_KEY,e);for(var t in e)o(t,e[t])};var o=function(e,t){a.actions[e]||(a.actions[e]={}),Object.assign(a.actions[e],{value:t})};t.setActionOptionsFor=function(e,t){var r=(void 0===t?{}:t).closeModal,n=void 0===r||r;Object.assign(a.actions[e],{closeModal:n})},t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(3),a=r(0),o=a.default.OVERLAY,s=a.default.SHOW_MODAL,c=a.default.BUTTON,u=a.default.BUTTON_LOADING,l=r(5);t.openModal=function(){n.getNode(o).classList.add(s),l.default.isOpen=!0};var f=function(){n.getNode(o).classList.remove(s),l.default.isOpen=!1};t.onAction=function(e){void 0===e&&(e=i.CANCEL_KEY);var t=l.default.actions[e],r=t.value;if(!1===t.closeModal){var a=c+"--"+e;n.getNode(a).classList.add(u)}else f();l.default.promise.resolve(r)},t.getState=function(){var e=Object.assign({},l.default);return delete e.promise,delete e.timer,e},t.stopLoading=function(){for(var e=document.querySelectorAll("."+c),t=0;t<e.length;t++)e[t].classList.remove(u)}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){(function(t){e.exports=t.sweetAlert=r(9)}).call(t,r(7))},function(e,t,r){(function(t){e.exports=t.swal=r(10)}).call(t,r(7))},function(e,t,r){"undefined"!=typeof window&&r(11),r(16);var n=r(23).default;e.exports=n},function(e,t,r){var n=r(12);"string"==typeof n&&(n=[[e.i,n,""]]);var i={insertAt:"top",transform:void 0};r(14)(n,i),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(13)(void 0)).push([e.i,'.swal-icon--error{border-color:#f27474;-webkit-animation:animateErrorIcon .5s;animation:animateErrorIcon .5s}.swal-icon--error__x-mark{position:relative;display:block;-webkit-animation:animateXMark .5s;animation:animateXMark .5s}.swal-icon--error__line{position:absolute;height:5px;width:47px;background-color:#f27474;display:block;top:37px;border-radius:2px}.swal-icon--error__line--left{-webkit-transform:rotate(45deg);transform:rotate(45deg);left:17px}.swal-icon--error__line--right{-webkit-transform:rotate(-45deg);transform:rotate(-45deg);right:16px}@-webkit-keyframes animateErrorIcon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}to{-webkit-transform:rotateX(0deg);transform:rotateX(0deg);opacity:1}}@keyframes animateErrorIcon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}to{-webkit-transform:rotateX(0deg);transform:rotateX(0deg);opacity:1}}@-webkit-keyframes animateXMark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}to{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}@keyframes animateXMark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}to{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}.swal-icon--warning{border-color:#f8bb86;-webkit-animation:pulseWarning .75s infinite alternate;animation:pulseWarning .75s infinite alternate}.swal-icon--warning__body{width:5px;height:47px;top:10px;border-radius:2px;margin-left:-2px}.swal-icon--warning__body,.swal-icon--warning__dot{position:absolute;left:50%;background-color:#f8bb86}.swal-icon--warning__dot{width:7px;height:7px;border-radius:50%;margin-left:-4px;bottom:-11px}@-webkit-keyframes pulseWarning{0%{border-color:#f8d486}to{border-color:#f8bb86}}@keyframes pulseWarning{0%{border-color:#f8d486}to{border-color:#f8bb86}}.swal-icon--success{border-color:#a5dc86}.swal-icon--success:after,.swal-icon--success:before{content:"";border-radius:50%;position:absolute;width:60px;height:120px;background:#fff;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.swal-icon--success:before{border-radius:120px 0 0 120px;top:-7px;left:-33px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:60px 60px;transform-origin:60px 60px}.swal-icon--success:after{border-radius:0 120px 120px 0;top:-11px;left:30px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:0 60px;transform-origin:0 60px;-webkit-animation:rotatePlaceholder 4.25s ease-in;animation:rotatePlaceholder 4.25s ease-in}.swal-icon--success__ring{width:80px;height:80px;border:4px solid hsla(98,55%,69%,.2);border-radius:50%;box-sizing:content-box;position:absolute;left:-4px;top:-4px;z-index:2}.swal-icon--success__hide-corners{width:5px;height:90px;background-color:#fff;padding:1px;position:absolute;left:28px;top:8px;z-index:1;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.swal-icon--success__line{height:5px;background-color:#a5dc86;display:block;border-radius:2px;position:absolute;z-index:2}.swal-icon--success__line--tip{width:25px;left:14px;top:46px;-webkit-transform:rotate(45deg);transform:rotate(45deg);-webkit-animation:animateSuccessTip .75s;animation:animateSuccessTip .75s}.swal-icon--success__line--long{width:47px;right:8px;top:38px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-animation:animateSuccessLong .75s;animation:animateSuccessLong .75s}@-webkit-keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}to{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}@keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}to{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}@-webkit-keyframes animateSuccessTip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}to{width:25px;left:14px;top:45px}}@keyframes animateSuccessTip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}to{width:25px;left:14px;top:45px}}@-webkit-keyframes animateSuccessLong{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}to{width:47px;right:8px;top:38px}}@keyframes animateSuccessLong{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}to{width:47px;right:8px;top:38px}}.swal-icon--info{border-color:#c9dae1}.swal-icon--info:before{width:5px;height:29px;bottom:17px;border-radius:2px;margin-left:-2px}.swal-icon--info:after,.swal-icon--info:before{content:"";position:absolute;left:50%;background-color:#c9dae1}.swal-icon--info:after{width:7px;height:7px;border-radius:50%;margin-left:-3px;top:19px}.swal-icon{width:80px;height:80px;border-width:4px;border-style:solid;border-radius:50%;padding:0;position:relative;box-sizing:content-box;margin:20px auto}.swal-icon:first-child{margin-top:32px}.swal-icon--custom{width:auto;height:auto;max-width:100%;border:none;border-radius:0}.swal-icon img{max-width:100%;max-height:100%}.swal-title{color:rgba(0,0,0,.65);font-weight:600;text-transform:none;position:relative;display:block;padding:13px 16px;font-size:27px;line-height:normal;text-align:center;margin-bottom:0}.swal-title:first-child{margin-top:26px}.swal-title:not(:first-child){padding-bottom:0}.swal-title:not(:last-child){margin-bottom:13px}.swal-text{font-size:16px;position:relative;float:none;line-height:normal;vertical-align:top;text-align:left;display:inline-block;margin:0;padding:0 10px;font-weight:400;color:rgba(0,0,0,.64);max-width:calc(100% - 20px);overflow-wrap:break-word;box-sizing:border-box}.swal-text:first-child{margin-top:45px}.swal-text:last-child{margin-bottom:45px}.swal-footer{text-align:right;padding-top:13px;margin-top:13px;padding:13px 16px;border-radius:inherit;border-top-left-radius:0;border-top-right-radius:0}.swal-button-container{margin:5px;display:inline-block;position:relative}.swal-button{background-color:#7cd1f9;color:#fff;border:none;box-shadow:none;border-radius:5px;font-weight:600;font-size:14px;padding:10px 24px;margin:0;cursor:pointer}.swal-button:not([disabled]):hover{background-color:#78cbf2}.swal-button:active{background-color:#70bce0}.swal-button:focus{outline:none;box-shadow:0 0 0 1px #fff,0 0 0 3px rgba(43,114,165,.29)}.swal-button[disabled]{opacity:.5;cursor:default}.swal-button::-moz-focus-inner{border:0}.swal-button--cancel{color:#555;background-color:#efefef}.swal-button--cancel:not([disabled]):hover{background-color:#e8e8e8}.swal-button--cancel:active{background-color:#d7d7d7}.swal-button--cancel:focus{box-shadow:0 0 0 1px #fff,0 0 0 3px rgba(116,136,150,.29)}.swal-button--danger{background-color:#e64942}.swal-button--danger:not([disabled]):hover{background-color:#df4740}.swal-button--danger:active{background-color:#cf423b}.swal-button--danger:focus{box-shadow:0 0 0 1px #fff,0 0 0 3px rgba(165,43,43,.29)}.swal-content{padding:0 20px;margin-top:20px;font-size:medium}.swal-content:last-child{margin-bottom:20px}.swal-content__input,.swal-content__textarea{-webkit-appearance:none;background-color:#fff;border:none;font-size:14px;display:block;box-sizing:border-box;width:100%;border:1px solid rgba(0,0,0,.14);padding:10px 13px;border-radius:2px;transition:border-color .2s}.swal-content__input:focus,.swal-content__textarea:focus{outline:none;border-color:#6db8ff}.swal-content__textarea{resize:vertical}.swal-button--loading{color:transparent}.swal-button--loading~.swal-button__loader{opacity:1}.swal-button__loader{position:absolute;height:auto;width:43px;z-index:2;left:50%;top:50%;-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);text-align:center;pointer-events:none;opacity:0}.swal-button__loader div{display:inline-block;float:none;vertical-align:baseline;width:9px;height:9px;padding:0;border:none;margin:2px;opacity:.4;border-radius:7px;background-color:hsla(0,0%,100%,.9);transition:background .2s;-webkit-animation:swal-loading-anim 1s infinite;animation:swal-loading-anim 1s infinite}.swal-button__loader div:nth-child(3n+2){-webkit-animation-delay:.15s;animation-delay:.15s}.swal-button__loader div:nth-child(3n+3){-webkit-animation-delay:.3s;animation-delay:.3s}@-webkit-keyframes swal-loading-anim{0%{opacity:.4}20%{opacity:.4}50%{opacity:1}to{opacity:.4}}@keyframes swal-loading-anim{0%{opacity:.4}20%{opacity:.4}50%{opacity:1}to{opacity:.4}}.swal-overlay{position:fixed;top:0;bottom:0;left:0;right:0;text-align:center;font-size:0;overflow-y:auto;background-color:rgba(0,0,0,.4);z-index:10000;pointer-events:none;opacity:0;transition:opacity .3s}.swal-overlay:before{content:" ";display:inline-block;vertical-align:middle;height:100%}.swal-overlay--show-modal{opacity:1;pointer-events:auto}.swal-overlay--show-modal .swal-modal{opacity:1;pointer-events:auto;box-sizing:border-box;-webkit-animation:showSweetAlert .3s;animation:showSweetAlert .3s;will-change:transform}.swal-modal{width:478px;opacity:0;pointer-events:none;background-color:#fff;text-align:center;border-radius:5px;position:static;margin:20px auto;display:inline-block;vertical-align:middle;-webkit-transform:scale(1);transform:scale(1);-webkit-transform-origin:50% 50%;transform-origin:50% 50%;z-index:10001;transition:opacity .2s,-webkit-transform .3s;transition:transform .3s,opacity .2s;transition:transform .3s,opacity .2s,-webkit-transform .3s}@media (max-width:500px){.swal-modal{width:calc(100% - 20px)}}@-webkit-keyframes showSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1)}1%{-webkit-transform:scale(.5);transform:scale(.5)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes showSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1)}1%{-webkit-transform:scale(.5);transform:scale(.5)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}to{-webkit-transform:scale(1);transform:scale(1)}}',""])},function(e,t){function r(e,t){var r=e[1]||"",i=e[3];if(!i)return r;if(t&&"function"==typeof btoa){var a=n(i);return[r].concat(i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}))).concat([a]).join("\n")}return[r].join("\n")}function n(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=r(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(n[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];"number"==typeof o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),t.push(o))}},t}},function(e,t,r){function n(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=p[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(l(n.parts[a],t))}else{var o=[];for(a=0;a<n.parts.length;a++)o.push(l(n.parts[a],t));p[n.id]={id:n.id,refs:1,parts:o}}}}function i(e,t){for(var r=[],n={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};n[o]?n[o].parts.push(s):r.push(n[o]={id:o,parts:[s]})}return r}function a(e,t){var r=m(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=b[b.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),b.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(t)}}function o(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=b.indexOf(e);t>=0&&b.splice(t,1)}function s(e){var t=document.createElement("style");return e.attrs.type="text/css",u(t,e.attrs),a(e,t),t}function c(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",u(t,e.attrs),a(e,t),t}function u(e,t){Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])}))}function l(e,t){var r,n,i,a;if(t.transform&&e.css){if(!(a=t.transform(e.css)))return function(){};e.css=a}if(t.singleton){var u=y++;r=g||(g=s(t)),n=f.bind(null,r,u,!1),i=f.bind(null,r,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=c(t),n=h.bind(null,r,t),i=function(){o(r),r.href&&URL.revokeObjectURL(r.href)}):(r=s(t),n=d.bind(null,r),i=function(){o(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}function f(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=k(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}function d(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function h(e,t,r){var n=r.css,i=r.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(n=w(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}var p={},v=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}((function(){return window&&document&&document.all&&!window.atob})),m=function(e){var t={};return function(r){return void 0===t[r]&&(t[r]=e.call(this,r)),t[r]}}((function(e){return document.querySelector(e)})),g=null,y=0,b=[],w=r(15);e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||(t.singleton=v()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=i(e,t);return n(r,t),function(e){for(var a=[],o=0;o<r.length;o++){var s=r[o];(c=p[s.id]).refs--,a.push(c)}for(e&&n(i(e,t),t),o=0;o<a.length;o++){var c;if(0===(c=a[o]).refs){for(var u=0;u<c.parts.length;u++)c.parts[u]();delete p[c.id]}}}};var k=function(){var e=[];return function(t,r){return e[t]=r,e.filter(Boolean).join("\n")}}()},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?r+a:n+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}},function(e,t,r){var n=r(17);"undefined"==typeof window||window.Promise||(window.Promise=n),r(21),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),n=r.length>>>0;if(0===n)return!1;for(var i=0|t,a=Math.max(i>=0?i:n-Math.abs(i),0);a<n;){if(function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}(r[a],e))return!0;a++}return!1}}),"undefined"!=typeof window&&[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})}))},function(e,t,r){(function(t){!function(r){function n(){}function i(e,t){return function(){e.apply(t,arguments)}}function a(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(e,this)}function o(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,a._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void c(t.promise,e)}s(t.promise,n)}else(1===e._state?s:c)(t.promise,e._value)}))):e._deferreds.push(t)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof a)return e._state=3,e._value=t,void u(e);if("function"==typeof r)return void f(i(r,t),e)}e._state=1,e._value=t,u(e)}catch(t){c(e,t)}}function c(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&a._immediateFn((function(){e._handled||a._unhandledRejectionFn(e._value)}));for(var t=0,r=e._deferreds.length;t<r;t++)o(e,e._deferreds[t]);e._deferreds=null}function l(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function f(e,t){var r=!1;try{e((function(e){r||(r=!0,s(t,e))}),(function(e){r||(r=!0,c(t,e))}))}catch(e){if(r)return;r=!0,c(t,e)}}var d=setTimeout;a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new l(e,t,r)),r},a.all=function(e){var t=Array.prototype.slice.call(e);return new a((function(e,r){function n(a,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var s=o.then;if("function"==typeof s)return void s.call(o,(function(e){n(a,e)}),r)}t[a]=o,0==--i&&e(t)}catch(e){r(e)}}if(0===t.length)return e([]);for(var i=t.length,a=0;a<t.length;a++)n(a,t[a])}))},a.resolve=function(e){return e&&"object"==typeof e&&e.constructor===a?e:new a((function(t){t(e)}))},a.reject=function(e){return new a((function(t,r){r(e)}))},a.race=function(e){return new a((function(t,r){for(var n=0,i=e.length;n<i;n++)e[n].then(t,r)}))},a._immediateFn="function"==typeof t&&function(e){t(e)}||function(e){d(e,0)},a._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},a._setImmediateFn=function(e){a._immediateFn=e},a._setUnhandledRejectionFn=function(e){a._unhandledRejectionFn=e},void 0!==e&&e.exports?e.exports=a:r.Promise||(r.Promise=a)}(this)}).call(t,r(18).setImmediate)},function(e,t,r){function n(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new n(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new n(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(19),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,r){(function(e,t){!function(e,r){"use strict";function n(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var n={callback:e,args:t};return u[c]=n,s(c),c++}function i(e){delete u[e]}function a(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}function o(e){if(l)setTimeout(o,0,e);else{var t=u[e];if(t){l=!0;try{a(t)}finally{i(e),l=!1}}}}if(!e.setImmediate){var s,c=1,u={},l=!1,f=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?s=function(e){t.nextTick((function(){o(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&o(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),s=function(r){e.postMessage(t+r,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},s=function(t){e.port2.postMessage(t)}}():f&&"onreadystatechange"in f.createElement("script")?function(){var e=f.documentElement;s=function(t){var r=f.createElement("script");r.onreadystatechange=function(){o(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():s=function(e){setTimeout(o,0,e)},d.setImmediate=n,d.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,r(7),r(20))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function a(e){if(f===clearTimeout)return clearTimeout(e);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function o(){v&&h&&(v=!1,h.length?p=h.concat(p):m=-1,p.length&&s())}function s(){if(!v){var e=i(o);v=!0;for(var t=p.length;t;){for(h=p,p=[];++m<t;)h&&h[m].run();m=-1,t=p.length}h=null,v=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var l,f,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(e){f=n}}();var h,p=[],v=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new c(e,t)),1!==p.length||v||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,r){"use strict";r(22).polyfill()},function(e,t,r){"use strict";function n(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var a=Object.keys(Object(i)),o=0,s=a.length;o<s;o++){var c=a[o],u=Object.getOwnPropertyDescriptor(i,c);void 0!==u&&u.enumerable&&(r[c]=i[c])}}return r}function i(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:n})}e.exports={assign:n,polyfill:i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(24),i=r(6),a=r(5),o=r(36),s=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if("undefined"!=typeof window){var r=o.getOpts.apply(void 0,e);return new Promise((function(e,t){a.default.promise={resolve:e,reject:t},n.default(r),setTimeout((function(){i.openModal()}))}))}};s.close=i.onAction,s.getState=i.getState,s.setActionValue=a.setActionValue,s.stopLoading=i.stopLoading,s.setDefaults=o.setDefaults,t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(0).default.MODAL,a=r(4),o=r(34),s=r(35),c=r(1);t.init=function(e){n.getNode(i)||(document.body||c.throwErr("You can only use SweetAlert AFTER the DOM has loaded!"),o.default(),a.default()),a.initModalContent(e),s.default(e)},t.default=t.init},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0).default.MODAL;t.modalMarkup='\n  <div class="'+n+'" role="dialog" aria-modal="true"></div>',t.default=t.modalMarkup},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n='<div \n    class="'+r(0).default.OVERLAY+'"\n    tabIndex="-1">\n  </div>';t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0).default.ICON;t.errorIconMarkup=function(){var e=n+"--error",t=e+"__line";return'\n    <div class="'+e+'__x-mark">\n      <span class="'+t+" "+t+'--left"></span>\n      <span class="'+t+" "+t+'--right"></span>\n    </div>\n  '},t.warningIconMarkup=function(){var e=n+"--warning";return'\n    <span class="'+e+'__body">\n      <span class="'+e+'__dot"></span>\n    </span>\n  '},t.successIconMarkup=function(){var e=n+"--success";return'\n    <span class="'+e+"__line "+e+'__line--long"></span>\n    <span class="'+e+"__line "+e+'__line--tip"></span>\n\n    <div class="'+e+'__ring"></div>\n    <div class="'+e+'__hide-corners"></div>\n  '}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0).default.CONTENT;t.contentMarkup='\n  <div class="'+n+'">\n\n  </div>\n'},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=n.default.BUTTON_CONTAINER,a=n.default.BUTTON,o=n.default.BUTTON_LOADER;t.buttonMarkup='\n  <div class="'+i+'">\n\n    <button\n      class="'+a+'"\n    ></button>\n\n    <div class="'+o+'">\n      <div></div>\n      <div></div>\n      <div></div>\n    </div>\n\n  </div>\n'},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),i=r(2),a=r(0),o=a.default.ICON,s=a.default.ICON_CUSTOM,c=["error","warning","success","info"],u={error:i.errorIconMarkup(),warning:i.warningIconMarkup(),success:i.successIconMarkup()},l=function(e,t){var r=o+"--"+e;t.classList.add(r);var n=u[e];n&&(t.innerHTML=n)},f=function(e,t){t.classList.add(s);var r=document.createElement("img");r.src=e,t.appendChild(r)},d=function(e){if(e){var t=n.injectElIntoModal(i.iconMarkup);c.includes(e)?l(e,t):f(e,t)}};t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(4),a=function(e){navigator.userAgent.includes("AppleWebKit")&&(e.style.display="none",e.offsetHeight,e.style.display="")};t.initTitle=function(e){if(e){var t=i.injectElIntoModal(n.titleMarkup);t.textContent=e,a(t)}},t.initText=function(e){if(e){var t=document.createDocumentFragment();e.split("\n").forEach((function(e,r,n){t.appendChild(document.createTextNode(e)),r<n.length-1&&t.appendChild(document.createElement("br"))}));var r=i.injectElIntoModal(n.textMarkup);r.appendChild(t),a(r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(4),a=r(0),o=a.default.BUTTON,s=a.default.DANGER_BUTTON,c=r(3),u=r(2),l=r(6),f=r(5),d=function(e,t,r){var i=t.text,a=t.value,d=t.className,h=t.closeModal,p=n.stringToNode(u.buttonMarkup),v=p.querySelector("."+o),m=o+"--"+e;v.classList.add(m),d&&(Array.isArray(d)?d:d.split(" ")).filter((function(e){return e.length>0})).forEach((function(e){v.classList.add(e)})),r&&e===c.CONFIRM_KEY&&v.classList.add(s),v.textContent=i;var g={};return g[e]=a,f.setActionValue(g),f.setActionOptionsFor(e,{closeModal:h}),v.addEventListener("click",(function(){return l.onAction(e)})),p},h=function(e,t){var r=i.injectElIntoModal(u.footerMarkup);for(var n in e){var a=e[n],o=d(n,a,t);a.visible&&r.appendChild(o)}0===r.children.length&&r.remove()};t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(4),a=r(2),o=r(5),s=r(6),c=r(0).default.CONTENT,u=function(e){e.addEventListener("input",(function(e){var t=e.target.value;o.setActionValue(t)})),e.addEventListener("keyup",(function(e){if("Enter"===e.key)return s.onAction(n.CONFIRM_KEY)})),setTimeout((function(){e.focus(),o.setActionValue("")}),0)},l=function(e,t,r){var n=document.createElement(t),i=c+"__"+t;for(var a in n.classList.add(i),r){var o=r[a];n[a]=o}"input"===t&&u(n),e.appendChild(n)},f=function(e){if(e){var t=i.injectElIntoModal(a.contentMarkup),r=e.element,n=e.attributes;"string"==typeof r?l(t,r,n):t.appendChild(r)}};t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(2),a=function(){var e=n.stringToNode(i.overlayMarkup);document.body.appendChild(e)};t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),i=r(6),a=r(1),o=r(3),s=r(0),c=s.default.MODAL,u=s.default.BUTTON,l=s.default.OVERLAY,f=function(e){e.preventDefault(),m()},d=function(e){e.preventDefault(),g()},h=function(e){if(n.default.isOpen&&"Escape"===e.key)return i.onAction(o.CANCEL_KEY)},p=function(e){if(n.default.isOpen&&"Tab"===e.key)return f(e)},v=function(e){if(n.default.isOpen)return"Tab"===e.key&&e.shiftKey?d(e):void 0},m=function(){var e=a.getNode(u);e&&(e.tabIndex=0,e.focus())},g=function(){var e=a.getNode(c).querySelectorAll("."+u),t=e[e.length-1];t&&t.focus()},y=function(e){e[e.length-1].addEventListener("keydown",p)},b=function(e){e[0].addEventListener("keydown",v)},w=function(){var e=a.getNode(c).querySelectorAll("."+u);e.length&&(y(e),b(e))},k=function(e){if(a.getNode(l)===e.target)return i.onAction(o.CANCEL_KEY)},x=function(e){var t=a.getNode(l);t.removeEventListener("click",k),e&&t.addEventListener("click",k)},S=function(e){n.default.timer&&clearTimeout(n.default.timer),e&&(n.default.timer=window.setTimeout((function(){return i.onAction(o.CANCEL_KEY)}),e))},O=function(e){e.closeOnEsc?document.addEventListener("keyup",h):document.removeEventListener("keyup",h),e.dangerMode?m():g(),w(),x(e.closeOnClickOutside),S(e.timer)};t.default=O},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(3),a=r(37),o=r(38),s={title:null,text:null,icon:null,buttons:i.defaultButtonList,content:null,className:null,closeOnClickOutside:!0,closeOnEsc:!0,dangerMode:!1,timer:null},c=Object.assign({},s);t.setDefaults=function(e){c=Object.assign({},s,e)};var u=function(e){var t=e&&e.button,r=e&&e.buttons;return void 0!==t&&void 0!==r&&n.throwErr("Cannot set both 'button' and 'buttons' options!"),void 0!==t?{confirm:t}:r},l=function(e){return n.ordinalSuffixOf(e+1)},f=function(e,t){n.throwErr(l(t)+" argument ('"+e+"') is invalid")},d=function(e,t){var r=e+1,i=t[r];n.isPlainObject(i)||void 0===i||n.throwErr("Expected "+l(r)+" argument ('"+i+"') to be a plain object")},h=function(e,t){var r=e+1,i=t[r];void 0!==i&&n.throwErr("Unexpected "+l(r)+" argument ("+i+")")},p=function(e,t,r,i){var a=t instanceof Element;if("string"===typeof t){if(0===r)return{text:t};if(1===r)return{text:t,title:i[0]};if(2===r)return d(r,i),{icon:t};f(t,r)}else{if(a&&0===r)return d(r,i),{content:t};if(n.isPlainObject(t))return h(r,i),t;f(t,r)}};t.getOpts=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r={};e.forEach((function(t,n){var i=p(0,t,n,e);Object.assign(r,i)}));var n=u(r);r.buttons=i.getButtonListOpts(n),delete r.button,r.content=a.getContentOpts(r.content);var l=Object.assign({},s,c,r);return Object.keys(l).forEach((function(e){o.DEPRECATED_OPTS[e]&&o.logDeprecation(e)})),l}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i={element:"input",attributes:{placeholder:""}};t.getContentOpts=function(e){var t={};return n.isPlainObject(e)?Object.assign(t,e):e instanceof Element?{element:e}:"input"===e?i:null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logDeprecation=function(e){var r=t.DEPRECATED_OPTS[e],n=r.onlyRename,i=r.replacement,a=r.subOption,o=r.link,s='SweetAlert warning: "'+e+'" option has been '+(n?"renamed":"deprecated")+".";i&&(s+=" Please use"+(a?' "'+a+'" in ':" ")+'"'+i+'" instead.');var c="https://sweetalert.js.org";s+=o?" More details: "+c+o:" More details: "+c+"/guides/#upgrading-from-1x",console.warn(s)},t.DEPRECATED_OPTS={type:{replacement:"icon",link:"/docs/#icon"},imageUrl:{replacement:"icon",link:"/docs/#icon"},customClass:{replacement:"className",onlyRename:!0,link:"/docs/#classname"},imageSize:{},showCancelButton:{replacement:"buttons",link:"/docs/#buttons"},showConfirmButton:{replacement:"button",link:"/docs/#button"},confirmButtonText:{replacement:"button",link:"/docs/#button"},confirmButtonColor:{},cancelButtonText:{replacement:"buttons",link:"/docs/#buttons"},closeOnConfirm:{replacement:"button",subOption:"closeModal",link:"/docs/#button"},closeOnCancel:{replacement:"buttons",subOption:"closeModal",link:"/docs/#buttons"},showLoaderOnConfirm:{replacement:"buttons"},animation:{},inputType:{replacement:"content",link:"/docs/#content"},inputValue:{replacement:"content",link:"/docs/#content"},inputPlaceholder:{replacement:"content",link:"/docs/#content"},html:{replacement:"content",link:"/docs/#content"},allowEscapeKey:{replacement:"closeOnEsc",onlyRename:!0,link:"/docs/#closeonesc"},allowClickOutside:{replacement:"closeOnClickOutside",onlyRename:!0,link:"/docs/#closeonclickoutside"}}}])},88047:function(e,t,r){var n=r(63333)();e.exports=n;try{regeneratorRuntime=n}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},89274:function(e,t,r){"use strict";function n(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("Wrong positive integer: ".concat(e))}function i(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(r.length>0&&!r.includes(e.length))throw new Error("Expected Uint8Array of length ".concat(r,", not of length=").concat(e.length))}var a={number:n,bool:function(e){if("boolean"!==typeof e)throw new Error("Expected boolean, not ".concat(e))},bytes:i,hash:function(e){if("function"!==typeof e||"function"!==typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");n(e.outputLen),n(e.blockLen)},exists:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){i(e);var r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least ".concat(r))}};t.ZP=a},21944:function(e,t,r){"use strict";r.d(t,{kb:function(){return l},GL:function(){return s},np:function(){return c},O0:function(){return u},Jq:function(){return o},hE:function(){return f},gz:function(){return d}});var n=r(47061),i=r(59900),a=("object"===typeof globalThis&&"crypto"in globalThis&&globalThis.crypto,function(e){return e instanceof Uint8Array}),o=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},s=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},c=function(e,t){return e<<32-t|e>>>t};if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");Array.from({length:256},(function(e,t){return t.toString(16).padStart(2,"0")}));function u(e){if("string"===typeof e&&(e=function(e){if("string"!==typeof e)throw new Error("utf8ToBytes expected string, got ".concat(typeof e));return new Uint8Array((new TextEncoder).encode(e))}(e)),!a(e))throw new Error("expected Uint8Array, got ".concat(typeof e));return e}var l=function(){function e(){(0,n.Z)(this,e)}return(0,i.Z)(e,[{key:"clone",value:function(){return this._cloneInto()}}]),e}();function f(e){var t=function(t){return e().update(u(t)).digest()},r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=function(){return e()},t}function d(e){var t=function(t,r){return e(r).update(u(t)).digest()},r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=function(t){return e(t)},t}},60107:function(e,t,r){"use strict";r.d(t,{wn:function(){return J}});var n=r(47061),i=r(59900),a=r(24269),o=r(74086),s=r(23680),c=r(89274),u=BigInt(Math.pow(2,32)-1),l=BigInt(32);function f(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{h:Number(e&u),l:Number(e>>l&u)}:{h:0|Number(e>>l&u),l:0|Number(e&u)}}for(var d={fromBig:f,split:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Uint32Array(e.length),n=new Uint32Array(e.length),i=0;i<e.length;i++){var a=f(e[i],t),o=[a.h,a.l];r[i]=o[0],n[i]=o[1]}return[r,n]},toBig:function(e,t){return BigInt(e>>>0)<<l|BigInt(t>>>0)},shrSH:function(e,t,r){return e>>>r},shrSL:function(e,t,r){return e<<32-r|t>>>r},rotrSH:function(e,t,r){return e>>>r|t<<32-r},rotrSL:function(e,t,r){return e<<32-r|t>>>r},rotrBH:function(e,t,r){return e<<64-r|t>>>r-32},rotrBL:function(e,t,r){return e>>>r-32|t<<64-r},rotr32H:function(e,t){return t},rotr32L:function(e,t){return e},rotlSH:function(e,t,r){return e<<r|t>>>32-r},rotlSL:function(e,t,r){return t<<r|e>>>32-r},rotlBH:function(e,t,r){return t<<r-32|e>>>64-r},rotlBL:function(e,t,r){return e<<r-32|t>>>64-r},add:function(e,t,r,n){var i=(t>>>0)+(n>>>0);return{h:e+r+(i/Math.pow(2,32)|0)|0,l:0|i}},add3L:function(e,t,r){return(e>>>0)+(t>>>0)+(r>>>0)},add3H:function(e,t,r,n){return t+r+n+(e/Math.pow(2,32)|0)|0},add4L:function(e,t,r,n){return(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)},add4H:function(e,t,r,n,i){return t+r+n+i+(e/Math.pow(2,32)|0)|0},add5H:function(e,t,r,n,i,a){return t+r+n+i+a+(e/Math.pow(2,32)|0)|0},add5L:function(e,t,r,n,i){return(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(i>>>0)}},h=d,p=r(21944),v=[],m=[],g=[],y=BigInt(0),b=BigInt(1),w=BigInt(2),k=BigInt(7),x=BigInt(256),S=BigInt(113),O=0,_=b,Z=1,P=0;O<24;O++){var E=[P,(2*Z+3*P)%5];Z=E[0],P=E[1],v.push(2*(5*P+Z)),m.push((O+1)*(O+2)/2%64);for(var M=y,T=0;T<7;T++)(_=(_<<b^(_>>k)*S)%x)&w&&(M^=b<<(b<<BigInt(T))-b);g.push(M)}var I=h.split(g,!0),N=(0,s.Z)(I,2),A=N[0],L=N[1],j=function(e,t,r){return r>32?h.rotlBH(e,t,r):h.rotlSH(e,t,r)},C=function(e,t,r){return r>32?h.rotlBL(e,t,r):h.rotlSL(e,t,r)};var R=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e,i,a){var o,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24;if((0,n.Z)(this,r),(o=t.call(this)).blockLen=e,o.suffix=i,o.outputLen=a,o.enableXOF=s,o.rounds=u,o.pos=0,o.posOut=0,o.finished=!1,o.destroyed=!1,c.ZP.number(a),0>=o.blockLen||o.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");return o.state=new Uint8Array(200),o.state32=(0,p.Jq)(o.state),o}return(0,i.Z)(r,[{key:"keccak",value:function(){!function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,r=new Uint32Array(10),n=24-t;n<24;n++){for(var i=0;i<10;i++)r[i]=e[i]^e[i+10]^e[i+20]^e[i+30]^e[i+40];for(var a=0;a<10;a+=2)for(var o=(a+8)%10,s=(a+2)%10,c=r[s],u=r[s+1],l=j(c,u,1)^r[o],f=C(c,u,1)^r[o+1],d=0;d<50;d+=10)e[a+d]^=l,e[a+d+1]^=f;for(var h=e[2],p=e[3],g=0;g<24;g++){var y=m[g],b=j(h,p,y),w=C(h,p,y),k=v[g];h=e[k],p=e[k+1],e[k]=b,e[k+1]=w}for(var x=0;x<50;x+=10){for(var S=0;S<10;S++)r[S]=e[x+S];for(var O=0;O<10;O++)e[x+O]^=~r[(O+2)%10]&r[(O+4)%10]}e[0]^=A[n],e[1]^=L[n]}r.fill(0)}(this.state32,this.rounds),this.posOut=0,this.pos=0}},{key:"update",value:function(e){c.ZP.exists(this);for(var t=this.blockLen,r=this.state,n=(e=(0,p.O0)(e)).length,i=0;i<n;){for(var a=Math.min(t-this.pos,n-i),o=0;o<a;o++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}},{key:"finish",value:function(){if(!this.finished){this.finished=!0;var e=this.state,t=this.suffix,r=this.pos,n=this.blockLen;e[r]^=t,0!==(128&t)&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}}},{key:"writeInto",value:function(e){c.ZP.exists(this,!1),c.ZP.bytes(e),this.finish();for(var t=this.state,r=this.blockLen,n=0,i=e.length;n<i;){this.posOut>=r&&this.keccak();var a=Math.min(r-this.posOut,i-n);e.set(t.subarray(this.posOut,this.posOut+a),n),this.posOut+=a,n+=a}return e}},{key:"xofInto",value:function(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}},{key:"xof",value:function(e){return c.ZP.number(e),this.xofInto(new Uint8Array(e))}},{key:"digestInto",value:function(e){if(c.ZP.output(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}},{key:"digest",value:function(){return this.digestInto(new Uint8Array(this.outputLen))}},{key:"destroy",value:function(){this.destroyed=!0,this.state.fill(0)}},{key:"_cloneInto",value:function(e){var t=this.blockLen,n=this.suffix,i=this.outputLen,a=this.rounds,o=this.enableXOF;return e||(e=new r(t,n,i,o,a)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=a,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}]),r}(p.kb),D=function(e,t,r){return(0,p.hE)((function(){return new R(t,e,r)}))},K=(D(6,144,28),D(6,136,32),D(6,104,48),D(6,72,64),D(1,144,28)),F=D(1,136,32),U=D(1,104,48),B=D(1,72,64),q=function(e,t,r){return(0,p.gz)((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new R(t,e,void 0===n.dkLen?r:n.dkLen,!0)}))},z=(q(31,168,16),q(31,136,32),r(9642)),J=((0,z.gn)(K),function(){var e=(0,z.gn)(F);return e.create=F.create,e}());(0,z.gn)(U),(0,z.gn)(B)},9642:function(e,t,r){"use strict";r.d(t,{gn:function(){return i}});var n=r(89274);r(21944),n.ZP.bool,n.ZP.bytes;function i(e){return function(t){return n.ZP.bytes(t),e(t)}}!function(){var e="object"===typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,t="undefined"!==typeof module&&"function"===typeof module.require&&module.require.bind(module);t&&!e&&t("crypto")}()},53065:function(e,t,r){"use strict";function n(e,t){void 0===t&&(t=e.constructor);var r=Error.captureStackTrace;r&&r(e,t)}r.d(t,{s:function(){return a}});var i=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),a=function(e){function t(t,r){var i=this.constructor,a=e.call(this,t,r)||this;return Object.defineProperty(a,"name",{value:i.name,enumerable:!1,configurable:!0}),function(e,t){var r=Object.setPrototypeOf;r?r(e,t):e.__proto__=t}(a,i.prototype),n(a),a}return i(t,e),t}(Error)},91421:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}r.d(t,{Z:function(){return n}})}}]);
//# sourceMappingURL=664.49f59f57.chunk.js.map